/* !
* Graphing JavaScript Library v0.2.0
* https://github.com/NPellet/graph
* 
* Copyright (c) 2014 Norman Pellet
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
* 
* Date: 08-08-2014
*/
define("graph.axis",["jquery"],function(t){var i=function(){};return i.prototype={defaults:{lineAt0:!1,display:!0,flipped:!1,axisDataSpacing:{min:.1,max:.1},unitModification:!1,primaryGrid:!0,secondaryGrid:!0,shiftToZero:!1,tickPosition:1,nbTicksPrimary:3,nbTicksSecondary:10,ticklabelratio:1,exponentialFactor:0,exponentialLabelFactor:0,wheelBaseline:"min",logScale:!1,allowedPxSerie:100,forcedMin:!1,forcedMax:!1},init:function(e,s,n){this.unitModificationTimeTicks=[[1,[1,2,5,10,20,30]],[60,[1,2,5,10,20,30]],[3600,[1,2,6,12]],[86400,[1,2,3,4,5,10,20,40]]];var r=this;this.graph=e,this.options=t.extend(!0,{},i.prototype.defaults,n,s),this.group=document.createElementNS(this.graph.ns,"g"),this.hasChanged=!0,this.groupGrids=document.createElementNS(this.graph.ns,"g"),this.graph.axisGroup.insertBefore(this.groupGrids,this.graph.axisGroup.firstChild),this.rectEvent=document.createElementNS(this.graph.ns,"rect"),this.rectEvent.setAttribute("pointer-events","fill"),this.rectEvent.setAttribute("fill","transparent"),this.group.appendChild(this.rectEvent),this.setEvents(),this.graph.axisGroup.appendChild(this.group),this.line=document.createElementNS(this.graph.ns,"line"),this.line.setAttribute("stroke","black"),this.line.setAttribute("shape-rendering","crispEdges"),this.line.setAttribute("stroke-linecap","square"),this.groupTicks=document.createElementNS(this.graph.ns,"g"),this.groupTickLabels=document.createElementNS(this.graph.ns,"g"),this.group.appendChild(this.groupTicks),this.group.appendChild(this.groupTickLabels),this.group.appendChild(this.line),this.labelValue,this.label=document.createElementNS(this.graph.ns,"text"),this.labelTspan=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.labelTspan),this.expTspan=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.expTspan),this.expTspan.setAttribute("dx",10),this.expTspanExp=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.expTspanExp),this.expTspanExp.setAttribute("dy",-5),this.expTspanExp.setAttribute("font-size","0.8em"),this.label.setAttribute("text-anchor","middle"),this.groupGrids.setAttribute("clip-path","url(#_clipplot"+this.graph._creation+")"),this.graph.applyStyleText(this.label),this.group.appendChild(this.label),this.groupSeries=document.createElementNS(this.graph.ns,"g"),this.group.appendChild(this.groupSeries),this.ticks=[],this.series=[],this.totalDelta=0,this.currentAction=!1,this.group.addEventListener("mousemove",function(t){t.preventDefault();var i=r.graph.getXY(t);r.handleMouseMoveLocal(i.x,i.y,t);for(var e=0,s=r.series.length;s>e;e++)r.series[e].handleMouseMove(!1,!0),"labelDragging"==r.currentAction&&r.series[e].handleLabelMove(i.x,i.y),"labelDraggingMain"==r.currentAction&&r.series[e].handleLabelMainMove(i.x,i.y)}),this.group.addEventListener("mouseup",function(t){t.preventDefault(),r.handleMouseUp()}),this.group.addEventListener("mouseout",function(t){t.preventDefault();var i=r.graph.getXY(t);r.handleMouseOutLocal(i.x,i.y,t)}),this.labels=[],this.group.addEventListener("click",function(t){t.preventDefault();var i=r.graph.getXY(t);r.addLabel(r.getVal(i.x-r.graph.getPaddingLeft()))}),this.axisRand=Math.random(),this.clip=document.createElementNS(this.graph.ns,"clipPath"),this.clip.setAttribute("id","_clip"+this.axisRand),this.graph.defs.appendChild(this.clip),this.clipRect=document.createElementNS(this.graph.ns,"rect"),this.clip.appendChild(this.clipRect),this.clip.setAttribute("clipPathUnits","userSpaceOnUse")},setEvents:function(){var t=this;this.rectEvent.addEventListener("mousedown",function(i){if(i.stopPropagation(),i.preventDefault(),3!=i.which&&!i.ctrlKey){var e=t.graph.getXY(i);switch(t.graph.currentAction="zooming",t.graph._zoomingMode=t instanceof GraphXAxis?"x":"y",t.graph._zoomingXStart=e.x,t.graph._zoomingYStart=e.y,t.graph._zoomingXStartRel=e.x-t.graph.getPaddingLeft(),t.graph._zoomingYStartRel=e.y-t.graph.getPaddingTop(),t.this._zoomingSquare.setAttribute("width",0),t.this._zoomingSquare.setAttribute("height",0),t.graph._zoomingMode){case"x":t.this._zoomingSquare.setAttribute("y",t.graph.getPaddingTop()+t.shift-t.totalDimension),t.this._zoomingSquare.setAttribute("height",t.totalDimension);break;case"y":t.this._zoomingSquare.setAttribute("x",t.graph.getPaddingLeft()+t.shift-t.totalDimension),t.this._zoomingSquare.setAttribute("width",t.totalDimension)}t.this._zoomingSquare.setAttribute("display","block")}})},addLabel:function(t){for(var i=0,e=this.series.length;e>i;i++)this.series[i].currentAction===!1&&this.series[i].addLabelObj({x:t})},setDisplay:function(t){return this.options.display=!!t,this},setLineAt0:function(t){this.options.lineAt0=!!t},setAxisDataSpacing:function(t,i){this.options.axisDataSpacing.min=t,this.options.axisDataSpacing.max=i||t},setAxisDataSpacingMin:function(t){this.options.axisDataSpacing.min=t},setAxisDataSpacingMax:function(t){this.options.axisDataSpacing.max=t},setMinPx:function(t){this.minPx=t},getMinPx:function(){return this.options.flipped?this.maxPx:this.minPx},setMaxPx:function(t){this.maxPx=t},getMaxPx:function(){return this.options.flipped?this.minPx:this.maxPx},getMathMaxPx:function(){return this.maxPx},getMinValue:function(){return this.options.forcedMin||(0===this.options.forcedMin?0:this.dataMin)},getMaxValue:function(){return this.options.forcedMax||(0===this.options.forcedMax?0:this.dataMax)},setMinValueData:function(t){this.dataMin=t},setMaxValueData:function(t){this.dataMax=t},forceMin:function(t){this.options.forcedMin=t},forceMax:function(t){this.options.forcedMax=t},getNbTicksPrimary:function(){return this.options.nbTicksPrimary},getNbTicksSecondary:function(){return this.options.nbTicksSecondary},handleMouseMove:function(t){this.mouseVal=this.getVal(t)},handleMouseWheel:function(t){t=Math.min(.2,Math.max(-.2,t));var i;i="min"==this.options.wheelBaseline?this.getActualMin():"max"==this.options.wheelBaseline?this.getActualMax():this.options.wheelBaseline,this._doZoomVal((this.getActualMax()-i)*(1+t)+i,(this.getActualMin()-i)*(1+t)+i),this.graph.redraw(!0)},handleMouseUp:function(t){if("labelDragging"==this.currentAction||"labelDraggingMain"==this.currentAction){for(var i=0,e=this.series.length;e>i;i++)this.series[i].handleLabelUp();this.currentAction=!1}else this.graph.isZooming()&&this._handleZoom(t)},_doZoomVal:function(t,i,e){return this._doZoom(this.getPx(t),this.getPx(i),t,i,e)},_doZoom:function(t,i,e,s,n){var e=e||this.getVal(t),s=s||this.getVal(i);this.setCurrentMin(Math.min(e,s)),this.setCurrentMax(Math.max(e,s)),this._hasChanged=!0,this.options.onZoom&&!n&&this.options.onZoom(this.currentAxisMin,this.currentAxisMax)},getSerieShift:function(){return this._serieShift},getSerieScale:function(){return this._serieScale},getMouseVal:function(){return this.mouseVal},isFlipped:function(){return this.options.flipped},getUnitPerTick:function(t,i,e,s){var n=t/x;i=i?Math.min(i,t/10):t/10;var r=e/i;if("time"==this.options.unitModification){var s=this.getModifiedValue(this.getMaxValue());umin=3600>s?0:86400>s?1:2;for(var h=!1,o=0,a=this.unitModificationTimeTicks.length;a>o;o++){for(var l=0,u=this.unitModificationTimeTicks[o][1].length;u>l;l++)if(r<this.unitModificationTimeTicks[o][0]*this.unitModificationTimeTicks[o][1][l]){h=!0;break}if(h)break}f=o!==this.unitModificationTimeTicks.length?this.unitModificationTimeTicks[o][0]*this.unitModificationTimeTicks[o][1][l]:1}else{var d=Math.floor(Math.log(r)/Math.log(10)),g=r*Math.pow(10,-d);this.decimals=-d;for(var c=[1,2,5,10],p=!1,o=c.length-1;o>=0;o--)(!p||Math.abs(c[o]-g)<Math.abs(p-g))&&(p=c[o]);var f=p*Math.pow(10,d)}var x=e/f,n=t/i;return[f,x,n]},setMinMaxToFitSeries:function(){var t=this.getMaxValue()-this.getMinValue();this.currentAxisMin=this.getMinValue()-this.options.axisDataSpacing.min*t,this.currentAxisMax=this.getMaxValue()+this.options.axisDataSpacing.max*t,this.options.logScale&&(this.currentAxisMin=Math.max(1e-50,this.currentAxisMin),this.currentAxisMax=Math.max(1e-50,this.currentAxisMax))},_getActualInterval:function(){return this.getActualMax()-this.getActualMin()},getActualMin:function(){return this.currentAxisMin==this.currentAxisMax?this.currentAxisMin-1:this.currentAxisMin},getActualMax:function(){return this.currentAxisMax==this.currentAxisMin?this.currentAxisMax+1:this.currentAxisMax},setCurrentMin:function(t){this.currentAxisMin=t,this.options.logScale&&(this.currentAxisMin=Math.max(1e-50,t))},setCurrentMax:function(t){this.currentAxisMax=t,this.options.logScale&&(this.currentAxisMax=Math.max(1e-50,t))},flip:function(t){return this.options.flipped=t,this},_draw:function(){var t;switch(this.options.tickPosition){case 3:this.tickPx1=-2,this.tickPx2=0;break;case 2:this.tickPx1=-1,this.tickPx2=1;break;case 1:this.tickPx1=0,this.tickPx2=2}for(;this.groupTicks.firstChild;)this.groupTicks.removeChild(this.groupTicks.firstChild);for(;this.groupTickLabels.firstChild;)this.groupTickLabels.removeChild(this.groupTickLabels.firstChild);for(;this.groupGrids.firstChild;)this.groupGrids.removeChild(this.groupGrids.firstChild);(void 0==this.currentAxisMin||void 0==!this.currentAxisMax)&&this.setMinMaxToFitSeries();var i=this.maxPx-this.minPx,e=this._getActualInterval();if(!this.options.display)return this.line.setAttribute("display","none"),0;if(this.line.setAttribute("display","block"),this.options.hideTicks)var s=0;else if(this.options.logScale)var s=this.drawLogTicks();else{this.options.scientificTicks&&(this.scientificExp=Math.floor(Math.log(Math.max(Math.abs(this.getActualMax()),Math.abs(this.getActualMin())))/Math.log(10)));var n=this.getNbTicksPrimary(),r=this.getUnitPerTick(i,n,e,this.getActualMax()),h=this.secondaryTicks();if(h)var h=h;var s=this.drawTicks(r,h)}var o;return(o=this.getLabel())&&(this.labelTspan.textContent=o,this.getExponentialLabelFactor()?(this.expTspan.nodeValue="x10",this.expTspanExp.nodeValue=this.getExponentialLabelFactor(),t=!0):this.options.scientificTicks?(this.expTspan.textContent="x10",this.expTspanExp.textContent=this.scientificExp,t=!0):t=!1,this.expTspan.setAttribute("display",t?"block":"none"),this.expTspanExp.setAttribute("display",t?"block":"none")),this.drawSpecifics(),this.options.lineAt0&&this.getActualMin()<0&&this.getActualMax()>0&&this._draw0Line(this.getPx(0)),s+(o?20:0)},setTickLabelRatio:function(t){this.options.ticklabelratio=t},draw:function(){this._widthLabels=0;var t=this._draw();return this._widthLabels+=t,t},drawTicks:function(t,i){var e,s,n,r=t[0],h=this.getActualMin(),o=this.getActualMax(),a=0;for(i&&(e=r/i),s=this.options.shiftToZero?this.dataMin-Math.ceil((this.dataMin-h)/r)*r:Math.floor(h/r)*r,this.incrTick=t[0],this.resetTicks();o>s&&(a++,!(a>200));){if(i){n=s+e;for(var l=0;s+r>n&&(l++,!(l>100));)h>n||n>o?n+=e:(this.drawTick(n,!1,Math.abs(n-s-r/2)<1e-4?3:2),n+=e)}h>s||s>o?s+=t[0]:(this.drawTick(s,!0,4),s+=t[0])}return this.widthHeightTick=this.getMaxSizeTick(),this.widthHeightTick},resetTicks:function(){},secondaryTicks:function(){return this.options.nbTicksSecondary},drawLogTicks:function(){var t=this.getActualMin(),i=this.getActualMax(),e=Math.min(t,i),i=Math.max(t,i),s={fontSize:"1.0em",exponential:!0,overwrite:!1};0>e&&(e=0);for(var n,r=0==e?0:Math.floor(Math.log(e)/Math.log(10)),e=1;(n=e*Math.pow(10,r))<i;)1==e&&n>t&&this.drawTick(n,!0,5,s),10==e?(e=1,r++):(1!=e&&n>t&&this.drawTick(n,!0,2,{overwrite:e,fontSize:"0.6em"}),e++);return 5},getPx:function(t){return this.getPos(t)},getPos:function(t){if(this.options.logScale){if(0>t)return;var t=(Math.log(t)-Math.log(this.getActualMin()))/(Math.log(this.getActualMax())-Math.log(this.getActualMin()))*(this.getMaxPx()-this.getMinPx())+this.getMinPx();return t}return(t-this.getActualMin())/this._getActualInterval()*(this.getMaxPx()-this.getMinPx())+this.getMinPx()},getRelPx:function(t){return t/this._getActualInterval()*(this.getMaxPx()-this.getMinPx())},getRelVal:function(t){return t/(this.getMaxPx()-this.getMinPx())*this._getActualInterval()},getVal:function(t){return(t-this.getMinPx())/(this.getMaxPx()-this.getMinPx())*this._getActualInterval()+this.getActualMin()},valueToText:function(t){if(this.options.scientificTicks)return t/=Math.pow(10,this.scientificExp),t.toFixed(1);if(t=t*Math.pow(10,this.getExponentialFactor())*Math.pow(10,this.getExponentialLabelFactor()),this.options.shiftToZero&&(t-=this.dataMin),this.options.ticklabelratio&&(t*=this.options.ticklabelratio),this.options.unitModification)return t=this.modifyUnit(t,this.options.unitModification);var i=this.decimals-this.getExponentialFactor()-this.getExponentialLabelFactor();return t.toFixed(i>0?i:0)},getModifiedValue:function(t){return this.options.ticklabelratio&&(t*=this.options.ticklabelratio),this.options.shiftToZero&&(t-=this.getMinValue()*(this.options.ticklabelratio||1)),t},modifyUnit:function(t,i){switch(i){case"time":var e=this.getModifiedValue(this.getMaxValue()),s=[[60,"min"],[3600,"h"],[86400,"d"]];3600>e?umin=0:86400>e?umin=1:2592e3>e&&(umin=2)}var n,r=this.incrTick,h="";for(t/=s[umin][0],n=Math.floor(t),h=n+s[umin][1],umin--;r<1*s[umin+1][0]&&umin>-1;)first=!1,t=(t-n)*s[umin+1][0]/s[umin][0],n=Math.round(t),h+=" "+n+s[umin][1],umin--;return h},getExponentialFactor:function(){return this.options.exponentialFactor},setExponentialFactor:function(t){this.options.exponentialFactor=t},setExponentialLabelFactor:function(t){this.options.exponentialLabelFactor=t},getExponentialLabelFactor:function(){return this.options.exponentialLabelFactor},setLabel:function(t){return this.options.labelValue=t,this},getLabel:function(){return this.options.labelValue},setShift:function(t,i){this.shift=t,this.totalDimension=i,this._setShift()},getShift:function(){return this.shift},setTickPosition:function(t){switch(t){case 3:case"outside":t=3;break;case 2:case"centered":t=2;break;default:case 1:case"inside":t=1}return this.options.tickPosition=t,this},togglePrimaryGrid:function(t){return this.options.primaryGrid=t,this},toggleSecondaryGrid:function(t){return this.options.secondaryGrid=t,this},doGridLine:function(t,i,e,s,n){var r=document.createElementNS(this.graph.ns,"line");r.setAttribute("shape-rendering","crispEdges"),r.setAttribute("y1",s),r.setAttribute("y2",n),r.setAttribute("x1",i),r.setAttribute("x2",e),r.setAttribute("stroke",t?this.getColorPrimaryGrid():this.getColorSecondaryGrid()),this.groupGrids.appendChild(r)},getColorPrimaryGrid:function(){return"#c0c0c0"},getColorSecondaryGrid:function(){return"#f0f0f0"},setTickContent:function(t,i,e){if(e||(e={}),e.overwrite||!e.exponential)t.textContent=e.overwrite||this.valueToText(i);else{var s=Math.round(Math.log(i)/Math.log(10)),n=Math.floor(i*Math.pow(10,-s));t.textContent=1!=n?n+"x10":"10";var r=document.createElementNS(this.graph.ns,"tspan");r.textContent=s,r.setAttribute("font-size","0.7em"),r.setAttribute("dy",-3),t.appendChild(r)}e.fontSize&&t.setAttribute("font-size",e.fontSize)},removeSerie:function(t){this.series.splice(this.series.indexOf(t),1)},killSeries:function(t){for(var i=0;i<this.series.length;i++)this.series[i].kill(t);this.series=[]},removeSeries:function(){this.killSeries()},handleMouseOutLocal:function(){for(var t=0,i=this.series.length;i>t;t++)this.series[t].hideTrackingMarker()}},i}),define("graph.axis.x",["require","jquery","./graph.axis"],function(t,i,e){var s=function(t,i,e){this.init(t,e),this.top="top"==i};return i.extend(s.prototype,e.prototype,{getAxisPosition:function(){if(!this.options.display)return 0;var t=(1==this.options.tickPosition?15:25)+2*this.graph.options.fontSize;return this.options.allowedPxSerie&&this.series.length>0&&(t+=this.options.allowedPxSerie),t},getAxisWidthHeight:function(){},_setShift:function(){this.group.setAttribute("transform","translate(0 "+(this.top?this.shift:this.graph.getDrawingHeight()-this.shift)+")")},getMaxSizeTick:function(){return(this.top?-1:1)*(1==this.options.tickPosition?10:10)},drawTick:function(t,i,e,s){var n=(this.groupTicks,document.createElementNS(this.graph.ns,"line")),r=this.getPos(t);if(void 0!=r){if(n.setAttribute("shape-rendering","crispEdges"),n.setAttribute("x1",r),n.setAttribute("x2",r),n.setAttribute("y1",(this.top?1:-1)*this.tickPx1*e),n.setAttribute("y2",(this.top?1:-1)*this.tickPx2*e),i&&this.options.primaryGrid?this.doGridLine(!0,r,r,0,this.graph.getDrawingHeight()):!i&&this.options.secondaryGrid&&this.doGridLine(!1,r,r,0,this.graph.getDrawingHeight()),n.setAttribute("stroke","black"),this.groupTicks.appendChild(n),i){var h=(this.groupTickLabels,document.createElementNS(this.graph.ns,"text"));h.setAttribute("x",r),h.setAttribute("y",(this.top?-1:1)*((1==this.options.tickPosition?8:20)+(this.top?10:0))),h.setAttribute("text-anchor","middle"),h.style.dominantBaseline="hanging",this.setTickContent(h,t,s),this.graph.applyStyleText(h),this.groupTickLabels.appendChild(h)}this.ticks.push(n)}},drawSpecifics:function(){this.label.setAttribute("text-anchor","middle"),this.label.setAttribute("x",Math.abs(this.getMaxPx()-this.getMinPx())/2+this.getMinPx()),this.label.setAttribute("y",(this.top?-1:1)*((1==this.options.tickPosition?10:15)+this.graph.options.fontSize)),this.line.setAttribute("x1",this.getMinPx()),this.line.setAttribute("x2",this.getMaxPx()),this.line.setAttribute("y1",0),this.line.setAttribute("y2",0),this.labelTspan.style.dominantBaseline="hanging",this.expTspan.style.dominantBaseline="hanging",this.expTspanExp.style.dominantBaseline="hanging"},drawSeries:function(){if(this.shift){this.rectEvent.setAttribute("y",this.top?-this.shift:0),this.rectEvent.setAttribute("height",this.totalDimension),this.rectEvent.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.rectEvent.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx())),this.clipRect.setAttribute("y",this.top?-this.shift:0),this.clipRect.setAttribute("height",this.totalDimension),this.clipRect.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.clipRect.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx()));for(var t=0,i=this.series.length;i>t;t++)this.series[t].draw()}},_draw0Line:function(t){this._0line=document.createElementNS(this.graph.ns,"line"),this._0line.setAttribute("x1",t),this._0line.setAttribute("x2",t),this._0line.setAttribute("y1",0),this._0line.setAttribute("y2",this.getMaxPx()),this._0line.setAttribute("stroke","black"),this.groupGrids.appendChild(this._0line)},addSerie:function(t,i){var e=new GraphSerieAxisX(t,i);return e.setAxis(this),e.init(this.graph,t,i),e.autoAxis(),e.setXAxis(this),this.series.push(e),this.groupSeries.appendChild(e.groupMain),this.groupSeries.setAttribute("clip-path","url(#_clip"+this.axisRand+")"),e},handleMouseMoveLocal:function(t){t-=this.graph.getPaddingLeft(),this.mouseVal=this.getVal(t)},isXY:function(){return"x"}}),s}),define("graph.axis.y",["require","./graph.axis"],function(t,i){var e=function(t,i,e){this.init(t,e,{flipped:!0}),this.leftright=i,this.left="left"==i};return $.extend(e.prototype,i.prototype,{getAxisPosition:function(){var t=0;return this.options.display?(this.options.allowedPxSerie&&this.series.length>0&&(t=this.options.allowedPxSerie),t):0},getAxisWidthHeight:function(){return 15},resetTicks:function(){this.longestTick=[!1,0]},getMaxSizeTick:function(){return(this.longestTick[0]?this.longestTick[0].getComputedTextLength():0)+10},drawTick:function(t,i,e,s){var n,r=(this.groupTicks,this.getPos(t));if(void 0!=r){var h=document.createElementNS(this.graph.ns,"line");if(h.setAttribute("shape-rendering","crispEdges"),h.setAttribute("y1",r),h.setAttribute("y2",r),h.setAttribute("x1",(this.left?1:-1)*this.tickPx1*e),h.setAttribute("x2",(this.left?1:-1)*this.tickPx2*e),h.setAttribute("stroke","black"),i&&this.options.primaryGrid?this.doGridLine(!0,0,this.graph.getDrawingWidth(),r,r):!i&&this.options.secondaryGrid&&this.doGridLine(!1,0,this.graph.getDrawingWidth(),r,r),this.groupTicks.appendChild(h),i){{this.groupTickLabels}n=document.createElementNS(this.graph.ns,"text"),n.setAttribute("y",r),n.setAttribute("x",this.left?-10:10),this.left?n.setAttribute("text-anchor","end"):n.setAttribute("text-anchor","start"),n.style.dominantBaseline="central",this.graph.applyStyleText(n),this.setTickContent(n,t,s),this.groupTickLabels.appendChild(n),String(n).length>=this.longestTick[1]&&(this.longestTick[0]=n,this.longestTick[1]=String(n.textContent).length)}this.ticks.push(h)}},drawSpecifics:function(){this.label.setAttribute("transform","translate("+(this.left?1:-1)*(-this.widthHeightTick-8)+", "+(Math.abs(this.getMaxPx()-this.getMinPx())/2+Math.min(this.getMinPx(),this.getMaxPx()))+") rotate(-90)"),this.line.setAttribute("y1",this.getMinPx()),this.line.setAttribute("y2",this.getMaxPx()),this.line.setAttribute("x1",0),this.line.setAttribute("x2",0)},drawSeries:function(){if(this.shift){this.rectEvent.setAttribute("x",this.left?-this.shift:0),this.rectEvent.setAttribute("width",this.totalDimension),this.rectEvent.setAttribute("y",Math.min(this.getMinPx(),this.getMaxPx())),this.rectEvent.setAttribute("height",Math.abs(this.getMinPx()-this.getMaxPx())),this.clipRect.setAttribute("x",-this.shift),this.clipRect.setAttribute("width",this.totalDimension),this.clipRect.setAttribute("y",Math.min(this.getMinPx(),this.getMaxPx())),this.clipRect.setAttribute("height",Math.abs(this.getMinPx()-this.getMaxPx()));for(var t=0,i=this.series.length;i>t;t++)this.series[t].draw()}},_setShift:function(){var t=this.isLeft()?this.getShift():this.graph.getWidth()-this.graph.getPaddingRight()-this.graph.getPaddingLeft()-this.getShift();this.group.setAttribute("transform","translate("+t+" 0)")},isLeft:function(){return this.left},isRight:function(){return!this.left},flip:function(t){return this.options.flipped=!t,this},_draw0Line:function(t){this._0line=document.createElementNS(this.graph.ns,"line"),this._0line.setAttribute("y1",t),this._0line.setAttribute("y2",t),this._0line.setAttribute("x1",0),this._0line.setAttribute("x2",this.graph.getDrawingWidth()),this._0line.setAttribute("stroke","black"),this.groupGrids.appendChild(this._0line)},addSerie:function(t,i){var e=new GraphSerieAxisY(t,i);return e.init(this.graph,t,i),e.setAxis(this),e.autoAxis(),e.setYAxis(this),this.series.push(e),this.groupSeries.appendChild(e.groupMain),this.groupSeries.setAttribute("clip-path","url(#_clip"+this.axisRand+")"),e},handleMouseMoveLocal:function(t,i){i-=this.graph.getPaddingTop(),this.mouseVal=this.getVal(i)},scaleToFitAxis:function(t,i,e){for(var s=0,n=0,r=this.graph.series.length;r>n;n++)this.graph.series[n].getXAxis()==t&&(s=Math.max(s,this.graph.series[n].getMax(i,e)));this._doZoomVal(0,s)},isXY:function(){return"y"}}),e}),define("graph._serie",[],function(){var t=function(){throw"This serie is not instanciable"};return t.prototype={setAdditionalData:function(t){return this.additionalData=t,this},getAdditionalData:function(){return this.additionalData},kill:function(t){if(this.graph.plotGroup.removeChild(this.groupMain),this.picks&&this.picks.length)for(var i=0,e=this.picks.length;e>i;i++)this.picks[i].kill();this.graph.series.splice(this.graph.series.indexOf(this),1),t||this.graph.redraw()},isMinOrMax:function(t,i,e){return void 0==t?this._isMinOrMax.x.min||this._isMinOrMax.x.max||this._isMinOrMax.y.min||this._isMinOrMax.y.max:void 0==e&&void 0!=i?(this._isMinOrMax[i].min=t,void(this._isMinOrMax[i].max=t)):void(void 0!=i&&void 0!=e&&(this._isMinOrMax[i][e]=t))},hide:function(){this.shown=!1,this.groupMain.setAttribute("display","none"),this.getSymbolForLegend().setAttribute("opacity",.5),this.getTextForLegend().setAttribute("opacity",.5)},show:function(){this.shown=!0,this.groupMain.setAttribute("display","block"),this.getSymbolForLegend().setAttribute("opacity",1),this.getTextForLegend().setAttribute("opacity",1)},toggleShow:function(){return this.shown?void this.hide():void this.show()},isShown:function(){return this.shown},getX:function(t){return Math.round(5*this.getXAxis().getPx(t))/5},getY:function(t){return Math.round(5*this.getYAxis().getPx(t))/5},isSelected:function(){return this.selected},_checkX:function(t){this.minX=Math.min(this.minX,t),this.maxX=Math.max(this.maxX,t)},_checkY:function(t){this.minY=Math.min(this.minY,t),this.maxY=Math.max(this.maxY,t)},getName:function(){return this.name},autoAxis:function(){return this.setXAxis(this.isFlipped()?this.graph.getYAxis():this.graph.getXAxis()),this.setYAxis(this.isFlipped()?this.graph.getXAxis():this.graph.getYAxis()),this.graph.updateAxes(),this},setXAxis:function(t){return this.xaxis="Number"==typeof t?this.isFlipped()?this.graph.getYAxis(t):this.graph.getXAxis(t):t,this},setYAxis:function(t){return"Number"==typeof t?this.xaxis=this.isFlipped()?this.graph.getXAxis(t):this.graph.getYAxis(t):this.yaxis=t,this},getXAxis:function(){return this.xaxis},getYAxis:function(){return this.yaxis},setAxes:function(){for(var t=0;2>t;t++)arguments[t]&&this["x"==arguments[t].isXY()?"setXAxis":"setYAxis"](arguments[t]);return this},getMinX:function(){return this.minX},getMaxX:function(){return this.maxX},getMinY:function(){return this.minY},getMaxY:function(){return this.maxY},getSymbolForLegend:function(){if(!this.lineForLegend){var t=document.createElementNS(this.graph.ns,"line");this.applyLineStyle(t),t.setAttribute("x1",5),t.setAttribute("x2",25),t.setAttribute("y1",0),t.setAttribute("y2",0),t.setAttribute("cursor","pointer"),this.lineForLegend=t}return this.lineForLegend},getTextForLegend:function(){if(!this.textForLegend){var t=document.createElementNS(this.graph.ns,"text");t.setAttribute("transform","translate(35, 3)"),t.setAttribute("cursor","pointer"),t.textContent=this.getLabel(),this.textForLegend=t}return this.textForLegend},getLabel:function(){return this.options.label||this.name},setLabel:function(t){return this.options.label=t,this},setFlip:function(t){this.options.flip=t},getFlip:function(){return this.options.flip},isFlipped:function(){return this.options.flip}},t}),define("graph.serie",[require,"./graph._serie"],function(t,i){var e=function(){};return $.extend(e.prototype,i.prototype,{defaults:{lineColor:"black",lineStyle:1,flip:!1,label:"",markers:{show:!1,type:1,zoom:1,strokeColor:!1,strokeWidth:1,fillColor:"transparent"},trackMouse:!1,trackMouseLabel:!1,trackMouseLabelRouding:1,lineToZero:!1,lineWidth:1,autoPeakPicking:!1,autoPeakPickingNb:4,autoPeakPickingMinDistance:10},init:function(t,i,s){var n=this;this.graph=t,this.name=i,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},e.prototype.defaults,s),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupLines=document.createElementNS(this.graph.ns,"g"),this.domMarker=document.createElementNS(this.graph.ns,"path"),this.domMarker.style.cursor="pointer",this.groupMain=document.createElementNS(this.graph.ns,"g"),this.additionalData={},this.domMarker.addEventListener("mouseover",function(t){var i=n._getMarkerIndexFromEvent(t);n.onMouseOverMarker(t,i)}),this.domMarker.addEventListener("mouseout",function(t){var i=n._getMarkerIndexFromEvent(t);n.onMouseOutMarker(t,i)}),this.domMarker.addEventListener("click",function(t){var i=n._getMarkerIndexFromEvent(t);n.onClickOnMarker(t,i)}),this.marker=document.createElementNS(this.graph.ns,"circle"),this.marker.setAttribute("fill","black"),this.marker.setAttribute("r",3),this.marker.setAttribute("display","none"),this.markerLabel=document.createElementNS(this.graph.ns,"text"),this.markerLabelSquare=document.createElementNS(this.graph.ns,"rect"),this.markerLabelSquare.setAttribute("fill","white"),this.domMarkerHover={},this.domMarkerSelect={},this.markerHovered=0,this.groupMarkerSelected=document.createElementNS(this.graph.ns,"g"),this.groupLabels=document.createElementNS(this.graph.ns,"g"),this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.lines=[],this.groupMain.appendChild(this.groupLines),this.groupMain.appendChild(this.groupLabels),this.groupMain.appendChild(this.marker),this.groupMain.appendChild(this.domMarker),this.groupMain.appendChild(this.groupMarkerSelected),this.groupMain.appendChild(this.markerLabelSquare),this.groupMain.appendChild(this.markerLabel),this.labels=[],this.currentAction=!1,this.initExtended1&&this.initExtended1()},setData:function(t,i,e){var s,n,r,h,o=0,i=i||"2D",e=e||"float",a=0;if(!(!t instanceof Array)){var l=[];t instanceof Array||"object"!=typeof t?t instanceof Array&&!(t[0]instanceof Array)&&(t=[t],i="1D"):t=[t];var u="2D"==i;if(t[0]instanceof Array&&"2D"==i&&!(t[0][0]instanceof Array)&&(t=[t]),t[0]instanceof Array)for(var d=0,g=t.length;g>d;d++){r=this._addData(e,u?2*t[d].length:t[d].length),l.push(r),o=0;for(var c=0,p=t[d].length;p>c;c++)u?(r[o]=t[d][c][0],this._checkX(r[o]),o++,r[o]=t[d][c][1],this._checkY(r[o]),o++,a++):(r[o]=t[d][c],this[c%2==0?"_checkX":"_checkY"](r[o]),o++,a+=c%2?1:0)}else if("object"==typeof t[0]){this.mode="x_equally_separated";for(var f,x=0,m=[],l=[],g=0,d=0,p=t.length;p>d;d++)x+=t[d].y.length,h=0!=d&&(!t[d+1]||t[d].x+t[d].dx*t[d].y.length==t[d+1].x),h||(l.push(this._addData(e,x)),m.push(x),x=0);this.xData=[],x=0,g=0,o=0;for(var d=0,p=t.length;p>d;d++){s=t[d].x,n=t[d].dx,this.xData.push({x:s,dx:n}),f=t[d].y.length,this._checkX(s),this._checkX(s+n*f);for(var c=0;f>c;c++)l[g][o]=t[d].y[c],this._checkY(l[g][o]),o++,a++;x+=t[d].y.length,m[g]==x&&(g++,x=0,o=0)}}var b=((this.maxX-this.minX)/this.graph.getDrawingWidth(),[]),v=4*this.graph.getDrawingWidth(),A=a/4,v=this.graph.getDrawingWidth(),A=a;if(this.data=l,v>0){for(;A>v;)b.push(v),v*=4;this.slots=b,this.options.useSlots&&this.calculateSlots()}if(this.isFlipped()){var M=this.maxX,k=this.maxY,y=this.minX,S=this.minY;this.maxX=k,this.maxY=M,this.minX=S,this.minY=y}return this.graph.updateAxes(),this}},_addData:function(t,i){switch(t){case"int":var e=4*i;break;case"float":var e=8*i}var s=new ArrayBuffer(e);switch(t){case"int":return new Int32Array(s);default:case"float":return new Float64Array(s)}},setAdditionalData:function(t){return this.additionalData=t,this},getAdditionalData:function(){return this.additionalData},calculateSlots:function(){var t=this;this.slotsData={},this.slotWorker=new Worker("./src/slotworker.js"),this.slotWorker.onmessage=function(i){t.slotsData[i.data.slot].resolve(i.data.data)};for(var i=0,e=this.slots.length;e>i;i++)this.calculateSlot(this.slots[i],i)},slotCalculator:function(t,i){var e=$.Deferred();return this.slotWorker.postMessage({min:this.minX,max:this.maxX,data:this.data,slot:t,slotNumber:i,flip:this.getFlip()}),e},calculateSlot:function(t,i){var e=this;this.slotsData[t]=this.slotCalculator(t,i),this.slotsData[t].pipe(function(i){return e.slotsData[t]=i,i})},kill:function(t){if(this.graph.plotGroup.removeChild(this.groupMain),this.picks&&this.picks.length)for(var i=0,e=this.picks.length;e>i;i++)this.picks[i].kill();this.graph.series.splice(this.graph.series.indexOf(this),1),t||this.graph.redraw()},onMouseOverMarker:function(t,i){this.toggleMarker(i,!0,!0);this.options.onMouseOverMarker&&this.options.onMouseOverMarker(i,this.infos?this.infos[i[0]]||!1:!1,[this.data[i[1]][2*i[0]],this.data[i[1]][2*i[0]+1]])},onMouseOutMarker:function(t,i){this.markersOffHover(),this.options.onMouseOutMarker&&this.infos&&this.options.onMouseOutMarker(i,this.infos?this.infos[i[0]]||!1:!1,[this.data[i[1]][2*i[0]],this.data[i[1]][2*i[0]+1]])},toggleMarker:function(t,i,e){var s=t[0],n=t[1]||0;t=t.join();var r=e?!this.domMarkerHover[t]:!this.domMarkerSelect[t],h=this["domMarker"+(e?"Hover":"Select")];if(r||i===!0&&i!==!1){if(!h[t]){var o=document.createElementNS(this.graph.ns,"path");this.setMarkerStyleTo(o,!0);var a=this.getX(this.data[n][2*s]),l=this.getY(this.data[n][2*s+1]);o.setAttribute("d","M "+a+" "+l+" "+this.getMarkerPath(this.options.markers.zoom+1).join(" ")),this["domMarker"+(e?"Hover":"Select")][t]=o,this.groupMarkerSelected.appendChild(o),e&&this.markerHovered++}}else if((i===!1||!r)&&(e&&this.domMarkerHover[t]&&!this.domMarkerSelect[t]||this.domMarkerSelect[t])){if(!h[t])return;this.groupMarkerSelected.removeChild(h[t]),delete h[t],e&&this.markerHovered--}return r},markersOffHover:function(){for(var t in this.domMarkerHover)this.toggleMarker(t.split(","),!1,!0)
},onClickOnMarker:function(t,i){var e=this.toggleMarker(i);e&&this.options.onSelectMarker&&this.options.onSelectMarker(i,this.infos?this.infos[i[0]]||!1:!1),!e&&this.options.onUnselectMarker&&this.options.onUnselectMarker(i,this.infos?this.infos[i[0]]||!1:!1),this.options.onToggleMarker&&this.options.onToggleMarker(i,this.infos?this.infos[i[0]]||!1:!1,e)},_getMarkerIndexFromEvent:function(t){var i=this.graph.getXY(t);return this.searchIndexByPxXY(i.x-this.graph.getPaddingLeft(),i.y-this.graph.getPaddingTop())},onMouseWheel:function(){},empty:function(){for(var t=0,i=this.lines.length;i>t;t++)this.groupLines.removeChild(this.lines[t]);for(;this.groupMarkers.firstChild;)this.groupMarkers.removeChild(this.groupMarkers.firstChild)},select:function(){this.selected=!0;for(var t=0,i=this.lines.length;i>t;t++)this.applyLineStyle(this.lines[t]);this.applyLineStyle(this.getLineForLegend())},unselect:function(){this.selected=!1;for(var t=0,i=this.lines.length;i>t;t++)this.applyLineStyle(this.lines[t]);this.applyLineStyle(this.getLineForLegend())},draw:function(){var t,i,e,s,n,r,h,o,a=0,l=this.data.length,u=0,d=this;this.picks=this.picks||[];var g;if(this.options.autoPeakPicking)for(var c=0,h=this.options.autoPeakPickingNb;h>c;c++)g=this.graph.makeShape({type:"label",label:{text:"",position:{x:0},anchor:"middle"}}),g.setSerie(this),this.picks.push(g);this._drawn=!0;var p=this.groupLines.nextSibling;this.groupMain.removeChild(this.groupLines),this.groupMain.removeChild(this.domMarker),this.marker.setAttribute("display","none"),this.markerPath="",this._markerPath=this.getMarkerPath().join(" ");var f=0,x=1;this.isFlipped()&&(f=1,x=0);for(var m=0;l>a;a++)m+=this.data[a].length/2;a=0;var b,v,A=[],t=0;if(this.options.useSlots&&this.slots)for(var M=this.graph.getDrawingWidth()*(this.maxX-this.minX)/(this.getXAxis().getActualMax()-this.getXAxis().getActualMin()),t=0,v=this.slots.length;v>t;t++)if(M<this.slots[t]){b=this.slotsData[this.slots[t]];break}if(b)b.done?b.done(function(i){d.drawSlot(i,t)}):this.drawSlot(b,t);else if("x_equally_separated"==this.mode)for(;l>a;a++){for(o="M ",u=0,r=0,h=this.data[a].length;h>u;u+=1)this.isFlipped()?(e=this.getX(this.xData[a].x+u*this.xData[a].dx),i=this.getY(this.data[a][u])):(i=this.getX(this.xData[a].x+u*this.xData[a].dx),e=this.getY(this.data[a][u])),o=this._addPoint(o,i,e,r),r++;this._createLine(o,a,r)}else for(;l>a;a++){for(o="M ",u=0,r=0,h=this.data[a].length;h>u;u+=2)s=this.getX(this.data[a][u+f]),n=this.getY(this.data[a][u+x]),(s!=i||n!=e)&&(this.options.autoPeakPicking&&A.push([this.data[a][u+x],this.data[a][u+f]]),o=this._addPoint(o,s,n,r),r++,i=s,e=n);this._createLine(o,a,r)}for(this.options.autoPeakPicking&&this.makePeakPicking(A),a++;a<this.lines.length;a++)this.groupLines.removeChild(this.lines[a]),this.lines.splice(a,1);this.setMarkerStyleTo(this.domMarker),this.domMarker.setAttribute("d",this.markerPath||"M 0 0"),this.groupMain.appendChild(this.domMarker),this.groupMain.insertBefore(this.groupLines,p);for(var a=0,l=this.labels.length;l>a;a++)this.repositionLabel(this.labels[a])},drawSlot:function(t,i){var e=this.slots[i]/(this.maxX-this.minX),s="M ";k=0;var n,r,h,o=0,a=Math.floor((this.getXAxis().getActualMin()-this.minX)*e),l=Math.ceil((this.getXAxis().getActualMax()-this.minX)*e);for(h=a;l>=h;h++)t[h]&&(n=Math.floor(this.getX(t[h].x)),r=this.getY(t[h].max),this.options.autoPeakPicking&&allY.push([t[h].max,t[h].x]),s=this._addPoint(s,n,this.getY(t[h].start),k),s=this._addPoint(s,n,r,!1,!0),s=this._addPoint(s,n,this.getY(t[h].min)),s=this._addPoint(s,n,this.getY(t[h].stop),!1,!0),k++);this._createLine(s,o,k),o++,console.timeEnd("Slot")},setMarkerStyleTo:function(t,i){t.setAttribute("fill",i?"transparent":this.options.markers.fillColor||"transparent"),t.setAttribute("stroke",this.options.markers.strokeColor||this.getLineColor()),t.setAttribute("stroke-width",this.options.markers.strokeWidth)},makePeakPicking:function(t){var i,e,e,s,n,r,h=[],o=0,a=t.length;for(t.sort(function(t,i){return i[0]-t[0]});a>o;o++)if(i=t[o][1],e=this.getX(i),s=0,n=h.length,r=this.getY(t[o][0]),!(e<this.getXAxis().getMinPx()||e>this.getXAxis().getMaxPx()||r>this.getYAxis().getMinPx()||r<this.getYAxis().getMaxPx())){for(;n>s&&!(Math.abs(h[s]-e)<this.options.autoPeakPickingMinDistance);s++);if(!(n>s)&&(this.picks[n].set("labelPosition",{x:i,dy:"-10px"}),this.picks[n].data.label[0].text=String(Math.round(1e3*i)/1e3),h.push(e),h.length==this.options.autoPeakPickingNb))break}this.graph.redrawShapes()},hideTrackingMarker:function(){this.marker.setAttribute("display","none"),this.markerLabel.setAttribute("display","none"),this.markerLabelSquare.setAttribute("display","none")},_addPoint:function(t,i,e,s,n){var r;return 0!==s&&(t+=this.options.lineToZero||n?"M ":"L "),t+=i,t+=" ",t+=e,t+=" ",this.options.lineToZero&&void 0!==(r=this.getYAxis().getPos(0))&&(t+="L ",t+=i,t+=" ",t+=r,t+=" "),this.options.markers.show?(i>this.getXAxis().getMaxPx()||i<this.getXAxis().getMinPx()||this._drawMarkerXY(i,e),t):t},_createLine:function(t,i,e){if(this.lines[i])var s=this.lines[i];else{var s=document.createElementNS(this.graph.ns,"path");this.applyLineStyle(s)}return 0==e?s.setAttribute("d","M 0 0"):s.setAttribute("d",t),this.lines[i]||(this.groupLines.appendChild(s),this.lines[i]=s),s},applyLineStyle:function(t){t.setAttribute("stroke",this.getLineColor()),t.setAttribute("stroke-width",this.getLineWidth()+(this.isSelected()?2:0)),this.getLineDashArray()&&t.setAttribute("stroke-dasharray",this.getLineDashArray()),t.setAttribute("fill","none")},getMarkerPath:function(t,i){var e,s=t||this.options.markers.zoom,i=i||0;switch(this.options.markers.type){case 1:e=["m",-2,-2,"l",4,0,"l",0,4,"l",-4,0,"z"];break;case 2:e=["m",-2,-2,"l",4,4,"l",-4,0,"l",4,-4,"z"]}if(!(1!=s&&s||i))return e;for(var n="number",r=0,h=e.length;h>r;r++)typeof e[r]==n&&(e[r]*=s);return e},_drawMarkerXY:function(t,i){this.options.markers.show&&(this.markerPath+="M "+t+" "+i+" ",this.markerPath+=this._markerPath+" ")},handleLabelMove:function(t,i){var e=this.labelDragging;e&&(e.labelX+=t-e.draggingIniX,e.draggingIniX=t,e.labelY+=i-e.draggingIniY,e.draggingIniY=i,e.rect.setAttribute("x",e.labelX),e.rect.setAttribute("y",e.labelY-this.graph.options.fontSize),e.labelDom.setAttribute("x",e.labelX),e.labelDom.setAttribute("y",e.labelY),e.labelLine.setAttribute("x1",e.labelX+e.labelDom.getComputedTextLength()/2),e.labelLine.setAttribute("y1",e.labelY-this.graph.options.fontSize/2))},handleLabelMainMove:function(t){var i=this.labelDragging;i.x=this.getXAxis().getVal(t-this.graph.options.paddingLeft),i.y=this.handleMouseMove(i.x,!1).interpolatedY,this.repositionLabel(i,!0)},handleLabelUp:function(){this.labelDragging=!1},searchIndexByPxXY:function(t,i){for(var e,s=!1,n=!1,r=0,h=this.data.length;h>r;r++)for(var o=0,a=this.data[r].length;a>o;o+=2)e=Math.pow(this.getX(this.data[r][o])-t,2)+Math.pow(this.getY(this.data[r][o+1])-i,2),(!s||s>e)&&(s=e,n=[o/2,r]);return n},searchClosestValue:function(t){for(var i,e=0;e<this.data.length;e++){if(t<=this.data[e][this.data[e].length-2]&&t>this.data[e][0])i=this._searchBinary(t,this.data[e],!1);else{if(!(t>=this.data[e][this.data[e].length-2]&&t<this.data[e][0]))continue;i=this._searchBinary(t,this.data[e],!0)}return{dataIndex:e,xMin:this.data[e][i],xMax:this.data[e][i+2],yMin:this.data[e][i+1],yMax:this.data[e][i+3],xBeforeIndex:i/2,xAfterIndex:i/2+2,xBeforeIndexArr:i}}},handleMouseMove:function(t,i){var e,s=t||this.getXAxis().getMouseVal(),n=this.searchClosestValue(s);if(n){var r=(s-n.xMin)/(n.xMax-n.xMin),h=(1-r)*n.yMin+r*n.yMax;if(i&&this.options.trackMouse){if(!e)return!1;var t=this.getX(this.getFlip()?h:s),o=this.getY(this.getFlip()?s:h);switch(this.marker.setAttribute("display","block"),this.marker.setAttribute("cx",t),this.marker.setAttribute("cy",o),this.markerLabel.setAttribute("display","block"),this.markerLabelSquare.setAttribute("display","block"),this.options.trackMouseLabel){case!1:break;default:this.markerLabel.textContent=this.options.trackMouseLabel.replace("<x>",s.toFixed(this.options.trackMouseLabelRouding)).replace("<y>",h.toFixed(this.options.trackMouseLabelRouding))}this.markerLabel.setAttribute("x",t+5),this.markerLabel.setAttribute("y",o-5),this.markerLabelSquare.setAttribute("x",t+5),this.markerLabelSquare.setAttribute("y",o-5-this.graph.options.fontSize),this.markerLabelSquare.setAttribute("width",this.markerLabel.getComputedTextLength()+2),this.markerLabelSquare.setAttribute("height",this.graph.options.fontSize+2)}return{xBefore:n.xMin,xAfter:n.xMax,yBefore:n.yMin,yAfter:n.yMax,trueX:s,interpolatedY:h,xBeforeIndex:n.xBeforeIndex}}},_searchBinary:function(t,i,e){var s=0,n=i.length,r=n-2;if(i[s]==t)return s;if(i[r]==t)return r;for(var h,o=0;;){if(o++,o>100)throw"Error loop";if(h=(s+r)/2,h-=h%2,h==s||i[h]==t)return h;i[h]<=t?e?r=h:s=h:i[h]>t&&(e?s=h:r=h)}},getMax:function(t,i){var e,s,n,r,h=Math.min(t,i),o=Math.max(t,i),a=this.searchClosestValue(h),l=this.searchClosestValue(o),u=0;for(e=a.dataIndex;e<=l.dataIndex;e++)for(n=e==a.dataIndex?a.xBeforeIndexArr:0,r=e==l.dataIndex?l.xBeforeIndexArr:this.data[e].length,s=n;r>=s;s+=2)u=Math.max(u,this.data[e][s+1]);return u},setLineStyle:function(t){this.options.lineStyle=t},getLineStyle:function(){return this.options.lineStyle},getLineDashArray:function(){switch(this.options.lineStyle){case 2:return"5, 5";case!1:case 1:return!1;default:return this.options.lineStyle}},setLineWidth:function(t){return this.options.lineWidth=t,this},getLineWidth:function(){return this.options.lineWidth},setLineColor:function(t){return this.options.lineColor=t,this},getLineColor:function(){return this.options.lineColor},showMarkers:function(t){return this.options.markers.show=!0,!t&&this._drawn&&this.draw(),this},hideMarkers:function(t){return this.options.markers.show=!1,!t&&this._drawn&&this.draw(),this},markersShown:function(){return this.options.markers.show},setMarkerType:function(t,i){return this.options.markers.type=t,!i&&this._drawn&&this.draw(),this},setMarkerZoom:function(t,i){return this.options.markers.zoom=t,!i&&this._drawn&&this.draw(),this},setMarkerStrokeColor:function(t,i){this.options.markers.strokeColor=t,!i&&this._drawn&&this.draw()},setMarkerStrokeWidth:function(t,i){this.options.markers.strokeWidth=t,!i&&this._drawn&&this.draw()},setMarkerFillColor:function(t,i){this.options.markers.fillColor=t,!i&&this._drawn&&this.draw()},addLabelX:function(t,i){this.addLabelObj({x:t,label:i})},addLabel:function(t,i,e){this.addLabelObj({x:t,y:i,label:e})},repositionLabel:function(t,i){var e=this.getFlip()?this.getY(t.x):this.getX(t.x),s=this.getFlip()?this.getX(t.y):this.getY(t.y),n=isNaN(e)||isNaN(s);t.group.setAttribute("display",n?"none":"block"),i&&(t.labelDom.textContent=this.options.label.replace("<x>",t.x.toFixed(this.options.trackMouseLabelRouding)||"").replace("<label>",t.label||""),t.rect.setAttribute("width",t.labelDom.getComputedTextLength()+2)),n||t.group.setAttribute("transform","translate("+e+" "+s+")")},addLabelObj:function(t){var i,e,s,n;this.labels.push(t),t.x&&!t.y&&(t.y=this.handleMouseMove(t.x,!1).interpolatedY),i=document.createElementNS(this.graph.ns,"g"),this.groupLabels.appendChild(i),e=document.createElementNS(this.graph.ns,"text"),e.setAttribute("x",5),e.setAttribute("y",-5);var r=document.createElementNS(this.graph.ns,"line");r.setAttribute("stroke","black"),r.setAttribute("x2",0),r.setAttribute("x1",0),i.appendChild(r),i.appendChild(e),s=document.createElementNS(this.graph.ns,"rect"),s.setAttribute("x",5),s.setAttribute("y",-this.graph.options.fontSize-5),s.setAttribute("width",e.getComputedTextLength()+2),s.setAttribute("height",this.graph.options.fontSize+2),s.setAttribute("fill","white"),s.style.cursor="move",e.style.cursor="move",n=document.createElementNS(this.graph.ns,"path"),n.setAttribute("d","M 0 -4 l 0 8 m -4 -4 l 8 0"),n.setAttribute("stroke-width","1px"),n.setAttribute("stroke","black"),n.style.cursor="move",i.insertBefore(s,e),i.appendChild(n),t.labelLine=r,t.group=i,t.rect=s,t.labelDom=e,t.path=n,t.labelY=-5,t.labelX=5,this.bindLabelHandlers(t),this.repositionLabel(t,!0)},bindLabelHandlers:function(t){function i(i){if(s.graph.currentAction===!1){s.graph.currentAction="labelDragging",i.stopPropagation(),t.dragging=!0;var e=s.graph.getXY(i);t.draggingIniX=e.x,t.draggingIniY=e.y,s.labelDragging=t}}function e(i){s.graph.currentAction===!1&&(i.stopPropagation(),i.preventDefault(),s.graph.currentAction="labelDraggingMain",s.labelDragging=t)}var s=this;t.labelDom.addEventListener("mousedown",i),t.rect.addEventListener("mousedown",i),t.rect.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),t.labelDom.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),t.path.addEventListener("mousedown",e),t.path.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()})},getMarkerForLegend:function(){if(this.markersShown()){if(!this.markerForLegend){var t=document.createElementNS(this.graph.ns,"path");this.setMarkerStyleTo(t,!0),t.setAttribute("d","M 14 0 "+this.getMarkerPath(this.options.markers.zoom+1).join(" ")),this.markerForLegend=t}return this.markerForLegend}}}),e}),define("graph.serie.contour",["require","./graph.serie"],function(t,i){var e=function(){this.accumulatedDelta=0,this.threshold=0};return $.extend(e.prototype,i.prototype,{setData:function(t,i,e){var s,n,e=e||"float",r=t.length,h=[];if(!(!t instanceof Array)){for(var s=0;r>s;s++){k=k=t[s].lines.length,n=this._addData(e,k);for(var o=0;k>o;o+=2)n[o]=t[s].lines[o],this._checkX(n[o]),n[o+1]=t[s].lines[o+1],this._checkY(n[o+1]);h.push({lines:n,zValue:t[s].zValue})}return this.data=h,this}},draw:function(){var t,i,e,s,n,r,h,o,a,l=0,u=this.data.length,d=0;this.minZ=-Number.MAX_VALUE,this.maxZ=Number.MAX_VALUE;var g=this.groupLines.nextSibling;this.groupMain.removeChild(this.groupLines),this.zValues={};var c=0,p=1;for(this.getFlip()&&(c=0,p=1);u>l;l++){for(d=0,n=0,h="",a=this.data[l].lines,r=a.length;r>d;d+=4)e=Math.round(this.getX(a[d+c])),s=Math.round(this.getY(a[d+p])),h+="M",h+=e,h+=" ",h+=s,t=Math.round(this.getX(a[d+2+c])),i=Math.round(this.getY(a[d+2+p])),h+="L",h+=t,h+=" ",h+=i,n++;o=this._createLine(h,l,n),o.setAttribute("data-zvalue",this.data[l].zValue),this.zValues[this.data[l].zValue]={dom:o},this.minZ=Math.max(this.minZ,this.data[l].zValue),this.maxZ=Math.min(this.maxZ,this.data[l].zValue)}for(l++;l<this.lines.length;l++)this.groupLines.removeChild(this.lines[l]),this.lines.splice(l,1);this.groupMain.insertBefore(this.groupLines,g)},onMouseWheel:function(t){this.accumulatedDelta=Math.min(1,Math.max(-1,this.accumulatedDelta+Math.min(.1,Math.max(-.1,t)))),this.threshold=Math.max(-this.minZ,this.maxZ)*Math.pow(this.accumulatedDelta,3);for(var i in this.zValues)this.zValues[i].dom.setAttribute("display",Math.abs(i)<this.threshold?"none":"block")}}),e}),define("graph.serie.scatter",[require,"./graph._serie"],function(t,i){var e=function(){};return $.extend(e.prototype,i.prototype,{defaults:{label:""},init:function(t,i,s){this.graph=t,this.name=i,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},e.prototype.defaults,s),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupPoints=document.createElementNS(this.graph.ns,"g"),this.groupMain=document.createElementNS(this.graph.ns,"g"),this.errorPath=document.createElementNS(this.graph.ns,"path"),this.errorPath.setAttribute("stroke","black"),this.errorPath.setAttribute("fill","transparent"),this.errorPath.setAttribute("stroke-width","1px"),this.groupMain.appendChild(this.errorPath),this.additionalData={},this.groupPoints.addEventListener("mouseover",function(){}),this.groupPoints.addEventListener("mouseout",function(){}),this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.groupMain.appendChild(this.groupPoints),this.currentAction=!1,this.initExtended1&&this.initExtended1(),this.stdStyle={shape:"circle",cx:0,cy:0,r:3,stroke:"transparent",fill:"black"}},setData:function(t,i,e){var s,n=0,i=i||"2D",e=e||"float",r=0;if(!(!t instanceof Array)){t instanceof Array&&!(t[0]instanceof Array)&&(i="1D");var h="2D"==i;s=this._addData(e,h?2*t.length:t.length),n=0;for(var o=0,a=t.length;a>o;o++)h?(s[n]=t[o][0],this._checkX(s[n]),n++,s[n]=t[o][1],this._checkY(s[n]),n++,r++):(s[n]=t[o],this[o%2==0?"_checkX":"_checkY"](s[n]),n++,r+=o%2?1:0);return this.graph.updateAxes(),this.data=s,this}},_addData:function(t,i){switch(t){case"int":var e=4*i;break;case"float":var e=8*i}var s=new ArrayBuffer(e);switch(t){case"int":return new Int32Array(s);default:case"float":return new Float64Array(s)}},empty:function(){for(;this.group.firstChild;)this.group.removeChild(this.group.firstChild)},select:function(){this.selected=!0},unselect:function(){this.selected=!1},setDataStyle:function(t,i){return this.stdStylePerso=t,this.extraStyle=i,this},draw:function(){var t,i,e,s,n=0;this._drawn=!0,this.groupMain.removeChild(this.groupPoints);var r=0,h=1;this.getFlip()&&(r=1,h=0);this.data.length/2;n=0,e=0,s=this.data.length;for(var o,a="";s>n;n+=2){t=this.getX(this.data[n+r]),i=this.getY(this.data[n+h]);{this.data[n+h]}(o=this.error[n/2])&&(a+="M "+t+" "+i,o[0]&&(a+=this.doErrorDraw("y",o[0],this.data[n+h],i,a)),o[1]&&(a+=this.doErrorDraw("x",o[1],this.data[n+r],t,a))),this._addPoint(t,i,n/2)}this.errorPath.setAttribute("d",a),this.groupMain.appendChild(this.groupPoints)},doErrorDraw:function(t,i,e,s,n){i instanceof Array||(i=[i]);for(var r="y"==t?"getY":"getX",h=0,o=i.length;o>h;h++)i[h]instanceof Array?(n=this.makeError(t,h,n,this[r](e+i[h][0]),s),n=this.makeError(t,h,n,this[r](e-i[h][1]),s)):(n=this.makeError(t,h,n,this[r](e+i[h]),s),n=this.makeError(t,h,n,this[r](e-i[h]),s));return n},setMaxErrorLevel:function(t){return this.maxLevel=t,this},makeError:function(t,i,e,s,n){if(i>=this.maxLevel)return e;var r=this.maxLevel-i;return 1==r?this["makeBar"+t.toUpperCase()](e,s,n):2==r?this["makeBox"+t.toUpperCase()](e,s,n):void 0},makeBarY:function(t,i,e){return t+" V "+i+" m -10 0 h 20 m -10 0 V "+e+" "},makeBoxY:function(t,i,e){return t+" h 5 V "+i+" h -10 V "+e+" h 5 "},makeBarX:function(t,i,e){return t+" H "+i+" m 0 -10 v 20 m 0 -10 H "+e+" "},makeBoxX:function(t,i,e){return t+" v 5 H "+i+" v -10 H "+e+" v 5 "},_addPoint:function(t,i,e){var s=document.createElementNS(this.graph.ns,"g");s.setAttribute("transform","translate("+t+", "+i+")"),this.extraStyle&&this.extraStyle[e]?this.doShape(s,this.extraStyle[e]):this.stdStylePerso?this.doShape(s,this.stdStylePerso):this.doShape(s,this.stdStyle),this.groupPoints.appendChild(s)},doShape:function(t,i){var e=document.createElementNS(this.graph.ns,i.shape);for(var s in i)"shape"!==s&&e.setAttribute(s,i[s]);t.appendChild(e)},setDataError:function(t){this.error=t}}),e}),define("graph.serie.zone",[require,"./graph._serie"],function(t,i){var e=function(){};return $.extend(e.prototype,i.prototype,{defaults:{label:"",fillColor:"rgba( 0, 0, 0, 0.1 )",lineColor:"rgba( 0, 0, 0, 1 )",lineWidth:"1px"},init:function(t,i,s){this.graph=t,this.name=i,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},e.prototype.defaults,s),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupZones=document.createElementNS(this.graph.ns,"g"),this.groupMain=document.createElementNS(this.graph.ns,"g"),this.lineZone=document.createElementNS(this.graph.ns,"path"),this.lineZone.setAttribute("stroke","black"),this.lineZone.setAttribute("stroke-width","1px"),this.additionalData={},this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.groupMain.appendChild(this.groupZones),this.groupZones.appendChild(this.lineZone),this.currentAction=!1,this.initExtended1&&this.initExtended1()},setData:function(t,i,e){var s,n=0,i=i||"2D",e=e||"float",r=0;if(!(!t instanceof Array)){var h;t instanceof Array&&!(t[0]instanceof Array)?(i="1D",h=1.5*t.length,t[1]instanceof Array||(i="1D_flat",h=1*t.length)):t instanceof Array&&!(t[0][1]instanceof Array)?(i="2D_flat",h=3*t.length):(i="2D",h=3*t.length),s=this._addData(e,h),n=0;for(var o=0,a=t.length;a>o;o++)if("2D"==i||"2D_flat"==i)s[n]=t[o][0],this._checkX(s[n]),n++,"2D"==i?(s[n]=t[o][1][0],this._checkY(s[n]),n++,r++,s[n]=t[o][1][1],this._checkY(s[n]),n++,r++):(s[n]=t[o][1],this._checkY(s[n]),n++,r++,s[n]=t[o][2],this._checkY(s[n]),n++,r++);else if("1D_flat"==i){if(o%3==0){s[n]=t[o],this._checkX(s[n]),n++,r++;continue}s[n]=t[o],this._checkY(s[n]),n++,r++}else{if(o%2==0){s[n]=t[o],this._checkX(s[n]),n++,r++;continue}s[n]=t[o][0],this_checkY(s[n]),n++,r++,s[n]=t[o][1],this_checkY(s[n]),n++,r++}return this.graph.updateAxes(),this.data=s,this}},_addData:function(t,i){switch(t){case"int":var e=4*i;break;case"float":var e=8*i}var s=new ArrayBuffer(e);switch(t){case"int":return new Int32Array(s);default:case"float":return new Float64Array(s)}},empty:function(){for(;this.group.firstChild;)this.group.removeChild(this.group.firstChild)},select:function(){this.selected=!0},unselect:function(){this.selected=!1},setDataStyle:function(t,i){return this.stdStylePerso=t,this.extraStyle=i,this},draw:function(){var t,i,e,s,n,r=0;this._drawn=!0,this.groupMain.removeChild(this.groupZones);this.data.length/2;r=0,s=0,n=this.data.length;for(var h=[],o=[];n>r;r+=3)t=this.getX(this.data[r]),i=this.getY(this.data[r+1]),e=this.getY(this.data[r+2]),e>i?(h.push([t,i]),o.push([t,e])):(h.push([t,e]),o.push([t,i]));o.reverse(),this.lineZone.setAttribute("d","M "+h[0]+" L "+h.join(" L ")+" L "+o.join(" L ")+" z"),this.applyLineStyle(this.lineZone),this.groupMain.appendChild(this.groupZones)},applyLineStyle:function(t){t.setAttribute("stroke",this.getLineColor()),t.setAttribute("stroke-width",this.getLineWidth()),t.setAttribute("fill",this.getFillColor())},setLineWidth:function(t){return this.options.lineWidth=t,this},getLineWidth:function(){return this.options.lineWidth},setLineColor:function(t){return this.options.lineColor=t,this},getLineColor:function(){return this.options.lineColor},setFillColor:function(t){return this.options.fillColor=t,this},getFillColor:function(){return this.options.fillColor}}),e}),define("graph.legend",[],function(){var t={frame:!1,backgroundColor:"transparent",frameWidth:0,frameColor:"transparent",paddingTop:10,paddingLeft:10,paddingBottom:10,paddingRight:10,movable:!1},i=function(i,e){this.options=$.extend({},t,e),this.graph=i,this.svg=document.createElementNS(this.graph.ns,"g"),this.rect=document.createElementNS(this.graph.ns,"rect"),this.rectBottom=document.createElementNS(this.graph.ns,"rect"),this.rect.setAttribute("x",0),this.rect.setAttribute("y",0),this.rectBottom.setAttribute("x",0),this.rectBottom.setAttribute("y",0),this.pos={x:void 0,y:void 0,transformX:0,transformY:0},this.setEvents()};return i.prototype={setPosition:function(t,i,e){if(t){var s=this.graph.getPosition(t);"right"==i&&(s.x-=this.width),"bottom"==e&&(s.y-=this.height),this.pos.transformX=s.x,this.pos.transformY=s.y,this._setPosition()}},update:function(){var t=this;for(this.applyStyle();this.svg.hasChildNodes();)this.svg.removeChild(this.svg.lastChild);this.svg.appendChild(this.rectBottom);for(var i=this.graph.getSeries(),e=0,s=i.length;s>e;e++)!function(s){var n,r,h;n=document.createElementNS(t.graph.ns,"g"),n.setAttribute("transform","translate(0, "+(16*e+10+t.options.paddingTop)+")"),t.svg.appendChild(n);var r=i[s].getLineForLegend(),o=i[s].getMarkerForLegend(),h=i[s].getTextForLegend();n.appendChild(r),o&&n.appendChild(o),n.appendChild(h),n.addEventListener("click",function(){var e=i[s];e.isSelected()?(e.hide(),t.graph.unselectSerie(e)):e.isShown()?t.graph.selectSerie(e):e.show()})}(e);var n=this.svg.getBBox();this.width=n.width+this.options.paddingRight,this.height=n.height+this.options.paddingBottom,this.rect.setAttribute("width",this.width),this.rect.setAttribute("height",this.height),this.rect.setAttribute("fill","none"),this.rect.setAttribute("pointer-events","fill"),this.rect.setAttribute("display","none"),this.options.movable&&(this.rectBottom.style.cursor="move"),this.rectBottom.setAttribute("width",this.width),this.rectBottom.setAttribute("height",this.height),this.svg.appendChild(this.rect)},getDom:function(){return this.svg},setEvents:function(){var t=this,i=this.pos,e=function(e){t.options.movable&&(i.x=e.clientX,i.y=e.clientY,e.stopPropagation(),e.preventDefault(),t.mousedown=!0,t.graph.shapeMoving(t),t.rect.setAttribute("display","block"))},s=function(i){t.handleMouseMove(i)};this.rectBottom.addEventListener("mousedown",e),this.rectBottom.addEventListener("mousemove",s),this.rect.addEventListener("mousemove",s)},handleMouseUp:function(t){t.stopPropagation(),t.preventDefault(),this.mousedown=!1,this.rect.setAttribute("display","none"),this.graph.shapeStopMoving()},handleMouseMove:function(t){if(this.mousedown){var i=this.pos,e=t.clientX-i.x,s=t.clientY-i.y;i.transformX+=e,i.transformY+=s,i.x=t.clientX,i.y=t.clientY,t.stopPropagation(),t.preventDefault(),this._setPosition()}},_setPosition:function(){var t=this.pos;this.svg.setAttribute("transform","translate("+t.transformX+", "+t.transformY+")")},applyStyle:function(){this.options.frame&&(this.rectBottom.setAttribute("stroke",this.options.frameColor),this.rectBottom.setAttribute("stroke-width",this.options.frameWidth+"px")),this.rectBottom.setAttribute("fill",this.options.backgroundColor)}},i}),define("graph",["jquery","require","./graph.axis.x","./graph.axis.y","./graph.serie","./graph.serie.contour","./graph.serie.scatter","./graph.serie.zone","./graph.legend"],function(t,i,e,s,n,r,h,o,a){function l(t){return t&&t.indexOf&&t.indexOf("px")>-1?parseInt(t.replace("px","")):!1}var u={paddingTop:30,paddingBottom:5,paddingLeft:20,paddingRight:20,close:{left:!0,right:!0,top:!0,bottom:!0},title:"",lineToZero:!1,fontSize:12,fontFamily:"Myriad Pro, Helvetica, Arial",addLabelOnClick:!1,onVerticalTracking:!1,onHorizontalTracking:!1,rangeLimitX:10,rangeLimitY:0,plugins:[],pluginAction:{},wheel:{},dblclick:{}},d=function(i,n,r){this._creation=Date.now()+Math.random(),"string"==typeof i&&(i=document.getElementById(i)),this.options=t.extend({},u,n),this.axis={left:[],top:[],bottom:[],right:[]},this.title=!1,this.shapes=[],this.shapesLocked=!1,this.ns="http://www.w3.org/2000/svg",this.nsxlink="http://www.w3.org/1999/xlink",this.series=[],this._dom=i,this.doDom(),this.setSize(t(i).width(),t(i).height()),this._resize(),this.registerEvents(),this.trackingLines={id:0,current:!1,dasharray:[!1,"5, 5","5, 1","1, 5"],currentDasharray:[],vertical:[],horizontal:[]},this.shapeHandlers={mouseDown:[],mouseUp:[],mouseMove:[],mouseOver:[],mouseOut:[]},this.pluginsReady=t.Deferred(),this.currentAction=!1;var h;if(r)for(var o in r)for(var a=0,l=r[o].length;l>a;a++){switch(o){case"top":h="setTopAxis";var d=new e(this,"top",r[o][a]);break;case"bottom":h="setBottomAxis";var d=new e(this,"bottom",r[o][a]);break;case"left":h="setLeftAxis";var d=new s(this,"left",r[o][a]);break;case"right":h="setRightAxis";var d=new s(this,"right",r[o][a])}this[h](d,a)}this._pluginsInit()};return d.prototype={setAttributeTo:function(t,i,e){var s;if(e)for(s in i)t.setAttributeNS(e,s,i[s]);else for(s in i)t.setAttribute(s,i[s])},doDom:function(){this.dom=document.createElementNS(this.ns,"svg"),this.dom.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.setAttributeTo(this.dom,{xmlns:this.ns,"font-family":this.options.fontFamily,"font-size":this.options.fontSize}),this._dom.appendChild(this.dom),this._dom.setAttribute("tabindex",1),this._dom.style.outline="none",this.defs=document.createElementNS(this.ns,"defs"),this.dom.appendChild(this.defs),this.rectEvent=document.createElementNS(this.ns,"rect"),this.setAttributeTo(this.rectEvent,{"pointer-events":"fill",fill:"transparent"}),this.dom.appendChild(this.rectEvent),this.domTitle=document.createElementNS(this.ns,"text"),this.setTitle(this.options.title),this.setAttributeTo(this.domTitle,{"text-anchor":"middle",y:20}),this.dom.appendChild(this.domTitle),this.graphingZone=document.createElementNS(this.ns,"g"),this.setAttributeTo(this.graphingZone,{transform:"translate("+this.options.paddingLeft+", "+this.options.paddingTop+")"}),this.dom.appendChild(this.graphingZone),this.axisGroup=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.axisGroup),this.shapeZone=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.shapeZone),this.plotGroup=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.plotGroup),this._makeClosingLines(),this.clip=document.createElementNS(this.ns,"clipPath"),this.clip.setAttribute("id","_clipplot"+this._creation),this.defs.appendChild(this.clip),this.clipRect=document.createElementNS(this.ns,"rect"),this.clip.appendChild(this.clipRect),this.clip.setAttribute("clipPathUnits","userSpaceOnUse"),this.markerArrow=document.createElementNS(this.ns,"marker"),this.markerArrow.setAttribute("viewBox","0 0 10 10"),this.markerArrow.setAttribute("id","arrow"+this._creation),this.markerArrow.setAttribute("refX","0"),this.markerArrow.setAttribute("refY","5"),this.markerArrow.setAttribute("markerUnits","strokeWidth"),this.markerArrow.setAttribute("markerWidth","4"),this.markerArrow.setAttribute("markerHeight","3"),this.markerArrow.setAttribute("orient","auto");var t=document.createElementNS(this.ns,"path");t.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),t.setAttribute("fill","context-stroke"),this.markerArrow.appendChild(t),this.defs.appendChild(this.markerArrow),this.vertLineArrow=document.createElementNS(this.ns,"marker"),this.vertLineArrow.setAttribute("viewBox","0 0 10 10"),this.vertLineArrow.setAttribute("id","verticalline"+this._creation),this.vertLineArrow.setAttribute("refX","0"),this.vertLineArrow.setAttribute("refY","5"),this.vertLineArrow.setAttribute("markerUnits","strokeWidth"),this.vertLineArrow.setAttribute("markerWidth","20"),this.vertLineArrow.setAttribute("markerHeight","10"),this.vertLineArrow.setAttribute("orient","auto"),this.vertLineArrow.setAttribute("stroke-width","1px");var i=document.createElementNS(this.ns,"path");i.setAttribute("d","M 0 -10 L 0 10"),i.setAttribute("stroke","black"),this.vertLineArrow.appendChild(i),this.defs.appendChild(this.vertLineArrow),this.plotGroup.setAttribute("clip-path","url(#_clipplot"+this._creation+")"),this.bypassHandleMouse=!1},setOption:function(t,i){this.options[t]=i},kill:function(){this._dom.removeChild(this.dom)},getXY:function(i){var e=i.clientX,s=i.clientY,n=t(this._dom).offset();return e-=n.left-window.scrollX,s-=n.top-window.scrollY,{x:e,y:s}},registerEvents:function(){var t=this;this._dom.addEventListener("keydown",function(i){i.preventDefault(),i.stopPropagation(),8==i.keyCode&&t.selectedShape&&t.selectedShape.kill()}),this.dom.addEventListener("mousemove",function(i){i.preventDefault();var e=t.getXY(i);t.handleMouseMove(e.x,e.y,i)}),this.dom.addEventListener("mousedown",function(i){if(t.focus(),i.preventDefault(),3!=i.which&&!i.ctrlKey){var e=t.getXY(i);t.handleMouseDown(e.x,e.y,i)}}),this.dom.addEventListener("mouseup",function(i){i.preventDefault();var e=t.getXY(i);t.handleMouseUp(e.x,e.y,i)}),this.dom.addEventListener("dblclick",function(i){i.preventDefault(),t.clickTimeout&&window.clearTimeout(t.clickTimeout);var e=t.getXY(i);t.cancelClick=!0,t.handleDblClick(e.x,e.y,i)}),this.dom.addEventListener("click",function(i){if(3!=i.which&&!i.ctrlKey){i.preventDefault();var e=t.getXY(i);t.clickTimeout&&window.clearTimeout(t.clickTimeout),t.clickTimeout=window.setTimeout(function(){t.handleClick(e.x,e.y,i)},200)}}),this.rectEvent.addEventListener("mousewheel",function(i){i.preventDefault(),i.stopPropagation();var e=i.wheelDeltaY||i.wheelDelta||-i.deltaY;return t.handleMouseWheel(e,i),!1}),this.rectEvent.addEventListener("wheel",function(i){i.stopPropagation(),i.preventDefault();var e=i.wheelDeltaY||i.wheelDelta||-i.deltaY;return t.handleMouseWheel(e,i),!1})},focus:function(){this._dom.focus()},allowPlugin:function(t,i){if(this.forcedPlugin==i)return!0;var e=this.options.pluginAction[i]||{},s=t.shiftKey,n=t.ctrlKey;
return s!==e.shift?!1:n!==e.ctrl?!1:!0},handleMouseDown:function(i,e,s){var n,r=(t(s.target),s.shiftKey),h=s.ctrlKey,o=this.options.pluginAction;if(this.unselectShape(),this.forcedPlugin)return this.activePlugin=this.forcedPlugin,void this._pluginExecute(this.activePlugin,"onMouseDown",[this,i,e,s]);for(n in o){if(!o[n]._forced){if(r!==o[n].shift)continue;if(h!==o[n].ctrl)continue}this.activePlugin=n,this._pluginExecute(n,"onMouseDown",[this,i,e,s]);break}},handleMouseMove:function(t,i,e){return this.bypassHandleMouse?void this.bypassHandleMouse.handleMouseMove(e):void this._pluginExecute(this.activePlugin,"onMouseMove",[this,t,i,e])},forcePlugin:function(t){this.forcedPlugin=t},unforcePlugin:function(){this.forcedPlugin=!1},handleMouseUp:function(t,i,e){return this.bypassHandleMouse?(this.bypassHandleMouse.handleMouseUp(e),void(this.activePlugin=!1)):(this._pluginExecute(this.activePlugin,"onMouseUp",[this,t,i,e]),void(this.activePlugin=!1))},isZooming:function(){return"zooming"==this.currentAction},handleMouseWheel:function(t,i){if(i.preventDefault(),i.stopPropagation(),this.options.wheel.type){switch(this.options.wheel.type){case"plugin":var e;(e=this._plugins[this.options.wheel.plugin])&&e.onMouseWheel(t,i);break;case"toSeries":for(var s=0,n=this.series.length;n>s;s++)this.series[s].onMouseWheel(t,i)}this.redraw(),this.drawSeries(!0)}},handleClick:function(t){if(this.options.addLabelOnClick&&this.currentAction===!1)for(var i=0,e=this.series.length;e>i;i++)this.series[i].addLabelX(this.series[i].getXAxis().getVal(t-this.getPaddingLeft()))},shapeMoving:function(t){this.bypassHandleMouse=t},shapeStopMoving:function(){this.bypassHandleMouse=!1},handleDblClick:function(t,i,e){var s=this.options.dblclick;if(s&&s.type)switch(s.type){case"plugin":var n;(n=this._plugins[s.plugin])&&n.onDblClick(this,t,i,s.options,e)}},resetAxis:function(){for(;this.axisGroup.firstChild;)this.axisGroup.removeChild(this.axisGroup.firstChild);this.axis.left=[],this.axis.right=[],this.axis.bottom=[],this.axis.top=[]},resetSeries:function(){for(var t=0;t<this.series.length;t++)this.series[t].kill(!0);this.series=[]},applyToAxis:{string:function(t,i,e){for(var s=0;s<this.axis[t].length;s++)this.axis[t][s][i].apply(this.axis[t][s],e)},"function":function(t,i){for(var e=0;e<this.axis[t].length;e++)i.call(this,this.axis[t][e],t)}},applyToAxes:function(t,i,e,s){var n,r=[],h=0;for((e||void 0==e)&&(r.push("top"),r.push("bottom")),(s||void 0==s)&&(r.push("left"),r.push("right")),n=r.length;n>h;h++)this.applyToAxis[typeof t].call(this,r[h],t,i)},setWidth:function(t,i){this.width=t,i||this._resize()},getWidth:function(){return this.width},setHeight:function(t,i){this.height=t,i||this._resize()},getHeight:function(){return this.height},resize:function(t,i){this.setSize(t,i),this._resize()},setSize:function(t,i){this.setWidth(t,!0),this.setHeight(i,!0),this.getDrawingHeight(),this.getDrawingWidth()},getDom:function(){return this.dom},applyStyleText:function(){},getXAxis:function(t,i){return this.axis.top.length>0&&0==this.axis.bottom.length?this.getTopAxis(t,i):this.getBottomAxis(t,i)},getYAxis:function(t,i){return this.axis.right.length>0&&0==this.axis.left.length?this.getRightAxis(t,i):this.getLeftAxis(t,i)},_getAxis:function(t,i,e,s){return t=t||0,"object"==typeof t&&(i=t,t=0),this.axis[s][t]=this.axis[s][t]||new e(this,s,i)},getTopAxis:function(t,i){return this._getAxis(t,i,e,"top")},getBottomAxis:function(t,i){return this._getAxis(t,i,e,"bottom")},getLeftAxis:function(t,i){return this._getAxis(t,i,s,"left")},getRightAxis:function(t,i){return this._getAxis(t,i,s,"right")},setXAxis:function(t,i){this.setBottomAxis(t,i)},setYAxis:function(t,i){this.setLeftAxis(t,i)},setLeftAxis:function(t,i){i=i||0,this.axis.left[i]=t},setRightAxis:function(t,i){i=i||0,this.axis.right[i]=t},setTopAxis:function(t,i){i=i||0,this.axis.top[i]=t},setBottomAxis:function(t,i){i=i||0,this.axis.bottom[i]=t},getPaddingTop:function(){return this.options.paddingTop},getPaddingLeft:function(){return this.options.paddingLeft},getPaddingBottom:function(){return this.options.paddingTop},getPaddingRight:function(){return this.options.paddingRight},setTitle:function(t){this.title=t,this.domTitle.textContent=t},displayTitle:function(){this.domTitle.setAttribute("display","inline")},hideTitle:function(){this.domTitle.setAttribute("display","none")},drawSerie:function(t){t.draw(this.getDrawingGroup())},getDrawingHeight:function(t){if(t&&this.innerHeight)return this.innerHeight;var i=this.height-this.options.paddingTop-this.options.paddingBottom;return this.innerHeight=i},getDrawingWidth:function(t){if(t&&this.innerWidth)return this.innerWidth;var i=this.width-this.options.paddingLeft-this.options.paddingRight;return this.innerWidth=i},getBoundaryAxisFromSeries:function(t,i,e){var s,n,r,h,o,a,l,u="x"==i,d="min"==e,g=u?["getMinX","getMaxX"]:["getMinY","getMaxY"],c=g[d?0:1];for(s=d?Number.MAX_VALUE:Number.MIN_VALUE,h=this.getSeriesFromAxis(t,!0),a=0,l=h.length;l>a;a++)r=h[a],o=r[c](),s=Math[e](s,o),s==o&&n&&(n.isMinOrMax(!1,i,e),n=r,r.isMinOrMax(!0,i,e));return s},getSeriesFromAxis:function(t,i){for(var e=[],s=this.series.length-1;s>=0;s--)(this.series[s].getXAxis()==t||this.series[s].getYAxis()==t)&&e.push(this.series[s]);if(i)for(s=0;s<t.series.length;s++)e.push(t.series[s]);return e},_resize:function(){this.width&&this.height&&(this.sizeSet=!0,this.dom.setAttribute("width",this.width),this.dom.setAttribute("height",this.height),this.domTitle.setAttribute("x",this.width/2),this.refreshDrawingZone())},canRedraw:function(){return this.width&&this.height},redraw:function(t,i){return this.canRedraw()?(this.sizeSet?this.refreshDrawingZone(t,i):this._resize(),!0):void 0},updateAxes:function(){var t,i,e,s,n,r=["bottom","top","left","right"];for(this.refreshMinOrMax(),i=0,e=r.length;e>i;i++)for(s=this.axis[r[i]].length-1;s>=0;s--)t=this.axis[r[i]][s],n=2>i?"x":"y",t.disabled||(t.setMinValueData(this.getBoundaryAxisFromSeries(this.axis[r[i]][s],n,"min")),t.setMaxValueData(this.getBoundaryAxisFromSeries(this.axis[r[i]][s],n,"max")))},refreshDrawingZone:function(){var t=["bottom","top","left","right"],i=[0,0,0,0];this._painted=!0,this.refreshMinOrMax(),this.applyToAxes(function(e){if(!e.disabled){var s=t.indexOf(arguments[1]);e.setShift(i[s]+e.getAxisPosition(),e.getAxisPosition()),i[s]+=e.getAxisPosition()}},!1,!0,!1),this.applyToAxes(function(e){if(!e.disabled){e.setMinPx(i[1]),e.setMaxPx(this.getDrawingHeight(!0)-i[0]);var s=e.draw()||0,n=t.indexOf(arguments[1]),r=e.getAxisPosition();e.setShift(i[n]+r+s,s+r),i[n]+=s+r,e.drawSeries()}},!1,!1,!0),this.applyToAxes(function(t){t.disabled||(t.setMinPx(i[2]),t.setMaxPx(this.getDrawingWidth(!0)-i[3]),t.draw(),t.drawSeries())},!1,!0,!1),this.closeLine("right",this.getDrawingWidth(!0),this.getDrawingWidth(!0),i[1],this.getDrawingHeight(!0)-i[0]),this.closeLine("left",0,0,i[1],this.getDrawingHeight(!0)-i[0]),this.closeLine("top",i[2],this.getDrawingWidth(!0)-i[3],0,0),this.closeLine("bottom",i[2],this.getDrawingWidth(!0)-i[3],this.getDrawingHeight(!0)-i[0],this.getDrawingHeight(!0)-i[0]),this.clipRect.setAttribute("y",i[1]),this.clipRect.setAttribute("x",i[2]),this.clipRect.setAttribute("width",this.getDrawingWidth()-i[2]-i[3]),this.clipRect.setAttribute("height",this.getDrawingHeight()-i[1]-i[0]),this.rectEvent.setAttribute("x",i[1]),this.rectEvent.setAttribute("y",i[2]),this.rectEvent.setAttribute("width",this.getDrawingWidth()-i[2]-i[3]),this.rectEvent.setAttribute("height",this.getDrawingHeight()-i[1]-i[0]),this.shift=i,this.redrawShapes()},autoscaleAxes:function(){this.applyToAxes("setMinMaxToFitSeries",null,!0,!0),this.redraw()},closeLine:function(t,i,e,s,n){this.options.close[t]&&0==this.axis[t].length?(this.closingLines[t].setAttribute("display","block"),this.closingLines[t].setAttribute("x1",i),this.closingLines[t].setAttribute("x2",e),this.closingLines[t].setAttribute("y1",s),this.closingLines[t].setAttribute("y2",n)):this.closingLines[t].setAttribute("display","none")},refreshMinOrMax:function(){for(var t=this.series.length-1;t>=0;t--)this.series[t].isMinOrMax(!1)},_makeSerie:function(t,i,e){switch(e){case"contour":var s=new r;break;case"scatter":var s=new h;break;case"zone":var s=new o;break;case"line":default:var s=new n}return s.init(this,t,i),this.plotGroup.appendChild(s.groupMain),s},newSerie:function(t,i,e){var s=this._makeSerie(t,i,e);return this.series.push(s),this.legend&&this.legend.update(),s},getSerie:function(t){if("number"==typeof t)return this.series[t];for(var i=0,e=this.series.length;e>i;i++)if(this.series[i].getName()==t)return this.series[i]},getSeries:function(){return this.series},drawSeries:function(){if(this.width&&this.height)for(var t=this.series.length-1;t>=0;t--)this.series[t].draw()},checkMinOrMax:function(t){var i=t.getXAxis(),e=t.getYAxis(),s=t.getMinX(),n=t.getMaxX(),r=t.getMinY(),h=(t.getMaxY(),!1);return s<=i.getMinValue()&&(h=!0,t.isMinOrMax(!0,"x","min")),n>=i.getMaxValue()&&(h=!0,t.isMinOrMax(!0,"x","max")),r<=e.getMinValue()&&(h=!0,t.isMinOrMax(!0,"y","min")),n>=i.getMaxValue()&&(h=!0,t.isMinOrMax(!0,"y","max")),h},removeSerie:function(t){for(var i=this.series.length-1;i>=0;i--)this.series[i]==t&&this.series.slice(i,1);t.removeDom(),t.isMinOrMax()&&this.refreshDrawingZone(),this.legend&&this.legend.update()},setZoomMode:function(t){"x"!=t&&"y"!=t&&"xy"!=t&&t||(this.options.zoomMode=t)},setDefaultWheelAction:function(t){("zoomY"==t||"zoomX"==t||"none"==t)&&(this.options.defaultWheelAction=t)},getZoomMode:function(){return this.options.zoomMode},makeToolbar:function(e){var s=this,n=t.Deferred();return i(["./graph.toolbar"],function(t){s.toolbar=new t(s,e),n.resolve(s.toolbar)}),n},makeShape:function(e,s,n){var r,h=this,o=t.Deferred();if(e.id=Math.random(),!n||!1!==(r=this.triggerEvent("onShapeBeforeMake",e))){r&&(e=r);{i(["./graph.shape."+e.type],function(t){var i=new t(h,e.shapeOptions);if(i.setSerie(h.getSerie(0)),i){if(i.setOriginalData(e,s),i.data&&(i.data.id=h.id),e.fillColor&&i.set("fillColor",e.fillColor),e.strokeColor&&i.set("strokeColor",e.strokeColor),e.strokeWidth&&i.set("strokeWidth",e.strokeWidth||(e.strokeColor?1:0)),e.label){e.label instanceof Array||(e.label=[e.label]);for(var n=0,r=e.label.length;r>n;n++)i.set("labelPosition",e.label[n].position,n),i.set("labelColor",e.label[n].color||"black",n),i.set("labelSize",e.label[n].size,n),i.set("labelAngle",e.label[n].angle||0,n),e.label[n].anchor&&i.set("labelAnchor",e.label[n].anchor,n);i.setLabelNumber(r)}h.shapes.push(i),h.triggerEvent("onShapeMake",i,e),o.resolve(i)}})}return o}},redrawShapes:function(){for(var t=0,i=this.shapes.length;i>t;t++)this.shapes[t].redraw()},removeShapes:function(){for(var t=0,i=this.shapes.length;i>t;t++)this.shapes[t].kill();this.shapes=[]},removeShape:function(t){this.shapes.splice(this.shapes.indexOf(t),1)},_makeClosingLines:function(){this.closingLines={};for(var t,i=["top","bottom","left","right"],e=0,s=4;s>e;e++){var t=document.createElementNS(this.ns,"line");t.setAttribute("stroke","black"),t.setAttribute("shape-rendering","crispEdges"),t.setAttribute("stroke-linecap","square"),t.setAttribute("display","none"),this.closingLines[i[e]]=t,this.graphingZone.appendChild(t)}},_pluginsExecute:function(t,i){for(var e in this._plugins)this._plugins[e]&&this._plugins[e][t]&&this._plugins[e][t].apply(this._plugins[e],i)},_pluginExecute:function(t,i,e){this._plugins[t]&&this._plugins[t][i]&&this._plugins[t][i].apply(this._plugins[t],e)},_pluginsInit:function(){var t,e=this;if(this._plugins=this._plugins||{},Array.isArray(this.options.plugins))t=this.options.plugins;else{t=[];for(var s in this.options.plugins)t.push(s)}i(t,function(){for(var i=0,s=t.length;s>i;i++)e._plugins[t[i]]=new arguments[i],e._plugins[t[i]].init(e,e.options.plugins[t[i]]||{},t[i]);e._pluginsReady()})},getPlugin:function(t){var i=this;return this.pluginsReady.then(function(){return i._plugins[t]||!1})},_pluginsReady:function(){this.pluginsReady.resolve()},triggerEvent:function(){{var t=arguments[0];Array.prototype.splice.apply(arguments,[0,1])}return"function"==typeof this.options[t]?this.options[t].apply(this,arguments):void 0},selectShape:function(t){this.selectedShape!=t&&(this.selectedShape&&(console.log("Unselect shape"),this.selectedShape.unselect()),this.selectedShape=t,this.triggerEvent("onShapeSelect",t.data))},unselectShape:function(){this.selectedShape&&(this.selectedShape.unselect(),this.triggerEvent("onShapeUnselect",this.selectedShape.data),this.selectedShape=!1)},selectSerie:function(t){this.selectedSerie!=t&&(this.selectedSerie&&this.selectedSerie.unselect(),this.selectedSerie=t,t.select())},unselectSerie:function(t){t.unselect(),this.selectedSerie=!1},getSelectedSerie:function(){return this.selectedSerie},makeLegend:function(t){return this.legend=new a(this,t),this.graphingZone.appendChild(this.legend.getDom()),this.legend.update(),this.legend},updateLegend:function(){this.legend&&this.legend.update()},getPosition:function(t,i,e,s,n){var r,h={x:!1,y:!1};if(e||(e=this.getXAxis()),s||(s=this.getYAxis()),t){for(var o in h){var a="x"==o?e:s;if(void 0===t[o]&&(void 0!==t["d"+o]&&void 0===i||void 0===i)){if("x"==o){if(void 0===t["d"+o])continue;h[o]=i?i[o]:a.getPos(0)}else if(t.x&&n){var u=n.searchClosestValue(t.x);if(!u)return;h[o]=n.getY(u.yMin)}}else void 0!==t[o]&&(h[o]=this.getPx(t[o],a));if(void 0!==t["d"+o]){var d=void 0!==t[o]||void 0==i||void 0==i[o]?h[o]:this._getPositionPx(i[o],!0,a)||0;(r=l(t["d"+o]))!==!1?h[o]=d+r:(r=this._parsePercent(t["d"+o]))?h[o]=d+this._getPositionPx(r,!0,a):a&&(h[o]=d+a.getRelPx(t["d"+o]))}}return h}},_getPositionPx:function(t,i,e){return(parsed=l(t))?parsed:(parsed=this._parsePercent(t))?parsed/100*(i?this.graph.getDrawingWidth():this.graph.getDrawingHeight()):e?e.getPos(t):void 0},_parsePercent:function(t){return t&&t.indexOf&&t.indexOf("%")>-1?t:!1},deltaPosition:function(t,i,e){var s,n;return(s=l(t))?(n=l(i))?s+n+"px":s+e.getRelPx(i)+"px":(n=l(i))?t+e.getRelVal(n):t+i},getPx:function(t,i,e){var s;return(s=l(t))!==!1?s:(s=this._parsePercent(t))?s:i?"min"==t?i.getMinPx():"max"==t?i.getMaxPx():e?i.getRelPx(t):i.getPos(t):void 0},getPxRel:function(t,i){return this.getPx(t,i,!0)},contextListen:function(t,e,s){var n=this;return this.options.onContextMenuListen?this.options.onContextMenuListen(t,e,s):void(this.context?this.context.listen(t,e,s):i(["./util/context"],function(i){var r=new i;r.init(n._dom),r.listen(t,e,s),n.context=r}))},lockShapes:function(){this.shapesLocked=!0},unlockShapes:function(){console.log("unlock"),this.shapesLocked=!1}},d.prototype.plugins={},d}),define("graph.plugin.drag",[],function(){var t=function(){};return t.prototype={init:function(){},onMouseDown:function(t,i,e){return this._draggingX=i,this._draggingY=e,!0},onMouseMove:function(t,i,e){var s=i-this._draggingX,n=e-this._draggingY;t.applyToAxes(function(t){t.setCurrentMin(t.getVal(t.getMinPx()-s)),t.setCurrentMax(t.getVal(t.getMaxPx()-s))},!1,!0,!1),t.applyToAxes(function(t){t.setCurrentMin(t.getVal(t.getMinPx()-n)),t.setCurrentMax(t.getVal(t.getMaxPx()-n))},!1,!1,!0),this._draggingX=i,this._draggingY=e,t.refreshDrawingZone(!0),t.drawSeries()}},t}),define("graph.shape",["require"],function(t){function e(t){if(Array.isArray(t))switch(t.length){case 3:return"rgb("+t.join(",")+")";case 4:return"rgba("+t.join(",")+")"}else if("object"==typeof t)return"rgb("+Math.round(255*t.r)+", "+Math.round(255*t.g)+", "+Math.round(255*t.b)+")";return t}var s=function(){};return s.prototype={init:function(t,i){var e=this;this.graph=t,this.properties={},this.group=document.createElementNS(this.graph.ns,"g"),i&&this.group.setAttribute("data-groupname",i),this._selected=!1,this.createDom(),this.setEvents(),this.classes=[],this.rectEvent=document.createElementNS(this.graph.ns,"rect"),this.rectEvent.setAttribute("pointer-events","fill"),this.rectEvent.setAttribute("fill","transparent"),this._dom&&(this.group.appendChild(this._dom),this._dom.addEventListener("mouseover",function(t){e.handleMouseOver(t)}),this._dom.addEventListener("mouseout",function(t){e.handleMouseOut(t)}),this._dom.addEventListener("mousedown",function(t){e.graph.focus(),t.preventDefault(),e.handleSelected=!1,e.moving=!0,e.handleMouseDown(t)}),this._dom.addEventListener("dblclick",function(t){t.preventDefault(),t.stopPropagation(),e.handleDblClick(t)})),this.graph.shapeZone.appendChild(this.group),this.initImpl()},addClass:function(t){this.classes=this.classes||[],-1==this.classes.indexOf(t)&&this.classes.push(t),this.makeClasses()},removeClass:function(t){this.classes.splice(this.classes.indexOf(t),1),this.makeClasses()},makeClasses:function(){this._dom.setAttribute("class",this.classes.join(" "))},initImpl:function(){},setOriginalData:function(t,i){this.data=t,this.events=i},triggerChange:function(){this.graph.triggerEvent("onAnnotationChange",this.data,this)},setEvents:function(){},setSelectableOnClick:function(){return},setBBox:function(){this.group.removeChild(this.rectEvent);var t=this.group.getBBox();this.rectEvent.setAttribute("x",t.x),this.rectEvent.setAttribute("y",t.y-10),this.rectEvent.setAttribute("width",t.width),this.rectEvent.setAttribute("height",t.height+20),this.group.appendChild(this.rectEvent)},setMouseOver:function(t){this.rectEvent.addEventListener("mouseover",t)},kill:function(){this.graph.shapeZone.removeChild(this.group),this.graph.removeShape(this),this.options.onRemove&&this.options.onRemove.call(this)},draw:function(){void 0==this.labelNumber&&this.setLabelNumber(1),this.setFillColor(),this.setStrokeColor(),this.setStrokeWidth(),this.setDashArray(),this.everyLabel(function(t){this.get("labelPosition",t)&&(this.setLabelText(t),this.setLabelSize(t),this.setLabelColor(t),this.setLabelPosition(t)),this.get("labelAnchor",t)&&this._forceLabelAnchor(t)})},redraw:function(){this.position=this.setPosition(),this.redrawImpl(),this.position&&(this.everyLabel(function(t){this.get("labelPosition",t)&&(this.setLabelPosition(t),this.setLabelAngle(t))}),this.afterDone&&this.afterDone())},redrawImpl:function(){},done:function(){},setSerie:function(t){this.serie=t},set:function(t,i,e){this.properties[t]=this.properties[t]||[],this.properties[t][e||0]=i,this.configuration=this.configuration||{sections:{shape_cfg:[{groups:{shape_cfg:[{}]}}]}},this.configuration.sections.shape_cfg[0].groups.shape_cfg[0][t]=[i]},get:function(t){return this.configuration=this.configuration||{sections:{shape_cfg:[{groups:{shape_cfg:[{}]}}]}},((this.configuration.sections.shape_cfg[0].groups.shape_cfg[0]||[])[t]||[])[0]},getFromData:function(t){return this.data[t]},setData:function(t,i){return this.data[t]=i},setDom:function(t,i){this._dom&&this._dom.setAttribute(t,i)},setPosition:function(){var t=this._getPosition(this.getFromData("pos"));return this.setDom("x",t.x),this.setDom("y",t.y),!0},setFillColor:function(){this.setDom("fill",e(this.get("fillColor")))},setStrokeColor:function(){this.setDom("stroke",e(this.get("strokeColor")))},setStrokeWidth:function(){this.setDom("stroke-width",this.get("strokeWidth"))},setDashArray:function(){this.get("strokeDashArray")&&this.setDom("stroke-dasharray",this.get("strokeDashArray"))},setLabelText:function(t){this.label&&(this.label[t].textContent=this.data.label[t].text)},setLabelColor:function(t){this.label&&this.label[t].setAttribute("fill",this.get("labelColor"))},setLabelSize:function(t){this.label&&this.label[t].setAttribute("font-size",this.get("labelSize"))},setLabelPosition:function(t){this.label&&this._setLabelPosition(t)},setLabelAngle:function(t){this.label&&this._setLabelAngle(t)},_getPosition:function(t,i){var e,s=e=!1;return this.serie&&(s=this.serie.getXAxis(),e=this.serie.getYAxis()),this.graph.getPosition(t,i,s,e,this.serie)},setLabelNumber:function(t){this.labelNumber=t,this._makeLabel()},everyLabel:function(t){for(var i=0;i<this.labelNumber;i++)t.call(this,i)},toggleLabel:function(t,e){this.labelNumber&&this.label[i]&&this.label[i].setAttribute("display",e?"block":"none")},_makeLabel:function(){var t=this;this.label=this.label||[],this.everyLabel(function(i){this.label[i]=document.createElementNS(this.graph.ns,"text"),this.label[i].addEventListener("mouseover",function(t){t.stopPropagation()}),this.label[i].addEventListener("mouseout",function(t){t.stopPropagation()}),this.label[i].addEventListener("dblclick",function(e){e.preventDefault(),e.stopPropagation(),$('<input type="text" />').attr("value",e.target.textContent).prependTo(t.graph._dom).css({position:"absolute","margin-top":parseInt(e.target.getAttribute("y").replace("px",""))-10+"px","margin-left":parseInt(e.target.getAttribute("x").replace("px",""))-50+"px",textAlign:"center",width:"100px"}).bind("blur",function(){$(this).remove(),t.data.label[i].text=$(this).prop("value"),t.label[i].textContent=$(this).prop("value"),t.triggerChange()}).bind("keyup",function(t){t.stopPropagation(),t.preventDefault(),13==t.keyCode&&$(this).trigger("blur")}).bind("keypress",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}).focus().get(0).select()}),t.group.appendChild(this.label[i])})},_setLabelPosition:function(t,i){var e=this.getFromData("pos");if(e){{this._getPosition(e)}if(!i)var i=this._getPosition(this.get("labelPosition",t),e)}else i={x:-1e3,y:-1e3};"NaNpx"!=i.x&&(this.label[t].setAttribute("x",i.x),this.label[t].setAttribute("y",i.y))},_setLabelAngle:function(t){var i=this.get("labelAngle",t)||0;if(0!=i){var e=this.label[t].getAttribute("x"),s=this.label[t].getAttribute("y");this.label[t].setAttribute("transform","rotate("+i+" "+e+" "+s+")")}},_forceLabelAnchor:function(t){this.label[t].setAttribute("text-anchor",this._getLabelAnchor())},_getLabelAnchor:function(){var t=this.get("labelAnchor");switch(t){case"middle":case"start":case"end":return t;case"right":return"end";case"left":return"start";default:return"start"}},setSelectable:function(t){this._selectable=t},select:function(){this._selected=!0,this.selectStyle(),this.setHandles(),this.graph.selectShape(this)},unselect:function(){this._selected=!1,this.setStrokeWidth(),this.setStrokeColor(),this.setDashArray(),this.setFillColor(),this.handlesInDom&&(this.handlesInDom=!1,this.removeHandles())},createHandles:function(t,i,e){if(!this.isLocked())for(var s=this,n=1;t>=n;n++)!function(t){s["handle"+t]=document.createElementNS(s.graph.ns,i);for(var n in e)s["handle"+t].setAttribute(n,e[n]);s["handle"+t].addEventListener("mousedown",function(i){i.preventDefault(),i.stopPropagation(),s.handleSelected=t,s.handleMouseDown(i)})}(n)},handleMouseDownImpl:function(){},handleMouseMoveImpl:function(){},handleMouseUpImpl:function(){},handleCreateImpl:function(){},handlers:{mouseUp:[function(t){return this.moving=!1,this.resize=!1,this.graph.shapeMoving(!1),this.handleMouseUpImpl(t)}],mouseMove:[function(t){var i=this.graph.getXY(t),e=this.serie.getXAxis().getRelVal(i.x-this.mouseCoords.x),s=this.serie.getYAxis().getRelVal(i.y-this.mouseCoords.y);(0!=e||0!==s)&&(this.preventUnselect=!0),this.mouseCoords=i;var n=this.handleMouseMoveImpl(t,e,s,i.x-this.mouseCoords.x,i.y-this.mouseCoords.y);return this.options&&(this.moving?this.options.onMove&&this.options.onMove.call(this):this.options.onResize&&this.options.onResize.call(this)),n}],mouseDown:[function(t){var i=this;return t.preventDefault(),this.graph.shapeZone.appendChild(this.group),this.graph.shapeMoving(this),this._selected||(this.preventUnselect=!0,this.timeoutSelect=window.setTimeout(function(){i.select(),i.timeoutSelect=!1},100)),this.mouseCoords=this.graph.getXY(t),this.handleMouseDownImpl(t,this.mouseCoords)}],mouseOver:[function(){var t;this.highlight(),this.addClass("hover"),(t=this._mouseOverCallbacks)&&t.fireWith(this,[this.data,this.parameters])}],mouseOut:[function(){var t;this.unhighlight(),this.removeClass("hover"),(t=this._mouseOutCallbacks)&&t.fireWith(this,[this.data,this.parameters])}]},handleMouseDown:function(t){this.callHandler("mouseDown",t)},handleMouseMove:function(t){return this.isLocked()?(this.graph.shapeMoving(!1),this.handleSelected=!1,void(this.moving=!0)):void this.callHandler("mouseMove",t)},handleMouseUp:function(t){this.callHandler("mouseUp",t)},handleMouseOver:function(){this.callHandler("mouseOver")},handleMouseOut:function(){this.callHandler("mouseOut")},removeHandles:function(){for(var t=1;t<=this.nbHandles;t++)this.group.removeChild(this["handle"+t])},callHandler:function(t){{var i,e=t;Array.prototype.shift.call(arguments)}if(i=s.prototype.handlers[e])for(var n=0,r=i.length;r>n;n++)i[n].apply(this,arguments);if(i=this.graph.shapeHandlers[e])for(var n=0,r=i.length;r>n;n++)i[n].apply(this,arguments)},addHandles:function(){if(!this.isLocked()&&!this.handlesInDom){this.handlesInDom=!0;for(var t=1;t<=this.nbHandles;t++)this["handle"+t]&&this.group.appendChild(this["handle"+t])}},handleDblClick:function(){this.configure()},configure:function(){var i=this,e=$("<div></div>").dialog({modal:!0,position:["center",50],width:"80%"});e.prev().remove(),e.parent().css("z-index",1e3),t(["require","lib/lib/forms/form"],function(t,s){var n=new s({});n.init();var r={sections:{shape_cfg:{options:{title:"Shape",icon:"info_rhombus"},groups:{shape_cfg:{options:{type:"list"},fields:i.getFieldsConfig()}}}}};n.setStructure(r),n.onStructureLoaded().done(function(){n.fill(i.getConfiguration())}),n.addButton("Cancel",{color:"blue"},function(){e.dialog("close")}),n.addButton("Save",{color:"green"},function(){i.setConfiguration(n.getValue()),e.dialog("close")}),n.onLoaded().done(function(){e.html(n.makeDom()),n.inDom()})})},getConfiguration:function(){return this.configuration=this.configuration||{}},setConfiguration:function(t){this.configuration=$.extend(!0,this.configuration,t)},isLocked:function(){return this.options.locked||this.graph.shapesLocked},lock:function(){this.options.locked=!0},unlock:function(){this.options.locked=!1},isBindable:function(){return this.options.bindable},setBindableToDom:function(){this.isBindable()&&this.addClass("bindable")},highlight:function(){},unhighlight:function(){}},s}),define("graph.plugin.linking",[require,"./graph","./graph.shape"],function(){var t=function(){};return t.prototype={init:function(t,i,e){function s(t){a.islinking=!0;var i=t.graph.isLinking();if(!i){var e=t.graph.newLinkingLine(),s=t.getLinkingCoords();e.setAttribute("x1",s.x),e.setAttribute("y1",s.y),e.setAttribute("x2",s.x),e.setAttribute("y2",s.y),t.graph.linkA(t,e)}}function n(t,i){var e=t.graph.isLinking();if(e&&!t.graph.getLinkingB()){var s=t.graph.getLinkingLine(),n=t.graph.getXY(i);s.setAttribute("x2",n.x-t.graph.getPaddingLeft()),s.setAttribute("y2",n.y-t.graph.getPaddingTop())}}function r(t){var i=t.graph.isLinking();if(i){var e=t.graph.getLinkingA();if(e!=this){t.graph.linkB(t);var s=t.getLinkingCoords(),n=t.graph.getLinkingLine();n.setAttribute("x2",s.x),n.setAttribute("y2",s.y)}}}function h(t){var i=t.graph.isLinking();i&&t.graph.linkB(void 0)}function o(t){return t.graph.endLinking()}this.options=i;var a=this;this.graph=t,this.plugin=e;var l={linkA:function(t,i){this.linking.current.a=t,this.linking.current.line=i},linkB:function(t){this.linking.current.b=t},getLinkingA:function(){return this.linking.current.a},getLinkingB:function(){return this.linking.current.b},isLinking:function(){return!!this.linking.current.a},newLinkingLine:function(){var t=document.createElementNS(this.ns,"line");return t.setAttribute("class","graph-linkingline"),this.shapeZone.insertBefore(t,this.shapeZone.firstChild),t},getLinkingLine:function(){return this.linking.current.line},endLinking:function(){return this.linking.current.a==this.linking.current.b&&this.linking.current.a||!this.linking.current.b&&this.linking.current.a?(this.shapeZone.removeChild(this.linking.current.line),void(this.linking.current={})):(this.linking.current.line&&(this.linking.current.line.style.display="none",this.linking.links.push(this.linking.current),this.linking.current={}),this.linking.links[this.linking.links.length-1])},linkingReveal:function(){for(var t=0,i=this.linking.links.length;i>t;t++)this.linking.links[t].line.style.display="block"},linkingHide:function(){for(var t=0,i=this.linking.links.length;i>t;t++)this.linking.links[t].line.style.display="none"}};for(var u in l)t[u]=l[u];t.linking={current:{},links:[]},t.shapeHandlers.mouseDown.push(function(t){a.graph.allowPlugin(t,a.plugin)&&(this.moving=!1,this.handleSelected=!1,s(this,t,!0))}),t.shapeHandlers.mouseUp.push(function(){var t;(t=o(this))&&(t.a.linking=t.a.linking||0,t.a.linking++,t.b.linking=t.b.linking||0,t.b.linking++,t.a.addClass("linking"),t.b.addClass("linking"),t.a.addClass("linking"+t.a.linking),t.a.removeClass("linking"+(t.a.linking-1)),t.b.addClass("linking"+t.a.linking),t.b.removeClass("linking"+(t.a.linking-1)),a.options.onLinkCreate&&a.options.onLinkCreate(t.a,t.b))}),t.shapeHandlers.mouseMove.push(function(t){n(this,t,!0)}),t.shapeHandlers.mouseOver.push(function(t){r(this,t,!0)}),t.shapeHandlers.mouseOut.push(function(t){h(this,t,!0)})}},t}),define("graph.plugin.nmrpeakpicking",[],function(){var t=function(){};return t.prototype={init:function(t){this.graph=t},process:function(){console.log(arguments);var t=arguments;console.log(t[0].data),console.log(t[0].getAdditionalData()),this.graph.makeShape({type:"rect",pos:{x:0,y:1e3},pos2:{x:10,y:1e8},fillColor:[100,100,100,.3],strokeColor:[100,100,100,.9],strokeWidth:1}).then(function(t){t.draw(),t.redraw()})}},t}),define("graph.plugin.range",[],function(){var t=function(){};return t.prototype={init:function(){},onMouseDown:function(t,i,e,s){var n=t;if(this.count=this.count||0,this.count!=t.options.rangeLimitX){i-=t.getPaddingLeft(),xVal=t.getXAxis().getVal(i);var r=t.makeShape({type:"rangeX",pos:{x:xVal,y:0},pos2:{x:xVal,y:0}},{onChange:function(t){n.triggerEvent("onAnnotationChange",t)}},!0);require&&require(["src/util/context"],function(t){t.listen(r._dom,[['<li><a><span class="ui-icon ui-icon-cross"></span> Remove range zone</a></li>',function(){r.kill()}]])});var h=Util.getNextColorRGB(this.count,t.options.rangeLimitX);r.set("fillColor","rgba("+h+", 0.3)"),r.set("strokeColor","rgba("+h+", 0.9)"),this.count++,r.handleMouseDown(s,!0),r.draw()}}},t}),define("graph.plugin.shape",[],function(){var t=function(){};return t.prototype={init:function(t,i){this.options=i,this.shapeType=i.type},setShape:function(t){this.shapeInfo.shapeType=t},onMouseDown:function(t,i,e,s){if(this.shapeType){var n,r,h=this;this.count=this.count||0,i-=t.getPaddingLeft(),e-=t.getPaddingTop(),n=t.getXAxis().getVal(i),r=t.getYAxis().getVal(e);{var o={pos:{x:n,y:r},pos2:{x:n,y:r},onChange:function(i){t.triggerEvent("onAnnotationChange",i)}};t.makeShape($.extend(o,this.options),{},!0).then(function(t){t&&(h.currentShape=t,h.currentShapeEvent=s)})}}},onMouseMove:function(t,i,e,s){var n=this;if(n.currentShape){n.count++;var r=n.currentShape;n.currentShape=!1,r.handleCreateImpl(),r.options&&r.options.onCreate&&r.options.onCreate.call(r),r.draw(),r.select(),r.handleMouseDown(n.currentShapeEvent,!0),r.handleMouseMove(s,!0)}},onMouseUp:function(){var t=this;t.currentShape&&(t.currentShape.kill(),t.currentShape=!1)}},t}),define("graph.plugin.zoom",[],function(){var t=function(){};return t.prototype={init:function(t,i){this._zoomingGroup=document.createElementNS(t.ns,"g"),this._zoomingSquare=document.createElementNS(t.ns,"rect"),this._zoomingSquare.setAttribute("display","none"),t.setAttributeTo(this._zoomingSquare,{display:"none",fill:"rgba(171,12,12,0.2)",stroke:"rgba(171,12,12,1)","shape-rendering":"crispEdges",x:0,y:0,height:0,width:0}),this.options=i,this.graph=t,t.dom.appendChild(this._zoomingGroup),this._zoomingGroup.appendChild(this._zoomingSquare)},onMouseDown:function(t,i,e,s,n){var r=this.options.zoomMode;if(r){switch(this._zoomingMode=r,void 0===i&&(this._backedUpZoomMode=this._zoomingMode,this._zoomingMode="y",i=0),void 0===e&&(this._backedUpZoomMode=this._zoomingMode,this._zoomingMode="x",e=0),this._zoomingXStart=i,this._zoomingYStart=e,this.x1=i-t.getPaddingLeft(),this.y1=e-t.getPaddingTop(),this._zoomingSquare.setAttribute("width",0),this._zoomingSquare.setAttribute("height",0),this._zoomingSquare.setAttribute("display","block"),this._zoomingMode){case"x":this._zoomingSquare.setAttribute("y",t.options.paddingTop),this._zoomingSquare.setAttribute("height",t.getDrawingHeight()-t.shift[0]);
break;case"y":this._zoomingSquare.setAttribute("x",t.options.paddingLeft),this._zoomingSquare.setAttribute("width",t.getDrawingWidth())}this.options.onZoomStart&&!n&&this.options.onZoomStart(t,i,e,s,n)}},onMouseMove:function(t,i,e,s,n){switch(this._zoomingMode){case"xy":this._zoomingSquare.setAttribute("x",Math.min(this._zoomingXStart,i)),this._zoomingSquare.setAttribute("y",Math.min(this._zoomingYStart,e)),this._zoomingSquare.setAttribute("width",Math.abs(this._zoomingXStart-i)),this._zoomingSquare.setAttribute("height",Math.abs(this._zoomingYStart-e));break;case"x":this._zoomingSquare.setAttribute("x",Math.min(this._zoomingXStart,i)),this._zoomingSquare.setAttribute("width",Math.abs(this._zoomingXStart-i));break;case"y":this._zoomingSquare.setAttribute("y",Math.min(this._zoomingYStart,e)),this._zoomingSquare.setAttribute("height",Math.abs(this._zoomingYStart-e))}this.options.onZoomMove&&!n&&this.options.onZoomMove(t,i,e,s,n)},onMouseUp:function(t,i,e,s,n){this._zoomingSquare.setAttribute("display","none");var r=i-t.options.paddingLeft,h=e-t.options.paddingTop;if(!(i-this._zoomingXStart==0&&"y"!=this._zoomingMode||e-this._zoomingYStart==0&&"x"!=this._zoomingMode)){switch(this._zoomingMode){case"x":t.applyToAxes("_doZoom",[r,this.x1],!0,!1);break;case"y":t.applyToAxes("_doZoom",[h,this.y1],!1,!0);break;case"xy":t.applyToAxes("_doZoom",[r,this.x1],!0,!1),t.applyToAxes("_doZoom",[h,this.y1],!1,!0)}t.redraw(!0),t.drawSeries(),this.options.onZoomEnd&&!n&&this.options.onZoomEnd(t,i,e,s,n),this._backedUpZoomMode&&(this._zoomingMode=this._backedUpZoomMode)}},onMouseWheel:function(t,i){var e;return(e=this.graph.getSelectedSerie())?void e.getYAxis().handleMouseWheel(t,i):void this.graph.applyToAxes("handleMouseWheel",[t,i],!1,!0)},onDblClick:function(t,i,e,s,n,r){var h=this.graph.getXAxis(),o=this.graph.getYAxis();if("xtotal"==s.mode)this.graph.applyToAxes("setMinMaxToFitSeries",null,!0,!1),this.graph.drawSeries();else if("ytotal"==s.mode)this.graph.applyToAxes("setMinMaxToFitSeries",null,!1,!0),this.graph.drawSeries();else if("total"==s.mode)this.graph.autoscaleAxes(),this.graph.drawSeries(),o.options.onZoom&&o.options.onZoom(o.getMinValue(),o.getMaxValue()),h.options.onZoom&&h.options.onZoom(h.getMinValue(),h.getMaxValue());else{i-=this.graph.options.paddingLeft,e-=this.graph.options.paddingTop;var a=h.getActualMin(),l=h.getActualMax(),u=h.getVal(i),d=l-a,g=o.getActualMin(),c=o.getActualMax(),p=o.getVal(e),f=c-g;if("gradualXY"==s.mode||"gradualX"==s.mode){var x=(u-a)/(l-a);a=Math.max(h.getMinValue(),a-d*x),l=Math.min(h.getMaxValue(),l+d*(1-x)),h.setCurrentMin(a),h.setCurrentMax(l),h.options.onZoom&&h.options.onZoom(a,l)}if("gradualXY"==s.mode||"gradualY"==s.mode){var x=(p-g)/(c-g);g=Math.max(o.getMinValue(),g-f*x),c=Math.min(o.getMaxValue(),c+f*(1-x)),o.setCurrentMin(g),o.setCurrentMax(c),o.options.onZoom&&o.options.onZoom(g,c)}this.graph.redraw(),this.graph.drawSeries()}this.options.onDblClick&&!r&&this.options.onDblClick(i,e,s,n)}},t}),define("graph.serieaxis",["require","./graph.serie"],function(t,i){var e=function(){};return i.prototype,$.extend(!0,e.prototype,i.prototype,{initExtended1:function(){this.initExtended2&&this.initExtended2()},setAxis:function(t){this.axis=t},kill:function(t){this.getAxis().groupSeries.removeChild(this.groupMain),this.getAxis().series.splice(this.getAxis().series.indexOf(this),1),t||this.graph.redraw()},getAxis:function(){return this.axis},getXAxis:function(){return this.axis},getYAxis:function(){return this.axis}}),e}),define("graph.serieaxisx",["require","./graph.serieaxis"],function(t,i){var e=function(){};return $.extend(e.prototype,i.prototype,{getY:function(t){var i=-Math.round(1e3*((t-this.minY)/(this.maxY-this.minY)))/1e3*(this.axis.totalDimension-this.axis._widthLabels)-this.axis._widthLabels;return i},getX:function(t){var i=Math.round(1e3*((t-this.axis.getActualMin())/this.axis._getActualInterval()*(this.axis.getMaxPx()-this.axis.getMinPx())+this.axis.getMinPx()))/1e3;return i},bindLabelHandlers:function(t){function i(i){if(s.axis.currentAction===!1){s.axis.currentAction="labelDragging",i.stopPropagation(),t.dragging=!0;var e=s.graph.getXY(i);t.draggingIniX=e.x,t.draggingIniY=e.y,s.labelDragging=t}}function e(i){s.axis.currentAction===!1&&(s.axis.currentAction="labelDraggingMain",i.preventDefault(),i.stopPropagation(),s.labelDragging=t)}var s=this;t.labelDom.addEventListener("mousedown",i),t.rect.addEventListener("mousedown",i),t.rect.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),t.labelDom.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),t.path.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation()}),t.path.addEventListener("mousedown",e)}}),e}),define("graph.serieaxisy",["require","./graph.serieaxis"],function(t,i){var e=function(){};return $.extend(e.prototype,i.prototype,{getX:function(t){var i=-Math.round(1e3*((t-this.minY)/(this.maxY-this.minY)))/1e3*(this.axis.totalDimension-this.axis._widthLabels)-this.axis._widthLabels-5;return i},getY:function(t){var i=Math.round(1e3*((t-this.axis.getActualMin())/this.axis._getActualInterval()*(this.axis.getMaxPx()-this.axis.getMinPx())+this.axis.getMinPx()))/1e3;return i},getMinX:function(){return this.minY},getMaxX:function(){return this.maxY},getMinY:function(){return this.minX},getMaxY:function(){return this.maxX}}),e}),define("graph.shape.areaundercurve",["require","./graph.shape"],function(t,i){var e=function(t){this.init(t)};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"path"),this._dom.setAttribute("pointer-events","stroke")},handleCreateImpl:function(){this.resize=!0,this.resizingElement=2},handleMouseDownImpl:function(){},handleMouseUpImpl:function(){},handleMouseMoveImpl:function(t,i,e){if(!this.isLocked()){var s=this.getFromData("pos"),n=this.getFromData("pos2");if(this.moving)s.x=this.graph.deltaPosition(s.x,i,this.serie.getXAxis()),s.y=this.graph.deltaPosition(s.y,e,this.serie.getYAxis()),n.x=this.graph.deltaPosition(n.x,i,this.serie.getXAxis()),n.y=this.graph.deltaPosition(n.y,e,this.serie.getYAxis());else{this.resizingPosition=this.getFromData(this.reversed&&2==this.handleSelected||!this.reversed&&1==this.handleSelected?"pos":"pos2");var r=this.serie.searchClosestValue(this.serie.getXAxis().getVal(this.graph.getXY(t).x-this.graph.getPaddingLeft()));if(!r)return;this.resizingPosition.x!=r.xMin&&(this.preventUnselect=!0),this.resizingPosition.x=r.xMin}this.position=this.setPosition(),this.setHandles()}},redrawImpl:function(){this.position!=this.doDraw&&(this.group.setAttribute("visibility",this.position?"visible":"hidden"),this.doDraw=this.position)},setPosition:function(){var t=this._getPosition(this.getFromData("pos")),i=this._getPosition(this.getFromData("pos2"),this.getFromData("pos")),e=Math.abs(t.x-i.x),s=Math.min(t.x,i.x);if(this.reversed=s==i.x,2>e||0>s+e||s>this.graph.getDrawingWidth())return!1;var n,r,h,o,a,l,s,u,d,g=this.serie.searchClosestValue(this.getFromData("pos").x),c=this.serie.searchClosestValue(this.getFromData("pos2").x),p=0,f=Number.MAX_VALUE;if(!g||!c)return!1;for(g.xBeforeIndex>c.xBeforeIndex&&(n=g,g=c,c=n),r=g.dataIndex;r<=c.dataIndex;r++){for(d="M ",o=r==g.dataIndex?g.xBeforeIndexArr:0,a=r==c.dataIndex?c.xBeforeIndexArr:this.serie.data[r].length,l=0,h=o;a>=h;h+=2)s=this.serie.getX(this.serie.data[r][h+0]),u=this.serie.getY(this.serie.data[r][h+1]),p=Math.max(this.serie.data[r][h+1],p),f=Math.min(this.serie.data[r][h+1],f),h==o&&(this.firstX=s,this.firstY=u),d=this.serie._addPoint(d,s,u,l),l++;if(this.lastX=s,this.lastY=u,!(this.firstX&&this.firstY&&this.lastX&&this.lastY))return;d+=" V "+this.serie.getYAxis().getPx(0)+" H "+this.firstX+" z",this.setDom("d",d)}return this.maxY=this.serie.getY(p),this._selected&&this.select(),!0},select:function(){this.isLocked()||this.firstX&&this.lastX&&(this._selected=!0,this.selectHandles(),this.group.appendChild(this.handle1),this.group.appendChild(this.handle2),this.selectStyle(),this.graph.selectShape(this))},selectHandles:function(){this.handle1.setAttribute("x1",this.firstX),this.handle1.setAttribute("x2",this.firstX),this.handle2.setAttribute("x1",this.lastX),this.handle2.setAttribute("x2",this.lastX),this.handle1.setAttribute("y1",this.serie.getYAxis().getMaxPx()),this.handle1.setAttribute("y2",this.serie.getY(0)),this.handle2.setAttribute("y1",this.serie.getYAxis().getMaxPx()),this.handle2.setAttribute("y2",this.serie.getY(0))},selectStyle:function(){this.setDom("stroke","red"),this.setDom("stroke-width","2"),this.setDom("fill","rgba(255, 0, 0, 0.1)")},setLabelPosition:function(t){var i=(this.firstX+this.lastX)/2+"px",e=(this.lastPointY+this.firstPointY)/2+"px",s=this.serie.isFlipped();this._setLabelPosition(t,{x:s?e:i,y:s?i:e})},getFieldsConfig:function(){return{strokeWidth:{type:"float","default":1,title:"Stroke width"},strokeColor:{type:"color",title:"Stroke color"},fillColor:{type:"color",title:"Fill color"}}}}),e}),define("graph.shape.line",["require","./graph.shape"],function(t,i){var e=function(t,i){this.init(t),this.options=i||{},this.nbHandles=2,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white",cursor:"nwse-resize"})};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"line")},setPosition:function(){var t=this._getPosition(this.getFromData("pos"));if(t.x&&t.y)return this.setDom("x2",t.x),this.setDom("y2",t.y),this.currentPos1x=t.x,this.currentPos1y=t.y,!0},setPosition2:function(){var t=this._getPosition(this.getFromData("pos2"),this.getFromData("pos"));t.x&&t.y&&(this.setDom("y1",t.y),this.setDom("x1",t.x),this.currentPos2x=t.x,this.currentPos2y=t.y)},redrawImpl:function(){this.setPosition(),this.setPosition2(),this.setHandles()},getLinkingCoords:function(){return{x:(this.currentPos2x+this.currentPos1x)/2,y:(this.currentPos2y+this.currentPos1y)/2}},handleCreateImpl:function(){this.resize=!0,this.handleSelected=2},handleMouseDownImpl:function(){return!0},handleMouseUpImpl:function(){return this.triggerChange(),!0},handleMouseMoveImpl:function(t,i,e){if(!this.isLocked()){var s=this.getFromData("pos"),n=this.getFromData("pos2");if(1==this.handleSelected&&(this.options.vertical||(s.x=this.graph.deltaPosition(s.x,i,this.serie.getXAxis())),this.options.horizontal||(s.y=this.graph.deltaPosition(s.y,e,this.serie.getYAxis()))),2==this.handleSelected&&(this.options.vertical||(n.x=this.graph.deltaPosition(n.x,i,this.serie.getXAxis())),this.options.horizontal||(n.y=this.graph.deltaPosition(n.y,e,this.serie.getYAxis()))),this.options.forcedCoords){var r=this.options.forcedCoords;void 0!==r.y&&(n.y=r.y,s.y=r.y),void 0!==r.x&&(n.x=r.x,s.x=r.x)}return this.moving&&(s.x=this.graph.deltaPosition(s.x,i,this.serie.getXAxis()),s.y=this.graph.deltaPosition(s.y,e,this.serie.getYAxis()),n.x=this.graph.deltaPosition(n.x,i,this.serie.getXAxis()),n.y=this.graph.deltaPosition(n.y,e,this.serie.getYAxis())),this.redrawImpl(),!0}},setHandles:function(){this.isLocked()||this._selected&&void 0!=this.currentPos1x&&(this.addHandles(),this.handle1.setAttribute("x",this.currentPos1x),this.handle1.setAttribute("y",this.currentPos1y),this.handle2.setAttribute("x",this.currentPos2x),this.handle2.setAttribute("y",this.currentPos2y))},selectStyle:function(){this.setDom("stroke","red"),this.setDom("stroke-width","2")}}),e}),define("graph.shape.arrow",["require","./graph.shape.line"],function(t,i){var e=function(t){this.init(t)};$.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"line"),this._dom.setAttribute("marker-end","url(#arrow"+this.graph._creation+")")}});var s=function(t){this.init(t)};return $.extend(s.prototype,i.prototype,{initImpl:function(){this._dom.style.cursor="ew-resize"},setEvents:function(){var t=this;this._dom.addEventListener("mousedown",function(i){i.preventDefault(),i.stopPropagation(),t.handleMouseDown(i)}),this._dom.addEventListener("mousemove",function(i){i.preventDefault(),i.stopPropagation(),t.handleMouseMove(i)}),this._dom.addEventListener("mouseup",function(i){i.preventDefault(),i.stopPropagation(),t.handleMouseUp(i)})},handleMouseDown:function(t){this.moving=!0,this.graph.shapeMoving(this),this.coordsI=this.graph.getXY(t)},handleMouseMove:function(t){if(this.moving){var i=this.graph.getXY(t),e=this.graph.getXAxis().getRelPx(i.x-this.coordsI.x),s=this.getFromData("pos");s.x+=e,this.coordsI=i,this.setPosition()}},handleMouseUp:function(){this.moving=!1,this.triggerChange()},setPosition:function(){var t=this._getPosition(this.getFromData("pos"));this.setDom("x1",t.x),this.setDom("x2",t.x),this.setDom("y1",this.graph.getYAxis().getMinPx()),this.setDom("y2",this.graph.getYAxis().getMaxPx())},setPosition2:function(){}}),e}),define("graph.shape.label",["require","./graph.shape"],function(t,i){var e=function(t){this.init(t)};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=!1},setPosition:function(){var t=this._getPosition(this.get("labelPosition"));t&&this.everyLabel(function(i){this.label[i].setAttribute("x",t.x),this.label[i].setAttribute("y",t.y)})},redrawImpl:function(){this.draw()}}),e}),define("graph.shape.nmrintegral",["require","./graph.shape.areaundercurve"],function(t,i){var e=function(t,i){this.init(t,"nmrintegral"),this.options=i||{},this.options.axis=this.options.axis||"x",this.nbHandles=2,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white",cursor:"nwse-resize"})};return $.extend(e.prototype,i.prototype,{setPosition:function(){var t,i,e=this.yBaseline||30,s=this._getPosition(this.getFromData("pos")),n=this._getPosition(this.getFromData("pos2"),this.getFromData("pos")),r=this.options.axis;if(s&&n){if(this.serie.isFlipped()?(e=this.serie.getXAxis().getPx(0)-e,t=Math.abs(s.y-n.y),i=Math.min(s.y,n.y)):(e=this.serie.getYAxis().getPx(0)-e,t=Math.abs(s.x-n.x),i=Math.min(s.x,n.x)),this.computedBaseline=e,this.reversed=i==n.x,"x"==r){if(2>t||0>i+t||i>this.graph.getDrawingWidth())return!1}else if(2>t||0>i+t||i>this.graph.getDrawingHeight())return!1;{var h,o,a,l,u,d,i,g,c,p,f=this.serie.searchClosestValue(this.getFromData("pos")[r]),x=this.serie.searchClosestValue(this.getFromData("pos2")[r]),m="",b=0,v=1,A=0;Number.MAX_VALUE}if(!f||!x)return!1;f.xBeforeIndex>x.xBeforeIndex&&(h=f,f=x,x=h);var c,p,M,k,y,S,w,P,_,L=0,D=(this.scaling,[]);for(this.serie.isFlipped()&&(v=0,A=1),o=f.dataIndex;o<=x.dataIndex;o++){for(l=o==f.dataIndex?f.xBeforeIndexArr:0,u=o==x.dataIndex?x.xBeforeIndexArr:this.serie.data[o].length,d=0,a=l;u>=a;a+=2){if(i=this.serie.getX(this.serie.data[o][a+A]),g=this.serie.getY(this.serie.data[o][a+v]),this.serie.isFlipped()){var C=i;i=g,g=C}c||(c=i,p=g,y=this.serie.data[o][a+A],S=this.serie.data[o][a+v]),void 0!=M?(L+=Math.abs((this.serie.data[o][a+A]-w)*(this.serie.data[o][a+v]-S)*.5),(i!=M||g!=k)&&(M=i,k=g,D.push([i,L]),d++)):(M=i,k=g,w=this.serie.data[o][a+A],P=this.serie.data[o][a+v])}if(this.lastX=i,this.lastY=g,!(c&&p&&this.lastX&&this.lastY))return}0==L&&(L=1),this.maxPx||(this.maxPx=50),this.ratio||(this.ratio=1);for(var E=this.maxIntegration||L,o=0,X=D.length;X>o;o++)D[o][1]=e-D[o][1]/L*this.maxPx*(L/E)*this.ratio,0==o&&(this.firstPointY=D[o][1]),m+=" L "+D[o][A]+", "+D[o][v]+" ",this.lastPointY=D[o][1];this.points=D,this.lastSum=L;var k=p,M=this.lastX;return _=Math.min(20,M-c),m=this.serie.isFlipped()?" M "+e+", "+c+" "+m:" M "+c+", "+e+" "+m,this.setDom("d",m),this.firstX=c,this.firstY=p,this.maxY=this.serie.getY(b),this._selected&&this.select(),this.setHandles(),!0}},setScale:function(t,i){this.maxPx=t,this.maxIntegration=i},setYBaseline:function(t){this.yBasline=t},selectStyle:function(){this.setDom("stroke-width","2px")},selectHandles:function(){},setHandles:function(){this._selected&&void 0!=this.points&&(this.addHandles(),this.handle1.setAttribute("x",this.points[0][0]),this.handle1.setAttribute("y",this.points[0][1]),this.handle2.setAttribute("x",this.points[this.points.length-1][0]-1),this.handle2.setAttribute("y",this.points[this.points.length-1][1]))}}),e}),define("graph.shape.rect",["require","./graph.shape"],function(t,i){var e=function(t,i){this.init(t),this.graph=t,this.nbHandles=4,this.options=i,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white"}),this.handle2.setAttribute("cursor","nesw-resize"),this.handle4.setAttribute("cursor","nesw-resize"),this.handle1.setAttribute("cursor","nwse-resize"),this.handle3.setAttribute("cursor","nwse-resize")};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"rect")},setWidthPx:function(t){this.set("width",t)},setHeightPx:function(t){this.set("height",t)},setFullWidth:function(){this.set("x",Math.min(this.serie.getXAxis().getMinPx(),this.serie.getXAxis().getMaxPx())),this.set("width",Math.abs(this.serie.getXAxis().getMaxPx()-this.serie.getXAxis().getMinPx()))},setFullHeight:function(){this.set("y",Math.min(this.serie.getYAxis().getMinPx(),this.serie.getYAxis().getMaxPx())),this.set("height",Math.abs(this.serie.getYAxis().getMaxPx()-this.serie.getYAxis().getMinPx()))},setPosition:function(){var t=this.getFromData("width"),i=this.getFromData("height"),e=this._getPosition(this.getFromData("pos")),s=e.x,n=e.y;if(void 0==t||void 0==i){var r=this._getPosition(this.getFromData("pos2"));t=r.x-e.x,i=r.y-e.y}else t=this.graph.getPxRel(t,this.serie.getXAxis()),i=this.graph.getPxRel(i,this.serie.getYAxis());return s=e.x,n=e.y,0>t&&(s+=t,t*=-1),0>i&&(n+=i,i*=-1),0/0!==s&&s!==!1&&0/0!==n&&n!==!1?(this.setDom("width",t),this.setDom("height",i),this.setDom("x",s),this.setDom("y",n),this.currentX=s,this.currentY=n,this.currentW=t,this.currentH=i,this.setHandles(),!0):!1},getLinkingCoords:function(){return{x:this.currentX+this.currentW/2,y:this.currentY+this.currentH/2}},redrawImpl:function(){},handleCreateImpl:function(){this.resize=!0,this.handleSelected=3},handleMouseDownImpl:function(){},handleMouseUpImpl:function(){},handleMouseMoveImpl:function(t,i,e){if(this.moving||this.handleSelected){var s=this.getFromData("width")||0,n=this.getFromData("height")||0,r=this.getFromData("pos"),h=this.getFromData("pos2");if(h){var o=this.serie.getXAxis().isFlipped(),a=this.serie.getYAxis().isFlipped(),l=r.x,u=r.y,d=h.x,g=h.y;if(this.moving)return r.x=this.graph.deltaPosition(r.x,i,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,e,this.serie.getYAxis()),h.x=this.graph.deltaPosition(h.x,i,this.serie.getXAxis()),h.y=this.graph.deltaPosition(h.y,e,this.serie.getYAxis()),this.setData("pos",r),this.setData("pos2",h),void this.setPosition();if(1==this.handleSelected||4==this.handleSelected)var c=!o;else var c=o;if(d>l&&c||l>=d&&!c?l=this.graph.deltaPosition(l,i,this.serie.getXAxis()):d=this.graph.deltaPosition(d,i,this.serie.getXAxis()),1==this.handleSelected||2==this.handleSelected)var c=!a;else var c=a;g>u&&c||u>=g&&!c?u=this.graph.deltaPosition(u,e,this.serie.getYAxis()):g=this.graph.deltaPosition(g,e,this.serie.getYAxis()),(g>u&&h.y<r.y||u>g&&h.y>r.y)&&(1==this.handleSelected?this.handleSelected=4:2==this.handleSelected?this.handleSelected=3:3==this.handleSelected?this.handleSelected=2:4==this.handleSelected&&(this.handleSelected=1)),(d>l&&h.x<r.x||l>d&&h.x>r.x)&&(1==this.handleSelected?this.handleSelected=2:2==this.handleSelected?this.handleSelected=1:3==this.handleSelected?this.handleSelected=4:4==this.handleSelected&&(this.handleSelected=3)),h.x=d,h.y=g,r.x=l,r.y=u,this.setData("pos2",h)}else{if(this.moving)return r.x=this.graph.deltaPosition(r.x,i,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,e,this.serie.getYAxis()),this.setData("pos",r),void this.setPosition();1==this.handleSelected&&(r.x=this.graph.deltaPosition(r.x,i,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,e,this.serie.getYAxis()),s=this.graph.deltaPosition(s,-i,this.serie.getXAxis()),n=this.graph.deltaPosition(n,-e,this.serie.getYAxis())),2==this.handleSelected&&(r.y=this.graph.deltaPosition(r.y,e,this.serie.getYAxis()),s=this.graph.deltaPosition(s,i,this.serie.getXAxis()),n=this.graph.deltaPosition(n,-e,this.serie.getYAxis())),3==this.handleSelected&&(s=this.graph.deltaPosition(s,i,this.serie.getXAxis()),n=this.graph.deltaPosition(n,e,this.serie.getYAxis())),4==this.handleSelected&&(r.x=this.graph.deltaPosition(r.x,i,this.serie.getXAxis()),s=this.graph.deltaPosition(s,-i,this.serie.getXAxis()),n=this.graph.deltaPosition(n,e,this.serie.getYAxis()));var p=this.graph.getPxRel(s,this.serie.getXAxis()),f=this.graph.getPxRel(n,this.serie.getYAxis());0>p&&(r.x=this.graph.deltaPosition(r.x,s),s=-s,1==this.handleSelected?this.handleSelected=2:2==this.handleSelected?this.handleSelected=1:3==this.handleSelected?this.handleSelected=4:4==this.handleSelected&&(this.handleSelected=3)),0>f&&(r.y=this.graph.deltaPosition(r.y,n),n=-n,1==this.handleSelected?this.handleSelected=4:2==this.handleSelected?this.handleSelected=3:3==this.handleSelected?this.handleSelected=2:4==this.handleSelected&&(this.handleSelected=1)),this.setData("width",s),this.setData("height",n)}this.setData("pos",r),this.setPosition()}},setHandles:function(){this._selected&&void 0!=this.currentX&&(this.addHandles(),this.handle1.setAttribute("x",this.currentX),this.handle1.setAttribute("y",this.currentY),this.handle2.setAttribute("x",this.currentX+this.currentW),this.handle2.setAttribute("y",this.currentY),this.handle3.setAttribute("x",this.currentX+this.currentW),this.handle3.setAttribute("y",this.currentY+this.currentH),this.handle4.setAttribute("x",this.currentX),this.handle4.setAttribute("y",this.currentY+this.currentH))},selectStyle:function(){this.setDom("stroke","red"),this.setDom("stroke-width","2"),this.setDom("fill","rgba(255, 0, 0, 0.1)")}}),e}),define("graph.shape.peakintegration2d",["require","./graph.shape.rect"],function(t,i){var e=5,s=function(t,i){this.options=i||{},this.init(t),this.nbHandles=4,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white",cursor:"nwse-resize"})};return $.extend(s.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"rect"),this._dom.element=this},redrawImpl:function(){this.setPosition(),this.setHandles(),this.setBindableToDom(this._dom)},highlight:function(){this._dom.setAttribute("stroke-width","5"),this.setLinesY(e+2)},unhighlight:function(){this.setStrokeWidth(),this.setLinesY(e)}}),s}),define("graph.shape.peakinterval",["require","./graph.shape.line"],function(t,i){var e=function(t){this.init(t)};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"line"),this._dom.setAttribute("marker-end","url(#verticalline"+this.graph._creation+")"),this._dom.setAttribute("marker-start","url(#verticalline"+this.graph._creation+")")},setLabelPosition:function(t){var i=this._getPosition(this.getFromData("pos")),e=this._getPosition(this.getFromData("pos2"),this.getFromData("pos"));this._setLabelPosition(t,this._getPosition(this.get("labelPosition",t),{x:(i.x+e.x)/2+"px",y:(i.y+e.y)/2+"px"}))},afterDone:function(){}}),e}),define("graph.shape.peakinterval2",["require","./graph.shape.line"],function(t,i){var e=5,s=function(t,i){this.options=i||{},this.init(t),this.nbHandles=2,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white",cursor:"nwse-resize"})};return $.extend(s.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"line"),this.line1=document.createElementNS(this.graph.ns,"line"),this.line2=document.createElementNS(this.graph.ns,"line"),this.group.appendChild(this.line1),this.group.appendChild(this.line2),this.line1.setAttribute("stroke","black"),this.line2.setAttribute("stroke","black"),this._dom.element=this},redrawImpl:function(){this.setPosition(),this.setPosition2(),this.setHandles(),this.redrawLines(e),this.setBindableToDom(this._dom)},redrawLines:function(t){var i=this.findxs(),e=this._getPosition({x:i[0]}),s=this._getPosition({x:i[1]});e.x&&s.x&&this.currentPos2y&&this.currentPos1y&&(this.line1.setAttribute("x1",e.x),this.line1.setAttribute("x2",e.x),this.line2.setAttribute("x1",s.x),this.line2.setAttribute("x2",s.x),this.setLinesY(t))},setLinesY:function(t){this.line1.setAttribute("y1",this.currentPos2y-t),this.line1.setAttribute("y2",this.currentPos2y+t),this.line2.setAttribute("y1",this.currentPos1y-t),this.line2.setAttribute("y2",this.currentPos1y+t)},findxs:function(){var t=this._getPosition(this.getFromData("pos")),i=this._getPosition(this.getFromData("pos2"),this.getFromData("pos")),e=Math.abs(t.x-i.x),s=Math.min(t.x,i.x);if(this.reversed=s==i.x,2>e||0>s+e||s>this.graph.getDrawingWidth())return!1;{var n,r,h,o,a,l,s,u,d,g,c=this.serie.searchClosestValue(this.getFromData("pos").x),p=this.serie.searchClosestValue(this.getFromData("pos2").x);Number.MAX_VALUE}if(!c||!p)return!1;c.xBeforeIndex>p.xBeforeIndex&&(n=c,c=p,p=n);var d,g,f,x,m=0,b=(this.scaling,[]),v=[];for(r=c.dataIndex;r<=p.dataIndex;r++){for(o=r==c.dataIndex?c.xBeforeIndexArr:0,a=r==p.dataIndex?p.xBeforeIndexArr:this.serie.data[r].length,l=0,h=o;a>=h;h+=2)s=this.serie.data[r][h+0],u=this.serie.data[r][h+1],d||(d=s,g=u),void 0==f&&(f=s,x=u),m+=Math.abs((s-f)*(u-x)*.5),b.push(m),v.push(s),f=s,x=u,l++;if(this.lastX=s,this.lastY=u,!(d&&g&&this.lastX&&this.lastY))return!1}if(0==m)return[d,f];for(var A=.05*m,M=.95*m,k=!1,y=!1,r=0,S=b.length;S>r;r++)if(b[r]>A){k=r;break}for(var r=b.length;r>0;r--)if(b[r]<M){y=r;break}return[v[k],v[y]]},highlight:function(){this.isBindable()&&(this._dom.setAttribute("stroke-width","5"),this.setLinesY(e+2))},unhighlight:function(){this.isBindable()&&(this.setStrokeWidth(),this.setLinesY(e))}}),s}),define("graph.shape.rangex",["require","./graph.shape.areaundercurve"],function(t,i){var e=function(t){this.init(t)};return $.extend(e.prototype,i.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"rect"),this._dom.setAttribute("class","rangeRect"),this._dom.setAttribute("cursor","move"),this.handle1=this._makeHandle(),this.handle2=this._makeHandle(),this.setDom("cursor","move"),this.doDraw=void 0},setPosition:function(){var t=this._getPosition(this.getFromData("pos")),i=this._getPosition(this.getFromData("pos2"),this.getFromData("pos")),e=Math.abs(t.x-i.x),s=Math.min(t.x,i.x);return this.reversed=s==i.x,2>e||0>s+e||s>this.graph.getDrawingWidth()?!1:(this.group.appendChild(this.handle1),this.group.appendChild(this.handle2),this.handle1.setAttribute("transform","translate("+(s-6)+" "+((this.graph.getDrawingHeight()-this.graph.shift[0])/2-10)+")"),this.handle2.setAttribute("transform","translate("+(s+e-6)+" "+((this.graph.getDrawingHeight()-this.graph.shift[0])/2-10)+")"),this.setDom("x",s),this.setDom("width",e),this.setDom("y",0),this.setDom("height",this.graph.getDrawingHeight()-this.graph.shift[0]),!0)},_makeHandle:function(){var t=document.createElementNS(this.graph.ns,"g");t.setAttribute("id","rangeHandle"+this.graph._creation);var i=document.createElementNS(this.graph.ns,"rect");i.setAttribute("rx",0),i.setAttribute("ry",0),i.setAttribute("stroke","black"),i.setAttribute("fill","white"),i.setAttribute("width",10),i.setAttribute("height",20),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("shape-rendering","crispEdges"),i.setAttribute("cursor","ew-resize"),t.appendChild(i);var e=document.createElementNS(this.graph.ns,"line");e.setAttribute("x1",4),e.setAttribute("x2",4),e.setAttribute("y1",4),e.setAttribute("y2",18),e.setAttribute("stroke","black"),e.setAttribute("shape-rendering","crispEdges"),e.setAttribute("cursor","ew-resize"),t.appendChild(e);var e=document.createElementNS(this.graph.ns,"line");return e.setAttribute("x1",6),e.setAttribute("x2",6),e.setAttribute("y1",4),e.setAttribute("y2",18),e.setAttribute("stroke","black"),e.setAttribute("shape-rendering","crispEdges"),e.setAttribute("cursor","ew-resize"),t.appendChild(e),t}}),e}),define("graph.toolbar",[],function(){function t(){var t=document.createElementNS(r,"svg");return t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),t.setAttribute("xmlns",r),t}function i(){var i=t(),e=document.createElementNS(r,"line");return e.setAttribute("x1",16),e.setAttribute("y1",3),e.setAttribute("x2",4),e.setAttribute("y2",15),e.setAttribute("stroke","#aa0000"),i.appendChild(e),i}function e(){var i=t(),e=document.createElementNS(r,"rect");return e.setAttribute("x",4),e.setAttribute("y",4),e.setAttribute("width",12),e.setAttribute("height",12),e.setAttribute("stroke","black"),e.setAttribute("fill","#dd0000"),i.appendChild(e),i}function s(){var i="M 4,18 C 8,10 14,1 18,18",e=t(),s=document.createElementNS(r,"path");s.setAttribute("d",i),s.setAttribute("stroke","black"),s.setAttribute("fill","transparent");var n=document.createElementNS(r,"path");return n.setAttribute("d",i+" Z"),n.setAttribute("stroke","red"),n.setAttribute("fill","rgba(255, 0, 0, 0.1)"),e.appendChild(n),e.appendChild(s),e}var n={buttons:["none","rect","line","areaundercurve"]},r="http://www.w3.org/2000/svg",h=function(t,i){var e=this;this.options=$.extend(!0,{},n,i),this.graph=t,this.div=$("<ul />").addClass("graph-toolbar"),this.graph.getPlugin("./graph.plugin.shape").then(function(t){e.plugin=t,e.plugin&&(e.div.on("click","li",function(){var t=$(this).attr("data-shape");e.plugin.setShape(t),$(this).parent().children().removeClass("selected"),$(this).addClass("selected")}),e.makeButtons())})};return h.prototype={makeButtons:function(){for(var t=0,i=this.options.buttons.length;i>t;t++)this.div.append(this.makeButton(this.options.buttons[t]))},makeButton:function(t){var n=$("<li />");switch(t){case"line":n.html(i()).attr("data-shape","line");break;case"rect":n.html(e()).attr("data-shape","rect");break;case"areaundercurve":n.html(s()).attr("data-shape","areaundercurve")}return n},getDom:function(){return this.div}},h}),define("graph.xaxis.time",["require","./graph.axis"],function(t,i){var e=function(t,i,e){this.init(t,e),this.top="top"==i};return $.extend(e.prototype,i.prototype,{getAxisPosition:function(){var t=(1==this.options.tickPosition?15:25)+2*this.graph.options.fontSize;return this.options.allowedPxSerie&&this.series.length>0&&(t+=this.options.allowedPxSerie),t},getAxisWidthHeight:function(){},_setShift:function(){this.group.setAttribute("transform","translate(0 "+(this.top?this.shift:this.graph.getDrawingHeight()-this.shift)+")")},getMaxSizeTick:function(){return(this.top?-1:1)*(1==this.options.tickPosition?15:25)},drawTick:function(t,i,e,s){var n=(this.groupTicks,document.createElementNS(this.graph.ns,"line")),r=this.getPos(t);if(void 0!=r){if(n.setAttribute("shape-rendering","crispEdges"),n.setAttribute("x1",r),n.setAttribute("x2",r),n.setAttribute("y1",(this.top?1:-1)*this.tickPx1*e),n.setAttribute("y2",(this.top?1:-1)*this.tickPx2*e),i&&this.options.primaryGrid?this.doGridLine(!0,r,r,0,this.graph.getDrawingHeight()):!i&&this.options.secondaryGrid&&this.doGridLine(!1,r,r,0,this.graph.getDrawingHeight()),n.setAttribute("stroke","black"),this.groupTicks.appendChild(n),i){var h=(this.groupTickLabels,document.createElementNS(this.graph.ns,"text"));h.setAttribute("x",r),h.setAttribute("y",(this.top?-1:1)*((1==this.options.tickPosition?8:25)+(this.top?10:0))),h.setAttribute("text-anchor","middle"),h.style.dominantBaseline="hanging",this.setTickContent(h,t,s),this.graph.applyStyleText(h),this.groupTickLabels.appendChild(h)}this.ticks.push(n)}},drawSpecifics:function(){this.label.setAttribute("text-anchor","middle"),this.label.setAttribute("x",Math.abs(this.getMaxPx()-this.getMinPx())/2+this.getMinPx()),this.label.setAttribute("y",(this.top?-1:1)*((1==this.options.tickPosition?10:15)+this.graph.options.fontSize)),this.line.setAttribute("x1",this.getMinPx()),this.line.setAttribute("x2",this.getMaxPx()),this.line.setAttribute("y1",0),this.line.setAttribute("y2",0),this.labelTspan.style.dominantBaseline="hanging",this.expTspan.style.dominantBaseline="hanging",this.expTspanExp.style.dominantBaseline="hanging"
},drawSeries:function(){if(this.shift){this.rectEvent.setAttribute("y",this.top?-this.shift:0),this.rectEvent.setAttribute("height",this.totalDimension),this.rectEvent.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.rectEvent.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx())),this.clipRect.setAttribute("y",this.top?-this.shift:0),this.clipRect.setAttribute("height",this.totalDimension),this.clipRect.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.clipRect.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx()));for(var t=0,i=this.series.length;i>t;t++)this.series[t].draw()}},_draw0Line:function(t){this._0line=document.createElementNS(this.graph.ns,"line"),this._0line.setAttribute("x1",t),this._0line.setAttribute("x2",t),this._0line.setAttribute("y1",0),this._0line.setAttribute("y2",this.getMaxPx()),this._0line.setAttribute("stroke","black"),this.groupGrids.appendChild(this._0line)},addSerie:function(t,i){var e=new GraphSerieAxisX(t,i);return e.setAxis(this),e.init(this.graph,t,i),e.autoAxis(),e.setXAxis(this),this.series.push(e),this.groupSeries.appendChild(e.groupMain),this.groupSeries.setAttribute("clip-path","url(#_clip"+this.axisRand+")"),e},handleMouseMoveLocal:function(t){t-=this.graph.getPaddingLeft(),this.mouseVal=this.getVal(t)},isXY:function(){return"x"}}),e}),define("plugin.integral",[],function(){return{init:function(){},onMouseDown:function(t,i,e,s){var n=t;this.count=this.count||0,i-=t.getPaddingLeft(),xVal=t.getXAxis().getVal(i);var r=Util.getNextColorRGB(this.count,100),h=t.makeShape({type:"surfaceUnderCurve",pos:{x:xVal,y:0},pos2:{x:xVal,y:0},fillColor:"rgba("+r+", 0.3)",strokeColor:"rgba("+r+", 0.9)",onChange:function(t){n.triggerEvent("onAnnotationChange",t)}},{},!0);h&&(this.count++,h.handleMouseDown(s,!0),h.draw())}}}),onmessage=function(t){var i=t.data.data,e=t.data.slotNumber,s=t.data.slot,n=t.data.flip,r=t.data.max,h=t.data.min,o=s/(r-h),a=0,l=1;n&&(a=1,l=0),this.slotsData=[];for(var u=0,d=i.length;d>u;u++)for(var g=0,c=i[u].length;c>g;g+=2)slotNumber=Math.floor((i[u][g]-h)*o),this.slotsData[slotNumber]=this.slotsData[slotNumber]||{min:i[u][g+l],max:i[u][g+l],start:i[u][g+l],stop:!1,x:i[u][g+a]},this.slotsData[slotNumber].stop=i[u][g+l],this.slotsData[slotNumber].min=Math.min(i[u][g+l],this.slotsData[slotNumber].min),this.slotsData[slotNumber].max=Math.max(i[u][g+l],this.slotsData[slotNumber].max);postMessage({slotNumber:e,slot:s,data:this.slotsData})},define("slotworker",function(){});