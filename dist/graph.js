define("graph.axis",[],function(){var e=function(){};return e.prototype={defaults:{lineAt0:!1,display:!0,flipped:!1,axisDataSpacing:{min:.1,max:.1},unitModification:!1,primaryGrid:!0,secondaryGrid:!0,shiftToZero:!1,tickPosition:1,nbTicksPrimary:3,nbTicksSecondary:10,ticklabelratio:1,exponentialFactor:0,exponentialLabelFactor:0,wheelBaseline:"min",logScale:!1,allowedPxSerie:100,forcedMin:!1,forcedMax:!1},init:function(t,n,r){this.unitModificationTimeTicks=[[1,[1,2,5,10,20,30]],[60,[1,2,5,10,20,30]],[3600,[1,2,6,12]],[86400,[1,2,3,4,5,10,20,40]]];var i=this;this.graph=t,this.options=$.extend(!0,{},e.prototype.defaults,r,n),this.group=document.createElementNS(this.graph.ns,"g"),this.hasChanged=!0,this.groupGrids=document.createElementNS(this.graph.ns,"g"),this.graph.axisGroup.insertBefore(this.groupGrids,this.graph.axisGroup.firstChild),this.rectEvent=document.createElementNS(this.graph.ns,"rect"),this.rectEvent.setAttribute("pointer-events","fill"),this.rectEvent.setAttribute("fill","transparent"),this.group.appendChild(this.rectEvent),this.setEvents(),this.graph.axisGroup.appendChild(this.group),this.line=document.createElementNS(this.graph.ns,"line"),this.line.setAttribute("stroke","black"),this.line.setAttribute("shape-rendering","crispEdges"),this.line.setAttribute("stroke-linecap","square"),this.groupTicks=document.createElementNS(this.graph.ns,"g"),this.groupTickLabels=document.createElementNS(this.graph.ns,"g"),this.group.appendChild(this.groupTicks),this.group.appendChild(this.groupTickLabels),this.group.appendChild(this.line),this.labelValue,this.label=document.createElementNS(this.graph.ns,"text"),this.labelTspan=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.labelTspan),this.expTspan=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.expTspan),this.expTspan.setAttribute("dx",10),this.expTspanExp=document.createElementNS(this.graph.ns,"tspan"),this.label.appendChild(this.expTspanExp),this.expTspanExp.setAttribute("dy",-5),this.expTspanExp.setAttribute("font-size","0.8em"),this.label.setAttribute("text-anchor","middle"),this.groupGrids.setAttribute("clip-path","url(#_clipplot"+this.graph._creation+")"),this.graph.applyStyleText(this.label),this.group.appendChild(this.label),this.groupSeries=document.createElementNS(this.graph.ns,"g"),this.group.appendChild(this.groupSeries),this.ticks=[],this.series=[],this.totalDelta=0,this.currentAction=!1,this.group.addEventListener("mousemove",function(e){e.preventDefault();var t=i.graph.getXY(e);i.handleMouseMoveLocal(t.x,t.y,e);for(var n=0,r=i.series.length;n<r;n++)i.series[n].handleMouseMove(!1,!0),i.currentAction=="labelDragging"&&i.series[n].handleLabelMove(t.x,t.y),i.currentAction=="labelDraggingMain"&&i.series[n].handleLabelMainMove(t.x,t.y)}),this.group.addEventListener("mouseup",function(e){e.preventDefault(),i.handleMouseUp()}),this.group.addEventListener("mouseout",function(e){e.preventDefault();var t=i.graph.getXY(e);i.handleMouseOutLocal(t.x,t.y,e)}),this.labels=[],this.group.addEventListener("click",function(e){e.preventDefault();var t=i.graph.getXY(e);i.addLabel(i.getVal(t.x-i.graph.getPaddingLeft()))}),this.axisRand=Math.random(),this.clip=document.createElementNS(this.graph.ns,"clipPath"),this.clip.setAttribute("id","_clip"+this.axisRand),this.graph.defs.appendChild(this.clip),this.clipRect=document.createElementNS(this.graph.ns,"rect"),this.clip.appendChild(this.clipRect),this.clip.setAttribute("clipPathUnits","userSpaceOnUse")},setEvents:function(){var e=this;this.rectEvent.addEventListener("mousedown",function(t){t.stopPropagation(),t.preventDefault();if(t.which==3||t.ctrlKey)return;var n=e.graph.getXY(t);e.graph.currentAction="zooming",e.graph._zoomingMode=e instanceof GraphXAxis?"x":"y",e.graph._zoomingXStart=n.x,e.graph._zoomingYStart=n.y,e.graph._zoomingXStartRel=n.x-e.graph.getPaddingLeft(),e.graph._zoomingYStartRel=n.y-e.graph.getPaddingTop(),e.this._zoomingSquare.setAttribute("width",0),e.this._zoomingSquare.setAttribute("height",0);switch(e.graph._zoomingMode){case"x":e.this._zoomingSquare.setAttribute("y",e.graph.getPaddingTop()+e.shift-e.totalDimension),e.this._zoomingSquare.setAttribute("height",e.totalDimension);break;case"y":e.this._zoomingSquare.setAttribute("x",e.graph.getPaddingLeft()+e.shift-e.totalDimension),e.this._zoomingSquare.setAttribute("width",e.totalDimension)}e.this._zoomingSquare.setAttribute("display","block")})},addLabel:function(e){for(var t=0,n=this.series.length;t<n;t++){if(this.series[t].currentAction!==!1)continue;this.series[t].addLabelObj({x:e})}},setDisplay:function(e){return this.options.display=!!e,this},setLineAt0:function(e){this.options.lineAt0=!!e},setAxisDataSpacing:function(e,t){this.options.axisDataSpacing.min=e,this.options.axisDataSpacing.max=t||e},setAxisDataSpacingMin:function(e){this.options.axisDataSpacing.min=e},setAxisDataSpacingMax:function(e){this.options.axisDataSpacing.max=e},setMinPx:function(e){this.minPx=e},getMinPx:function(){return this.options.flipped?this.maxPx:this.minPx},setMaxPx:function(e){this.maxPx=e},getMaxPx:function(e){return this.options.flipped?this.minPx:this.maxPx},getMathMaxPx:function(){return this.maxPx},getMinValue:function(){return this.options.forcedMin||(this.options.forcedMin===0?0:this.dataMin)},getMaxValue:function(){return this.options.forcedMax||(this.options.forcedMax===0?0:this.dataMax)},setMinValueData:function(e){this.dataMin=e},setMaxValueData:function(e){this.dataMax=e},forceMin:function(e){this.options.forcedMin=e},forceMax:function(e){this.options.forcedMax=e},getNbTicksPrimary:function(){return this.options.nbTicksPrimary},getNbTicksSecondary:function(){return this.options.nbTicksSecondary},handleMouseMove:function(e,t){this.mouseVal=this.getVal(e)},handleMouseWheel:function(e,t){e=Math.min(.2,Math.max(-0.2,e));var n;this.options.wheelBaseline=="min"?n=this.getActualMin():this.options.wheelBaseline=="max"?n=this.getActualMax():n=this.options.wheelBaseline,this._doZoomVal((this.getActualMax()-n)*(1+e)+n,(this.getActualMin()-n)*(1+e)+n),this.graph.redraw(!0)},handleMouseUp:function(e,t){if(this.currentAction=="labelDragging"||this.currentAction=="labelDraggingMain"){for(var n=0,r=this.series.length;n<r;n++)this.series[n].handleLabelUp();this.currentAction=!1}else this.graph.isZooming()&&this._handleZoom(e)},_doZoomVal:function(e,t,n){return this._doZoom(this.getPx(e),this.getPx(t),e,t,n)},_doZoom:function(e,t,n,r,i){var n=n||this.getVal(e),r=r||this.getVal(t);this.setCurrentMin(Math.min(n,r)),this.setCurrentMax(Math.max(n,r)),this._hasChanged=!0,this.options.onZoom&&!i&&this.options.onZoom(this.currentAxisMin,this.currentAxisMax)},getSerieShift:function(){return this._serieShift},getSerieScale:function(){return this._serieScale},getMouseVal:function(){return this.mouseVal},isFlipped:function(){return this.options.flipped},getUnitPerTick:function(e,t,n,r){var i=e/g;t?t=Math.min(t,e/10):t=e/10;var s=n/t;if(this.options.unitModification=="time"){var r=this.getModifiedValue(this.getMaxValue()),o=[[60,"min"],[3600,"h"],[86400,"d"]];r<3600?umin=0:r<86400?umin=1:umin=2;var u=!1;for(var a=0,f=this.unitModificationTimeTicks.length;a<f;a++){for(var l=0,c=this.unitModificationTimeTicks[a][1].length;l<c;l++)if(s<this.unitModificationTimeTicks[a][0]*this.unitModificationTimeTicks[a][1][l]){u=!0;break}if(u)break}a!==this.unitModificationTimeTicks.length?m=this.unitModificationTimeTicks[a][0]*this.unitModificationTimeTicks[a][1][l]:m=1}else{var h=Math.floor(Math.log(s)/Math.log(10)),p=s*Math.pow(10,-h);this.decimals=-h;var d=[1,2,5,10],v=!1;for(var a=d.length-1;a>=0;a--)if(!v||Math.abs(d[a]-p)<Math.abs(v-p))v=d[a];var m=v*Math.pow(10,h)}var g=n/m,i=e/t;return[m,g,i]},setMinMaxToFitSeries:function(){var e=this.getMaxValue()-this.getMinValue();this.currentAxisMin=this.getMinValue()-this.options.axisDataSpacing.min*e,this.currentAxisMax=this.getMaxValue()+this.options.axisDataSpacing.max*e,this.options.logScale&&(this.currentAxisMin=Math.max(1e-50,this.currentAxisMin),this.currentAxisMax=Math.max(1e-50,this.currentAxisMax))},_getActualInterval:function(){return this.getActualMax()-this.getActualMin()},getActualMin:function(){return this.currentAxisMin==this.currentAxisMax?this.currentAxisMin-1:this.currentAxisMin},getActualMax:function(){return this.currentAxisMax==this.currentAxisMin?this.currentAxisMax+1:this.currentAxisMax},setCurrentMin:function(e){this.currentAxisMin=e,this.options.logScale&&(this.currentAxisMin=Math.max(1e-50,e))},setCurrentMax:function(e){this.currentAxisMax=e,this.options.logScale&&(this.currentAxisMax=Math.max(1e-50,e))},flip:function(e){return this.options.flipped=e,this},_draw:function(){var e;switch(this.options.tickPosition){case 3:this.tickPx1=-2,this.tickPx2=0;break;case 2:this.tickPx1=-1,this.tickPx2=1;break;case 1:this.tickPx1=0,this.tickPx2=2}while(this.groupTicks.firstChild)this.groupTicks.removeChild(this.groupTicks.firstChild);while(this.groupTickLabels.firstChild)this.groupTickLabels.removeChild(this.groupTickLabels.firstChild);while(this.groupGrids.firstChild)this.groupGrids.removeChild(this.groupGrids.firstChild);(this.currentAxisMin==undefined||!this.currentAxisMax==undefined)&&this.setMinMaxToFitSeries();var t=this.maxPx-this.minPx,n=this._getActualInterval();if(!this.options.display)return this.line.setAttribute("display","none"),0;this.line.setAttribute("display","block");if(!this.options.hideTicks)if(!this.options.logScale){this.options.scientificTicks&&(this.scientificExp=Math.floor(Math.log(Math.max(Math.abs(this.getActualMax()),Math.abs(this.getActualMin())))/Math.log(10)));var r=this.getNbTicksPrimary(),i=this.getUnitPerTick(t,r,n,this.getActualMax()),s=this.secondaryTicks();if(s)var s=s;var o=this.drawTicks(i,s)}else var o=this.drawLogTicks();else var o=0;var u;if(u=this.getLabel())this.labelTspan.textContent=u,this.getExponentialLabelFactor()?(this.expTspan.nodeValue="x10",this.expTspanExp.nodeValue=this.getExponentialLabelFactor(),e=!0):this.options.scientificTicks?(this.expTspan.textContent="x10",this.expTspanExp.textContent=this.scientificExp,e=!0):e=!1,this.expTspan.setAttribute("display",e?"block":"none"),this.expTspanExp.setAttribute("display",e?"block":"none");return this.drawSpecifics(),this.options.lineAt0&&this.getActualMin()<0&&this.getActualMax()>0&&this._draw0Line(this.getPx(0)),o+(u?20:0)},setTickLabelRatio:function(e){this.options.ticklabelratio=e},draw:function(){this._widthLabels=0;var e=this._draw();return this._widthLabels+=e,e},drawTicks:function(e,t){var n=e[0],r=this.getActualMin(),i=this.getActualMax(),s=0,o,u,a,f=0;t&&(o=n/t),u=this.options.shiftToZero?this.dataMin-Math.ceil((this.dataMin-r)/n)*n:Math.floor(r/n)*n,this.incrTick=e[0],this.resetTicks();while(u<i){f++;if(f>200)break;if(t){a=u+o;var l=0;while(a<u+n){l++;if(l>100)break;if(a<r||a>i){a+=o;continue}this.drawTick(a,!1,Math.abs(a-u-n/2)<1e-4?3:2),a+=o}}if(u<r||u>i){u+=e[0];continue}this.drawTick(u,!0,4),u+=e[0]}return this.widthHeightTick=this.getMaxSizeTick(),this.widthHeightTick},resetTicks:function(){},secondaryTicks:function(){return this.options.nbTicksSecondary},drawLogTicks:function(){var e=this.getActualMin(),t=this.getActualMax(),n=Math.min(e,t),t=Math.max(e,t),r={fontSize:"1.0em",exponential:!0,overwrite:!1};n<0&&(n=0);var i=n==0?0:Math.floor(Math.log(n)/Math.log(10)),n=1,s=0,o;while((o=n*Math.pow(10,i))<t)n==1&&o>e&&this.drawTick(o,!0,5,r),n==10?(n=1,i++):(n!=1&&o>e&&this.drawTick(o,!0,2,{overwrite:n,fontSize:"0.6em"}),n++);return 5},getPx:function(e){return this.getPos(e)},getPos:function(e){if(!this.options.logScale)return(e-this.getActualMin())/this._getActualInterval()*(this.getMaxPx()-this.getMinPx())+this.getMinPx();if(e<0)return;var e=(Math.log(e)-Math.log(this.getActualMin()))/(Math.log(this.getActualMax())-Math.log(this.getActualMin()))*(this.getMaxPx()-this.getMinPx())+this.getMinPx();return e},getRelPx:function(e){return e/this._getActualInterval()*(this.getMaxPx()-this.getMinPx())},getRelVal:function(e){return e/(this.getMaxPx()-this.getMinPx())*this._getActualInterval()},getVal:function(e){return(e-this.getMinPx())/(this.getMaxPx()-this.getMinPx())*this._getActualInterval()+this.getActualMin()},valueToText:function(e){if(this.options.scientificTicks)return e/=Math.pow(10,this.scientificExp),e.toFixed(1);e=e*Math.pow(10,this.getExponentialFactor())*Math.pow(10,this.getExponentialLabelFactor()),this.options.shiftToZero&&(e-=this.dataMin),this.options.ticklabelratio&&(e*=this.options.ticklabelratio);if(this.options.unitModification)return e=this.modifyUnit(e,this.options.unitModification),e;var t=this.decimals-this.getExponentialFactor()-this.getExponentialLabelFactor();return t>0?e.toFixed(t):e.toFixed(0)},getModifiedValue:function(e){return this.options.ticklabelratio&&(e*=this.options.ticklabelratio),this.options.shiftToZero&&(e-=this.getMinValue()*(this.options.ticklabelratio||1)),e},modifyUnit:function(e,t){switch(t){case"time":var n=this.getModifiedValue(this.getMaxValue()),r=[[60,"min"],[3600,"h"],[86400,"d"]];n<3600?umin=0:n<86400?umin=1:n<2592e3&&(umin=2)}var i=this.incrTick,s="",o;e/=r[umin][0],o=Math.floor(e),s=o+r[umin][1],umin--;while(i<1*r[umin+1][0]&&umin>-1)first=!1,e=(e-o)*r[umin+1][0]/r[umin][0],o=Math.round(e),s+=" "+o+r[umin][1],umin--;return s},getExponentialFactor:function(){return this.options.exponentialFactor},setExponentialFactor:function(e){this.options.exponentialFactor=e},setExponentialLabelFactor:function(e){this.options.exponentialLabelFactor=e},getExponentialLabelFactor:function(){return this.options.exponentialLabelFactor},setLabel:function(e){return this.options.labelValue=e,this},getLabel:function(){return this.options.labelValue},setShift:function(e,t){this.shift=e,this.totalDimension=t,this._setShift()},getShift:function(){return this.shift},setTickPosition:function(e){switch(e){case 3:case"outside":e=3;break;case 2:case"centered":e=2;break;default:case 1:case"inside":e=1}return this.options.tickPosition=e,this},togglePrimaryGrid:function(e){return this.options.primaryGrid=e,this},toggleSecondaryGrid:function(e){return this.options.secondaryGrid=e,this},doGridLine:function(e,t,n,r,i){var s=document.createElementNS(this.graph.ns,"line");s.setAttribute("shape-rendering","crispEdges"),s.setAttribute("y1",r),s.setAttribute("y2",i),s.setAttribute("x1",t),s.setAttribute("x2",n),s.setAttribute("stroke",e?this.getColorPrimaryGrid():this.getColorSecondaryGrid()),this.groupGrids.appendChild(s)},getColorPrimaryGrid:function(){return"#c0c0c0"},getColorSecondaryGrid:function(){return"#f0f0f0"},setTickContent:function(e,t,n){n||(n={});if(n.overwrite||!n.exponential)e.textContent=n.overwrite||this.valueToText(t);else{var r=Math.round(Math.log(t)/Math.log(10)),i=Math.floor(t*Math.pow(10,-r));e.textContent=i!=1?i+"x10":"10";var s=document.createElementNS(this.graph.ns,"tspan");s.textContent=r,s.setAttribute("font-size","0.7em"),s.setAttribute("dy",-3),e.appendChild(s)}n.fontSize&&e.setAttribute("font-size",n.fontSize)},removeSerie:function(e){this.series.splice(this.series.indexOf(e),1)},killSeries:function(e){for(var t=0;t<this.series.length;t++)this.series[t].kill(e);this.series=[]},removeSeries:function(){this.killSeries()},handleMouseOutLocal:function(e,t,n){for(var r=0,i=this.series.length;r<i;r++)this.series[r].hideTrackingMarker()}},e}),define("graph.axis.x",["require","./graph.axis"],function(e,t){var n=function(e,t,n){this.init(e,n),this.top=t=="top"};return $.extend(n.prototype,t.prototype,{getAxisPosition:function(){if(!this.options.display)return 0;var e=(this.options.tickPosition==1?15:25)+this.graph.options.fontSize*2;return this.options.allowedPxSerie&&this.series.length>0&&(e+=this.options.allowedPxSerie),e},getAxisWidthHeight:function(){return},_setShift:function(){this.group.setAttribute("transform","translate(0 "+(this.top?this.shift:this.graph.getDrawingHeight()-this.shift)+")")},getMaxSizeTick:function(){return(this.top?-1:1)*(this.options.tickPosition==1?10:10)},drawTick:function(e,t,n,r){var i=this.groupTicks,s=document.createElementNS(this.graph.ns,"line"),o=this.getPos(e);if(o==undefined)return;s.setAttribute("shape-rendering","crispEdges"),s.setAttribute("x1",o),s.setAttribute("x2",o),s.setAttribute("y1",(this.top?1:-1)*this.tickPx1*n),s.setAttribute("y2",(this.top?1:-1)*this.tickPx2*n),t&&this.options.primaryGrid?this.doGridLine(!0,o,o,0,this.graph.getDrawingHeight()):!t&&this.options.secondaryGrid&&this.doGridLine(!1,o,o,0,this.graph.getDrawingHeight()),s.setAttribute("stroke","black"),this.groupTicks.appendChild(s);if(t){var u=this.groupTickLabels,a=document.createElementNS(this.graph.ns,"text");a.setAttribute("x",o),a.setAttribute("y",(this.top?-1:1)*((this.options.tickPosition==1?8:20)+(this.top?10:0))),a.setAttribute("text-anchor","middle"),a.style.dominantBaseline="hanging",this.setTickContent(a,e,r),this.graph.applyStyleText(a),this.groupTickLabels.appendChild(a)}this.ticks.push(s)},drawSpecifics:function(){this.label.setAttribute("text-anchor","middle"),this.label.setAttribute("x",Math.abs(this.getMaxPx()-this.getMinPx())/2+this.getMinPx()),this.label.setAttribute("y",(this.top?-1:1)*((this.options.tickPosition==1?10:15)+this.graph.options.fontSize)),this.line.setAttribute("x1",this.getMinPx()),this.line.setAttribute("x2",this.getMaxPx()),this.line.setAttribute("y1",0),this.line.setAttribute("y2",0),this.labelTspan.style.dominantBaseline="hanging",this.expTspan.style.dominantBaseline="hanging",this.expTspanExp.style.dominantBaseline="hanging"},drawSeries:function(){if(!this.shift)return;this.rectEvent.setAttribute("y",this.top?-this.shift:0),this.rectEvent.setAttribute("height",this.totalDimension),this.rectEvent.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.rectEvent.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx())),this.clipRect.setAttribute("y",this.top?-this.shift:0),this.clipRect.setAttribute("height",this.totalDimension),this.clipRect.setAttribute("x",Math.min(this.getMinPx(),this.getMaxPx())),this.clipRect.setAttribute("width",Math.abs(this.getMinPx()-this.getMaxPx()));for(var e=0,t=this.series.length;e<t;e++)this.series[e].draw()},_draw0Line:function(e){this._0line=document.createElementNS(this.graph.ns,"line"),this._0line.setAttribute("x1",e),this._0line.setAttribute("x2",e),this._0line.setAttribute("y1",0),this._0line.setAttribute("y2",this.getMaxPx()),this._0line.setAttribute("stroke","black"),this.groupGrids.appendChild(this._0line)},addSerie:function(e,t){var n=new GraphSerieAxisX(e,t);return n.setAxis(this),n.init(this.graph,e,t),n.autoAxis(),n.setXAxis(this),this.series.push(n),this.groupSeries.appendChild(n.groupMain),this.groupSeries.setAttribute("clip-path","url(#_clip"+this.axisRand+")"),n},handleMouseMoveLocal:function(e,t,n){e-=this.graph.getPaddingLeft(),this.mouseVal=this.getVal(e)},isXY:function(){return"x"}}),n}),define("graph.axis.y",["require","./graph.axis"],function(e,t){var n=function(e,t,n){this.init(e,n,{flipped:!0}),this.leftright=t,this.left=t=="left"};return $.extend(n.prototype,t.prototype,{getAxisPosition:function(){var e=0;return this.options.display?(this.options.allowedPxSerie&&this.series.length>0&&(e=this.options.allowedPxSerie),e):0},getAxisWidthHeight:function(){return 15},resetTicks:function(){this.longestTick=[!1,0]},getMaxSizeTick:function(){return(this.longestTick[0]?this.longestTick[0].getComputedTextLength():0)+10},drawTick:function(e,t,n,r){var i=this.groupTicks,s,o=0,u=this.getPos(e);if(u==undefined)return;var a=document.createElementNS(this.graph.ns,"line");a.setAttribute("shape-rendering","crispEdges"),a.setAttribute("y1",u),a.setAttribute("y2",u),a.setAttribute("x1",(this.left?1:-1)*this.tickPx1*n),a.setAttribute("x2",(this.left?1:-1)*this.tickPx2*n),a.setAttribute("stroke","black"),t&&this.options.primaryGrid?this.doGridLine(!0,0,this.graph.getDrawingWidth(),u,u):!t&&this.options.secondaryGrid&&this.doGridLine(!1,0,this.graph.getDrawingWidth(),u,u),this.groupTicks.appendChild(a);if(t){var f=this.groupTickLabels;s=document.createElementNS(this.graph.ns,"text"),s.setAttribute("y",u),s.setAttribute("x",this.left?-10:10),this.left?s.setAttribute("text-anchor","end"):s.setAttribute("text-anchor","start"),s.style.dominantBaseline="central",this.graph.applyStyleText(s),this.setTickContent(s,e,r),this.groupTickLabels.appendChild(s),String(s).length>=this.longestTick[1]&&(this.longestTick[0]=s,this.longestTick[1]=String(s.textContent).length)}this.ticks.push(a)},drawSpecifics:function(){this.label.setAttribute("transform","translate("+(this.left?1:-1)*(-this.widthHeightTick-8)+", "+(Math.abs(this.getMaxPx()-this.getMinPx())/2+Math.min(this.getMinPx(),this.getMaxPx()))+") rotate(-90)"),this.line.setAttribute("y1",this.getMinPx()),this.line.setAttribute("y2",this.getMaxPx()),this.line.setAttribute("x1",0),this.line.setAttribute("x2",0)},drawSeries:function(){if(!this.shift)return;this.rectEvent.setAttribute("x",this.left?-this.shift:0),this.rectEvent.setAttribute("width",this.totalDimension),this.rectEvent.setAttribute("y",Math.min(this.getMinPx(),this.getMaxPx())),this.rectEvent.setAttribute("height",Math.abs(this.getMinPx()-this.getMaxPx())),this.clipRect.setAttribute("x",-this.shift),this.clipRect.setAttribute("width",this.totalDimension),this.clipRect.setAttribute("y",Math.min(this.getMinPx(),this.getMaxPx())),this.clipRect.setAttribute("height",Math.abs(this.getMinPx()-this.getMaxPx()));for(var e=0,t=this.series.length;e<t;e++)this.series[e].draw()},_setShift:function(){var e=this.isLeft()?this.getShift():this.graph.getWidth()-this.graph.getPaddingRight()-this.graph.getPaddingLeft()-this.getShift();this.group.setAttribute("transform","translate("+e+" 0)")},isLeft:function(){return this.left},isRight:function(){return!this.left},flip:function(e){return this.options.flipped=!e,this},_draw0Line:function(e){this._0line=document.createElementNS(this.graph.ns,"line"),this._0line.setAttribute("y1",e),this._0line.setAttribute("y2",e),this._0line.setAttribute("x1",0),this._0line.setAttribute("x2",this.graph.getDrawingWidth()),this._0line.setAttribute("stroke","black"),this.groupGrids.appendChild(this._0line)},addSerie:function(e,t){var n=new GraphSerieAxisY(e,t);return n.init(this.graph,e,t),n.setAxis(this),n.autoAxis(),n.setYAxis(this),this.series.push(n),this.groupSeries.appendChild(n.groupMain),this.groupSeries.setAttribute("clip-path","url(#_clip"+this.axisRand+")"),n},handleMouseMoveLocal:function(e,t,n){t-=this.graph.getPaddingTop(),this.mouseVal=this.getVal(t)},scaleToFitAxis:function(e,t,n){var r=0;for(var i=0,s=this.graph.series.length;i<s;i++){if(this.graph.series[i].getXAxis()!=e)continue;r=Math.max(r,this.graph.series[i].getMax(t,n))}this._doZoomVal(0,r)},isXY:function(){return"y"}}),n}),define("graph._serie",[],function(){var e=function(){throw"This serie is not instanciable"};return e.prototype={setAdditionalData:function(e){return this.additionalData=e,this},getAdditionalData:function(){return this.additionalData},kill:function(e){this.graph.plotGroup.removeChild(this.groupMain);if(this.picks&&this.picks.length)for(var t=0,n=this.picks.length;t<n;t++)this.picks[t].kill();this.graph.series.splice(this.graph.series.indexOf(this),1),e||this.graph.redraw()},isMinOrMax:function(e,t,n){if(e==undefined)return this._isMinOrMax.x.min||this._isMinOrMax.x.max||this._isMinOrMax.y.min||this._isMinOrMax.y.max;if(n==undefined&&t!=undefined){this._isMinOrMax[t].min=e,this._isMinOrMax[t].max=e;return}t!=undefined&&n!=undefined&&(this._isMinOrMax[t][n]=e)},hide:function(){this.shown=!1,this.groupMain.setAttribute("display","none"),this.getSymbolForLegend().setAttribute("opacity",.5),this.getTextForLegend().setAttribute("opacity",.5)},show:function(){this.shown=!0,this.groupMain.setAttribute("display","block"),this.getSymbolForLegend().setAttribute("opacity",1),this.getTextForLegend().setAttribute("opacity",1)},toggleShow:function(){if(!this.shown){this.show();return}this.hide()},isShown:function(){return this.shown},getX:function(e){return Math.round(this.getXAxis().getPx(e)*5)/5},getY:function(e){return Math.round(this.getYAxis().getPx(e)*5)/5},isSelected:function(){return this.selected},_checkX:function(e){this.minX=Math.min(this.minX,e),this.maxX=Math.max(this.maxX,e)},_checkY:function(e){this.minY=Math.min(this.minY,e),this.maxY=Math.max(this.maxY,e)},getName:function(){return this.name},autoAxis:function(){return this.setXAxis(this.isFlipped()?this.graph.getYAxis():this.graph.getXAxis()),this.setYAxis(this.isFlipped()?this.graph.getXAxis():this.graph.getYAxis()),this.graph.updateAxes(),this},setXAxis:function(e){return typeof e=="Number"?this.xaxis=this.isFlipped()?this.graph.getYAxis(e):this.graph.getXAxis(e):this.xaxis=e,this},setYAxis:function(e){return typeof e=="Number"?this.xaxis=this.isFlipped()?this.graph.getXAxis(e):this.graph.getYAxis(e):this.yaxis=e,this},getXAxis:function(){return this.xaxis},getYAxis:function(){return this.yaxis},setAxes:function(){for(var e=0;e<2;e++)arguments[e]&&this[arguments[e].isXY()=="x"?"setXAxis":"setYAxis"](arguments[e]);return this},getMinX:function(){return this.minX},getMaxX:function(){return this.maxX},getMinY:function(){return this.minY},getMaxY:function(){return this.maxY},getSymbolForLegend:function(){if(!this.lineForLegend){var e=document.createElementNS(this.graph.ns,"line");this.applyLineStyle(e),e.setAttribute("x1",5),e.setAttribute("x2",25),e.setAttribute("y1",0),e.setAttribute("y2",0),e.setAttribute("cursor","pointer"),this.lineForLegend=e}return this.lineForLegend},getTextForLegend:function(){if(!this.textForLegend){var e=document.createElementNS(this.graph.ns,"text");e.setAttribute("transform","translate(35, 3)"),e.setAttribute("cursor","pointer"),e.textContent=this.getLabel(),this.textForLegend=e}return this.textForLegend},getLabel:function(){return this.options.label||this.name},setLabel:function(e){return this.options.label=e,this},setFlip:function(e){this.options.flip=e},getFlip:function(){return this.options.flip},isFlipped:function(){return this.options.flip}},e}),define("graph.serie",[require,"./graph._serie"],function(e,t){var n=function(){};return $.extend(n.prototype,t.prototype,{defaults:{lineColor:"black",lineStyle:1,flip:!1,label:"",markers:{show:!1,type:1,zoom:1,strokeColor:!1,strokeWidth:1,fillColor:"transparent"},trackMouse:!1,trackMouseLabel:!1,trackMouseLabelRouding:1,lineToZero:!1,lineWidth:1,autoPeakPicking:!1,autoPeakPickingNb:4,autoPeakPickingMinDistance:10},init:function(e,t,r){var i=this;this.graph=e,this.name=t,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},n.prototype.defaults,r),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupLines=document.createElementNS(this.graph.ns,"g"),this.domMarker=document.createElementNS(this.graph.ns,"path"),this.domMarker.style.cursor="pointer",this.groupMain=document.createElementNS(this.graph.ns,"g"),this.additionalData={},this.domMarker.addEventListener("mouseover",function(e){var t=i._getMarkerIndexFromEvent(e);i.onMouseOverMarker(e,t)}),this.domMarker.addEventListener("mouseout",function(e){var t=i._getMarkerIndexFromEvent(e);i.onMouseOutMarker(e,t)}),this.domMarker.addEventListener("click",function(e){var t=i._getMarkerIndexFromEvent(e);i.onClickOnMarker(e,t)}),this.marker=document.createElementNS(this.graph.ns,"circle"),this.marker.setAttribute("fill","black"),this.marker.setAttribute("r",3),this.marker.setAttribute("display","none"),this.markerLabel=document.createElementNS(this.graph.ns,"text"),this.markerLabelSquare=document.createElementNS(this.graph.ns,"rect"),this.markerLabelSquare.setAttribute("fill","white"),this.domMarkerHover={},this.domMarkerSelect={},this.markerHovered=0,this.groupMarkerSelected=document.createElementNS(this.graph.ns,"g"),this.groupLabels=document.createElementNS(this.graph.ns,"g"),this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.lines=[],this.groupMain.appendChild(this.groupLines),this.groupMain.appendChild(this.groupLabels),this.groupMain.appendChild(this.marker),this.groupMain.appendChild(this.domMarker),this.groupMain.appendChild(this.groupMarkerSelected),this.groupMain.appendChild(this.markerLabelSquare),this.groupMain.appendChild(this.markerLabel),this.labels=[],this.currentAction=!1,this.initExtended1&&this.initExtended1()},setData:function(e,t,n){var r=0,i,s,t=t||"2D",n=n||"float",o,u=0,a;if(!e instanceof Array)return;var f=[];e instanceof Array||typeof e!="object"?e instanceof Array&&!(e[0]instanceof Array)&&(e=[e],t="1D"):e=[e];var l=t=="2D";e[0]instanceof Array&&t=="2D"&&!(e[0][0]instanceof Array)&&(e=[e]);if(e[0]instanceof Array)for(var c=0,h=e.length;c<h;c++){o=this._addData(n,l?e[c].length*2:e[c].length),f.push(o),r=0;for(var p=0,d=e[c].length;p<d;p++)l?(o[r]=e[c][p][0],this._checkX(o[r]),r++,o[r]=e[c][p][1],this._checkY(o[r]),r++,u++):(o[r]=e[c][p],this[p%2==0?"_checkX":"_checkY"](o[r]),r++,u+=p%2?1:0)}else if(typeof e[0]=="object"){this.mode="x_equally_separated";var v=0,m=[],f=[],h=0,g;for(var c=0,d=e.length;c<d;c++)v+=e[c].y.length,a=c!=0&&(!e[c+1]||e[c].x+e[c].dx*e[c].y.length==e[c+1].x),a||(f.push(this._addData(n,v)),m.push(v),v=0);this.xData=[],v=0,h=0,r=0;for(var c=0,d=e.length;c<d;c++){i=e[c].x,s=e[c].dx,this.xData.push({x:i,dx:s}),g=e[c].y.length,this._checkX(i),this._checkX(i+s*g);for(var p=0;p<g;p++)f[h][r]=e[c].y[p],this._checkY(f[h][r]),r++,u++;v+=e[c].y.length,m[h]==v&&(h++,v=0,r=0)}}var y=(this.maxX-this.minX)/this.graph.getDrawingWidth(),b=[],w=this.graph.getDrawingWidth()*4,E=u/4,w=this.graph.getDrawingWidth(),E=u;this.data=f;if(w>0){while(w<E)b.push(w),w*=4;this.slots=b,this.options.useSlots&&this.calculateSlots()}if(this.isFlipped()){var S=this.maxX,x=this.maxY,T=this.minX,N=this.minY;this.maxX=x,this.maxY=S,this.minX=N,this.minY=T}return this.graph.updateAxes(),this},_addData:function(e,t){switch(e){case"int":var n=t*4;break;case"float":var n=t*8}var r=new ArrayBuffer(n);switch(e){case"int":return new Int32Array(r);default:case"float":return new Float64Array(r)}},setAdditionalData:function(e){return this.additionalData=e,this},getAdditionalData:function(){return this.additionalData},calculateSlots:function(){var e=this;this.slotsData={},this.slotWorker=new Worker("./src/slotworker.js"),this.slotWorker.onmessage=function(t){e.slotsData[t.data.slot].resolve(t.data.data)};for(var t=0,n=this.slots.length;t<n;t++)this.calculateSlot(this.slots[t],t)},slotCalculator:function(e,t){var n=$.Deferred();return this.slotWorker.postMessage({min:this.minX,max:this.maxX,data:this.data,slot:e,slotNumber:t,flip:this.getFlip()}),n},calculateSlot:function(e,t){var n=this;this.slotsData[e]=this.slotCalculator(e,t),this.slotsData[e].pipe(function(t){return n.slotsData[e]=t,t})},kill:function(e){this.graph.plotGroup.removeChild(this.groupMain);if(this.picks&&this.picks.length)for(var t=0,n=this.picks.length;t<n;t++)this.picks[t].kill();this.graph.series.splice(this.graph.series.indexOf(this),1),e||this.graph.redraw()},onMouseOverMarker:function(e,t){var n=this.toggleMarker(t,!0,!0);this.options.onMouseOverMarker&&this.options.onMouseOverMarker(t,this.infos?this.infos[t[0]]||!1:!1,[this.data[t[1]][t[0]*2],this.data[t[1]][t[0]*2+1]])},onMouseOutMarker:function(e,t){this.markersOffHover(),this.options.onMouseOutMarker&&this.infos&&this.options.onMouseOutMarker(t,this.infos?this.infos[t[0]]||!1:!1,[this.data[t[1]][t[0]*2],this.data[t[1]][t[0]*2+1]])},toggleMarker:function(e,t,n){var r=e[0],i=e[1]||0;e=e.join();var s=n?!this.domMarkerHover[e]:!this.domMarkerSelect[e],o=this["domMarker"+(n?"Hover":"Select")];if(s||t===!0&&t!==!1){if(!o[e]){var u=document.createElementNS(this.graph.ns,"path");this.setMarkerStyleTo(u,!0);var a=this.getX(this.data[i][r*2]),f=this.getY(this.data[i][r*2+1]);u.setAttribute("d","M "+a+" "+f+" "+this.getMarkerPath(this.options.markers.zoom+1).join(" ")),this["domMarker"+(n?"Hover":"Select")][e]=u,this.groupMarkerSelected.appendChild(u),n&&this.markerHovered++}}else if(t===!1||!s)if(n&&this.domMarkerHover[e]&&!this.domMarkerSelect[e]||this.domMarkerSelect[e]){if(!o[e])return;this.groupMarkerSelected.removeChild(o[e]),delete o[e],n&&this.markerHovered--}return s},markersOffHover:function(){for(var e in this.domMarkerHover)this.toggleMarker(e.split(","),!1,!0)},onClickOnMarker:function(e,t){var n=this.toggleMarker(t);n&&this.options.onSelectMarker&&this.options.onSelectMarker(t,this.infos?this.infos[t[0]]||!1:!1),!n&&this.options.onUnselectMarker&&this.options.onUnselectMarker(t,this.infos?this.infos[t[0]]||!1:!1),this.options.onToggleMarker&&this.options.onToggleMarker(t,this.infos?this.infos[t[0]]||!1:!1,n)},_getMarkerIndexFromEvent:function(e){var t=this.graph.getXY(e);return this.searchIndexByPxXY(t.x-this.graph.getPaddingLeft(),t.y-this.graph.getPaddingTop())},onMouseWheel:function(){},empty:function(){for(var e=0,t=this.lines.length;e<t;e++)this.groupLines.removeChild(this.lines[e]);while(this.groupMarkers.firstChild)this.groupMarkers.removeChild(this.groupMarkers.firstChild)},select:function(){this.selected=!0;for(var e=0,t=this.lines.length;e<t;e++)this.applyLineStyle(this.lines[e]);this.applyLineStyle(this.getLineForLegend())},unselect:function(){this.selected=!1;for(var e=0,t=this.lines.length;e<t;e++)this.applyLineStyle(this.lines[e]);this.applyLineStyle(this.getLineForLegend())},draw:function(){var e,t,n,r,i,s,o=0,u=this.data.length,a=0,f,l,c,h,p=this;this.picks=this.picks||[];var d;if(this.options.autoPeakPicking)for(var v=0,l=this.options.autoPeakPickingNb;v<l;v++)d=this.graph.makeShape({type:"label",label:{text:"",position:{x:0},anchor:"middle"}}),d.setSerie(this),this.picks.push(d);this._drawn=!0;var m=this.groupLines.nextSibling;this.groupMain.removeChild(this.groupLines),this.groupMain.removeChild(this.domMarker),this.marker.setAttribute("display","none"),this.markerPath="",this._markerPath=this.getMarkerPath().join(" ");var g=0,y=1;this.isFlipped()&&(g=1,y=0);var b=0;for(;o<u;o++)b+=this.data[o].length/2;o=0;var w=[],E,t=0,S;if(this.options.useSlots&&this.slots){var x=this.graph.getDrawingWidth()*(this.maxX-this.minX)/(this.getXAxis().getActualMax()-this.getXAxis().getActualMin());for(var t=0,S=this.slots.length;t<S;t++)if(x<this.slots[t]){E=this.slotsData[this.slots[t]];break}}if(E)E.done?E.done(function(e){p.drawSlot(e,t)}):this.drawSlot(E,t);else if(this.mode=="x_equally_separated")for(;o<u;o++){c="M ",a=0,f=0,l=this.data[o].length;for(;a<l;a+=1)this.isFlipped()?(r=this.getX(this.xData[o].x+a*this.xData[o].dx),n=this.getY(this.data[o][a])):(n=this.getX(this.xData[o].x+a*this.xData[o].dx),r=this.getY(this.data[o][a])),c=this._addPoint(c,n,r,f),f++;this._createLine(c,o,f)}else for(;o<u;o++){c="M ",a=0,f=0,l=this.data[o].length;for(;a<l;a+=2){i=this.getX(this.data[o][a+g]),s=this.getY(this.data[o][a+y]);if(i==n&&s==r)continue;this.options.autoPeakPicking&&w.push([this.data[o][a+y],this.data[o][a+g]]),c=this._addPoint(c,i,s,f),f++,n=i,r=s}this._createLine(c,o,f)}this.options.autoPeakPicking&&this.makePeakPicking(w),o++;for(;o<this.lines.length;o++)this.groupLines.removeChild(this.lines[o]),this.lines.splice(o,1);this.setMarkerStyleTo(this.domMarker),this.domMarker.setAttribute("d",this.markerPath||"M 0 0"),this.groupMain.appendChild(this.domMarker),this.groupMain.insertBefore(this.groupLines,m);var T;for(var o=0,u=this.labels.length;o<u;o++)this.repositionLabel(this.labels[o])},drawSlot:function(e,t){var n=this.slots[t]/(this.maxX-this.minX),r="M ";k=0;var i=0,s,o,u,a=Math.floor((this.getXAxis().getActualMin()-this.minX)*n),f=Math.ceil((this.getXAxis().getActualMax()-this.minX)*n);for(u=a;u<=f;u++){if(!e[u])continue;s=Math.floor(this.getX(e[u].x)),o=this.getY(e[u].max),this.options.autoPeakPicking&&allY.push([e[u].max,e[u].x]),r=this._addPoint(r,s,this.getY(e[u].start),k),r=this._addPoint(r,s,o,!1,!0),r=this._addPoint(r,s,this.getY(e[u].min)),r=this._addPoint(r,s,this.getY(e[u].stop),!1,!0),k++}this._createLine(r,i,k),i++,console.timeEnd("Slot")},setMarkerStyleTo:function(e,t){e.setAttribute("fill",t?"transparent":this.options.markers.fillColor||"transparent"),e.setAttribute("stroke",this.options.markers.strokeColor||this.getLineColor()),e.setAttribute("stroke-width",this.options.markers.strokeWidth)},makePeakPicking:function(e){var t,n,r=[],n,i=0,s=e.length,o,u,a;e.sort(function(e,t){return t[0]-e[0]});for(;i<s;i++){t=e[i][1],n=this.getX(t),o=0,u=r.length,a=this.getY(e[i][0]);if(n<this.getXAxis().getMinPx()||n>this.getXAxis().getMaxPx())continue;if(a>this.getYAxis().getMinPx()||a<this.getYAxis().getMaxPx())continue;for(;o<u;o++)if(Math.abs(r[o]-n)<this.options.autoPeakPickingMinDistance)break;if(o<u)continue;this.picks[u].set("labelPosition",{x:t,dy:"-10px"}),this.picks[u].data.label[0].text=String(Math.round(t*1e3)/1e3),r.push(n);if(r.length==this.options.autoPeakPickingNb)break}this.graph.redrawShapes()},hideTrackingMarker:function(){this.marker.setAttribute("display","none"),this.markerLabel.setAttribute("display","none"),this.markerLabelSquare.setAttribute("display","none")},_addPoint:function(e,t,n,r,i){var s;return r!==0&&(this.options.lineToZero||i?e+="M ":e+="L "),e+=t,e+=" ",e+=n,e+=" ",this.options.lineToZero&&(s=this.getYAxis().getPos(0))!==undefined&&(e+="L ",e+=t,e+=" ",e+=s,e+=" "),this.options.markers.show?(t>this.getXAxis().getMaxPx()||t<this.getXAxis().getMinPx()||this._drawMarkerXY(t,n),e):e},_createLine:function(e,t,n){if(this.lines[t])var r=this.lines[t];else{var r=document.createElementNS(this.graph.ns,"path");this.applyLineStyle(r)}return n==0?r.setAttribute("d","M 0 0"):r.setAttribute("d",e),this.lines[t]||(this.groupLines.appendChild(r),this.lines[t]=r),r},applyLineStyle:function(e){e.setAttribute("stroke",this.getLineColor()),e.setAttribute("stroke-width",this.getLineWidth()+(this.isSelected()?2:0)),this.getLineDashArray()&&e.setAttribute("stroke-dasharray",this.getLineDashArray()),e.setAttribute("fill","none")},getMarkerPath:function(e,t){var n=e||this.options.markers.zoom,t=t||0,r;switch(this.options.markers.type){case 1:r=["m",-2,-2,"l",4,0,"l",0,4,"l",-4,0,"z"];break;case 2:r=["m",-2,-2,"l",4,4,"l",-4,0,"l",4,-4,"z"]}if((n==1||!n)&&!t)return r;var i="number";for(var s=0,o=r.length;s<o;s++)typeof r[s]==i&&(r[s]*=n);return r},_drawMarkerXY:function(e,t){if(!this.options.markers.show)return;this.markerPath+="M "+e+" "+t+" ",this.markerPath+=this._markerPath+" "},handleLabelMove:function(e,t){var n=this.labelDragging;if(!n)return;n.labelX+=e-n.draggingIniX,n.draggingIniX=e,n.labelY+=t-n.draggingIniY,n.draggingIniY=t,n.rect.setAttribute("x",n.labelX),n.rect.setAttribute("y",n.labelY-this.graph.options.fontSize),n.labelDom.setAttribute("x",n.labelX),n.labelDom.setAttribute("y",n.labelY),n.labelLine.setAttribute("x1",n.labelX+n.labelDom.getComputedTextLength()/2),n.labelLine.setAttribute("y1",n.labelY-this.graph.options.fontSize/2)},handleLabelMainMove:function(e,t){if(this.options.labelMoveFollowCurve||!0){var n=this.labelDragging;n.x=this.getXAxis().getVal(e-this.graph.options.paddingLeft),n.y=this.handleMouseMove(n.x,!1).interpolatedY,this.repositionLabel(n,!0)}},handleLabelUp:function(){this.labelDragging=!1},searchIndexByPxXY:function(e,t){var n=!1,r=!1,i;for(var s=0,o=this.data.length;s<o;s++)for(var u=0,a=this.data[s].length;u<a;u+=2){i=Math.pow(this.getX(this.data[s][u])-e,2)+Math.pow(this.getY(this.data[s][u+1])-t,2);if(!n||i<n)n=i,r=[u/2,s]}return r},searchClosestValue:function(e){var t;for(var n=0;n<this.data.length;n++){if(e<=this.data[n][this.data[n].length-2]&&e>this.data[n][0])t=this._searchBinary(e,this.data[n],!1);else{if(!(e>=this.data[n][this.data[n].length-2]&&e<this.data[n][0]))continue;t=this._searchBinary(e,this.data[n],!0)}return{dataIndex:n,xMin:this.data[n][t],xMax:this.data[n][t+2],yMin:this.data[n][t+1],yMax:this.data[n][t+3],xBeforeIndex:t/2,xAfterIndex:t/2+2,xBeforeIndexArr:t}}},handleMouseMove:function(e,t){var n=e||this.getXAxis().getMouseVal(),r,i,s,o,u,a=this.searchClosestValue(n);if(!a)return;var f=(n-a.xMin)/(a.xMax-a.xMin),l=(1-f)*a.yMin+f*a.yMax;if(t&&this.options.trackMouse){if(!i)return!1;var e=this.getX(this.getFlip()?l:n),c=this.getY(this.getFlip()?n:l);this.marker.setAttribute("display","block"),this.marker.setAttribute("cx",e),this.marker.setAttribute("cy",c),this.markerLabel.setAttribute("display","block"),this.markerLabelSquare.setAttribute("display","block");switch(this.options.trackMouseLabel){case!1:break;default:this.markerLabel.textContent=this.options.trackMouseLabel.replace("<x>",n.toFixed(this.options.trackMouseLabelRouding)).replace("<y>",l.toFixed(this.options.trackMouseLabelRouding))}this.markerLabel.setAttribute("x",e+5),this.markerLabel.setAttribute("y",c-5),this.markerLabelSquare.setAttribute("x",e+5),this.markerLabelSquare.setAttribute("y",c-5-this.graph.options.fontSize),this.markerLabelSquare.setAttribute("width",this.markerLabel.getComputedTextLength()+2),this.markerLabelSquare.setAttribute("height",this.graph.options.fontSize+2)}return{xBefore:a.xMin,xAfter:a.xMax,yBefore:a.yMin,yAfter:a.yMax,trueX:n,interpolatedY:l,xBeforeIndex:a.xBeforeIndex}},_searchBinary:function(e,t,n){var r=0,i=t.length,s=i-2;if(t[r]==e)return r;if(t[s]==e)return s;var o,u=0;for(;;){u++;if(u>100)throw"Error loop";o=(r+s)/2,o-=o%2;if(o==r||t[o]==e)return o;t[o]<=e?n?s=o:r=o:t[o]>e&&(n?r=o:s=o)}},getMax:function(e,t){var n=Math.min(e,t),r=Math.max(e,t),i=this.searchClosestValue(n),s=this.searchClosestValue(r),o,u,a=0,f,l;for(o=i.dataIndex;o<=s.dataIndex;o++){f=o==i.dataIndex?i.xBeforeIndexArr:0,l=o==s.dataIndex?s.xBeforeIndexArr:this.data[o].length;for(u=f;u<=l;u+=2)a=Math.max(a,this.data[o][u+1])}return a},setLineStyle:function(e){this.options.lineStyle=e},getLineStyle:function(){return this.options.lineStyle},getLineDashArray:function(){switch(this.options.lineStyle){case 2:return"5, 5";case!1:case 1:return!1;default:return this.options.lineStyle}},setLineWidth:function(e){return this.options.lineWidth=e,this},getLineWidth:function(){return this.options.lineWidth},setLineColor:function(e){return this.options.lineColor=e,this},getLineColor:function(){return this.options.lineColor},showMarkers:function(e){return this.options.markers.show=!0,!e&&this._drawn&&this.draw(),this},hideMarkers:function(e){return this.options.markers.show=!1,!e&&this._drawn&&this.draw(),this},markersShown:function(){return this.options.markers.show},setMarkerType:function(e,t){return this.options.markers.type=e,!t&&this._drawn&&this.draw(),this},setMarkerZoom:function(e,t){return this.options.markers.zoom=e,!t&&this._drawn&&this.draw(),this},setMarkerStrokeColor:function(e,t){this.options.markers.strokeColor=e,!t&&this._drawn&&this.draw()},setMarkerStrokeWidth:function(e,t){this.options.markers.strokeWidth=e,!t&&this._drawn&&this.draw()},setMarkerFillColor:function(e,t){this.options.markers.fillColor=e,!t&&this._drawn&&this.draw()},addLabelX:function(e,t){this.addLabelObj({x:e,label:t})},addLabel:function(e,t,n){this.addLabelObj({x:e,y:t,label:n})},repositionLabel:function(e,t){var n=this.getFlip()?this.getY(e.x):this.getX(e.x),r=this.getFlip()?this.getX(e.y):this.getY(e.y),i=isNaN(n)||isNaN(r);e.group.setAttribute("display",i?"none":"block"),t&&(e.labelDom.textContent=this.options.label.replace("<x>",e.x.toFixed(this.options.trackMouseLabelRouding)||"").replace("<label>",e.label||""),e.rect.setAttribute("width",e.labelDom.getComputedTextLength()+2));if(i)return;e.group.setAttribute("transform","translate("+n+" "+r+")")},addLabelObj:function(e){var t=this,n,r,i,s;this.labels.push(e),e.x&&!e.y&&(e.y=this.handleMouseMove(e.x,!1).interpolatedY),n=document.createElementNS(this.graph.ns,"g"),this.groupLabels.appendChild(n),r=document.createElementNS(this.graph.ns,"text"),r.setAttribute("x",5),r.setAttribute("y",-5);var o=document.createElementNS(this.graph.ns,"line");o.setAttribute("stroke","black"),o.setAttribute("x2",0),o.setAttribute("x1",0),n.appendChild(o),n.appendChild(r),i=document.createElementNS(this.graph.ns,"rect"),i.setAttribute("x",5),i.setAttribute("y",-this.graph.options.fontSize-5),i.setAttribute("width",r.getComputedTextLength()+2),i.setAttribute("height",this.graph.options.fontSize+2),i.setAttribute("fill","white"),i.style.cursor="move",r.style.cursor="move",s=document.createElementNS(this.graph.ns,"path"),s.setAttribute("d","M 0 -4 l 0 8 m -4 -4 l 8 0"),s.setAttribute("stroke-width","1px"),s.setAttribute("stroke","black"),s.style.cursor="move",n.insertBefore(i,r),n.appendChild(s),e.labelLine=o,e.group=n,e.rect=i,e.labelDom=r,e.path=s,e.labelY=-5,e.labelX=5,this.bindLabelHandlers(e),this.repositionLabel(e,!0)},bindLabelHandlers:function(e){function n(n){if(t.graph.currentAction!==!1)return;t.graph.currentAction="labelDragging",n.stopPropagation(),e.dragging=!0;var r=t.graph.getXY(n);e.draggingIniX=r.x,e.draggingIniY=r.y,t.labelDragging=e}function r(n){if(t.graph.currentAction!==!1)return;n.stopPropagation(),n.preventDefault(),t.graph.currentAction="labelDraggingMain",t.labelDragging=e}var t=this;e.labelDom.addEventListener("mousedown",n),e.rect.addEventListener("mousedown",n),e.rect.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),e.labelDom.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()}),e.path.addEventListener("mousedown",r),e.path.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation()})},getMarkerForLegend:function(){if(!this.markersShown())return;if(!this.markerForLegend){var e=document.createElementNS(this.graph.ns,"path");this.setMarkerStyleTo(e,!0),e.setAttribute("d","M 14 0 "+this.getMarkerPath(this.options.markers.zoom+1).join(" ")),this.markerForLegend=e}return this.markerForLegend}}),n}),define("graph.serie.contour",["require","./graph.serie"],function(e,t){var n=function(){this.accumulatedDelta=0,this.threshold=0};return $.extend(n.prototype,t.prototype,{setData:function(e,t,n){var r=0,i,s,t=t||"2D",n=n||"float",o,u=e.length,a,f=[];if(!e instanceof Array)return;for(var o=0;o<u;o++){k=k=e[o].lines.length,a=this._addData(n,k);for(var l=0;l<k;l+=2)a[l]=e[o].lines[l],this._checkX(a[l]),a[l+1]=e[o].lines[l+1],this._checkY(a[l+1]);f.push({lines:a,zValue:e[o].zValue})}return this.data=f,this},draw:function(e){var t,n,r,i,s,o,u=0,a=this.data.length,f=0,l,c,h,p,d;this.minZ=-Number.MAX_VALUE,this.maxZ=Number.MAX_VALUE;var v=this.groupLines.nextSibling;this.groupMain.removeChild(this.groupLines),this.zValues={};var m=0,g=1;this.getFlip()&&(m=0,g=1);for(;u<a;u++){f=0,l=0,h="";for(d=this.data[u].lines,c=d.length;f<c;f+=4)s=Math.round(this.getX(d[f+m])),o=Math.round(this.getY(d[f+g])),h+="M",h+=s,h+=" ",h+=o,r=Math.round(this.getX(d[f+2+m])),i=Math.round(this.getY(d[f+2+g])),h+="L",h+=r,h+=" ",h+=i,l++;p=this._createLine(h,u,l),p.setAttribute("data-zvalue",this.data[u].zValue),this.zValues[this.data[u].zValue]={dom:p},this.minZ=Math.max(this.minZ,this.data[u].zValue),this.maxZ=Math.min(this.maxZ,this.data[u].zValue)}u++;for(;u<this.lines.length;u++)this.groupLines.removeChild(this.lines[u]),this.lines.splice(u,1);this.groupMain.insertBefore(this.groupLines,v)},onMouseWheel:function(e,t){this.accumulatedDelta=Math.min(1,Math.max(-1,this.accumulatedDelta+Math.min(.1,Math.max(-0.1,e)))),this.threshold=Math.max(-this.minZ,this.maxZ)*Math.pow(this.accumulatedDelta,3);for(var n in this.zValues)this.zValues[n].dom.setAttribute("display",Math.abs(n)<this.threshold?"none":"block")}}),n}),define("graph.serie.scatter",[require,"./graph._serie"],function(e,t){var n=function(){};return $.extend(n.prototype,t.prototype,{defaults:{label:""},init:function(e,t,r){var i=this;this.graph=e,this.name=t,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},n.prototype.defaults,r),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupPoints=document.createElementNS(this.graph.ns,"g"),this.groupMain=document.createElementNS(this.graph.ns,"g"),this.errorPath=document.createElementNS(this.graph.ns,"path"),this.errorPath.setAttribute("stroke","black"),this.errorPath.setAttribute("fill","transparent"),this.errorPath.setAttribute("stroke-width","1px"),this.groupMain.appendChild(this.errorPath),this.additionalData={},this.groupPoints.addEventListener("mouseover",function(e){}),this.groupPoints.addEventListener("mouseout",function(e){}),this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.groupMain.appendChild(this.groupPoints),this.currentAction=!1,this.initExtended1&&this.initExtended1(),this.stdStyle={shape:"circle",cx:0,cy:0,r:3,stroke:"transparent",fill:"black"}},setData:function(e,t,n){var r=0,i,s,t=t||"2D",n=n||"float",o,u=0,a;if(!e instanceof Array)return;e instanceof Array&&!(e[0]instanceof Array)&&(t="1D");var f=t=="2D";o=this._addData(n,f?e.length*2:e.length),r=0;for(var l=0,c=e.length;l<c;l++)f?(o[r]=e[l][0],this._checkX(o[r]),r++,o[r]=e[l][1],this._checkY(o[r]),r++,u++):(o[r]=e[l],this[l%2==0?"_checkX":"_checkY"](o[r]),r++,u+=l%2?1:0);return this.graph.updateAxes(),this.data=o,this},_addData:function(e,t){switch(e){case"int":var n=t*4;break;case"float":var n=t*8}var r=new ArrayBuffer(n);switch(e){case"int":return new Int32Array(r);default:case"float":return new Float64Array(r)}},empty:function(){while(this.group.firstChild)this.group.removeChild(this.group.firstChild)},select:function(){this.selected=!0},unselect:function(){this.selected=!1},setDataStyle:function(e,t){return this.stdStylePerso=e,this.extraStyle=t,this},draw:function(){var e,t,n,r,i=0,s,o,u,a,f=this;this._drawn=!0,this.groupMain.removeChild(this.groupPoints);var l=0,c=1;this.getFlip()&&(l=1,c=0);var h=this.data.length/2;i=0,s=0,o=this.data.length;var p,d="";for(;i<o;i+=2){n=this.getX(this.data[i+l]),r=this.getY(this.data[i+c]);var v=this.data[i+c],m;if(p=this.error[i/2])d+="M "+n+" "+r,p[0]&&(d+=this.doErrorDraw("y",p[0],this.data[i+c],r,d)),p[1]&&(d+=this.doErrorDraw("x",p[1],this.data[i+l],n,d));this._addPoint(n,r,i/2)}this.errorPath.setAttribute("d",d),this.groupMain.appendChild(this.groupPoints)},doErrorDraw:function(e,t,n,r,i){t instanceof Array||(t=[t]);var s=e=="y"?"getY":"getX";for(var o=0,u=t.length;o<u;o++)t[o]instanceof Array?(i=this.makeError(e,o,i,this[s](n+t[o][0]),r),i=this.makeError(e,o,i,this[s](n-t[o][1]),r)):(i=this.makeError(e,o,i,this[s](n+t[o]),r),i=this.makeError(e,o,i,this[s](n-t[o]),r));return i},setMaxErrorLevel:function(e){return this.maxLevel=e,this},makeError:function(e,t,n,r,i){if(t>=this.maxLevel)return n;var s=this.maxLevel-t;if(s==1)return this["makeBar"+e.toUpperCase()](n,r,i);if(s==2)return this["makeBox"+e.toUpperCase()](n,r,i)},makeBarY:function(e,t,n){return e+" V "+t+" m -10 0 h 20 m -10 0 V "+n+" "},makeBoxY:function(e,t,n){return e+" h 5 V "+t+" h -10 V "+n+" h 5 "},makeBarX:function(e,t,n){return e+" H "+t+" m 0 -10 v 20 m 0 -10 H "+n+" "},makeBoxX:function(e,t,n){return e+" v 5 H "+t+" v -10 H "+n+" v 5 "},_addPoint:function(e,t,n){var r=document.createElementNS(this.graph.ns,"g");r.setAttribute("transform","translate("+e+", "+t+")"),this.extraStyle&&this.extraStyle[n]?this.doShape(r,this.extraStyle[n]):this.stdStylePerso?this.doShape(r,this.stdStylePerso):this.doShape(r,this.stdStyle),this.groupPoints.appendChild(r)},doShape:function(e,t){var n=document.createElementNS(this.graph.ns,t.shape);for(var r in t)r!=="shape"&&n.setAttribute(r,t[r]);e.appendChild(n)},setDataError:function(e){this.error=e}}),n}),define("graph.serie.zone",[require,"./graph._serie"],function(e,t){var n=function(){};return $.extend(n.prototype,t.prototype,{defaults:{label:"",fillColor:"rgba( 0, 0, 0, 0.1 )",lineColor:"rgba( 0, 0, 0, 1 )",lineWidth:"1px"},init:function(e,t,r){var i=this;this.graph=e,this.name=t,this.id=Math.random()+Date.now(),this.shown=!0,this.options=$.extend(!0,{},n.prototype.defaults,r),this.data=[],this._isMinOrMax={x:{min:!1,max:!1},y:{min:!1,max:!1}},this.groupZones=document.createElementNS(this.graph.ns,"g"),this.groupMain=document.createElementNS(this.graph.ns,"g"),this.lineZone=document.createElementNS(this.graph.ns,"path"),this.lineZone.setAttribute("stroke","black"),this.lineZone.setAttribute("stroke-width","1px"),this.additionalData={},this.minX=Number.MAX_VALUE,this.minY=Number.MAX_VALUE,this.maxX=Number.MIN_VALUE,this.maxY=Number.MIN_VALUE,this.groupMain.appendChild(this.groupZones),this.groupZones.appendChild(this.lineZone),this.currentAction=!1,this.initExtended1&&this.initExtended1()},setData:function(e,t,n){var r=0,i,s,t=t||"2D",n=n||"float",o,u=0,a;if(!e instanceof Array)return;var f;e instanceof Array&&!(e[0]instanceof Array)?(t="1D",f=e.length*1.5,e[1]instanceof Array||(t="1D_flat",f=e.length*1)):e instanceof Array&&!(e[0][1]instanceof Array)?(t="2D_flat",f=e.length*3):(t="2D",f=e.length*3),o=this._addData(n,f),r=0;for(var l=0,c=e.length;l<c;l++)if(t=="2D"||t=="2D_flat")o[r]=e[l][0],this._checkX(o[r]),r++,t=="2D"?(o[r]=e[l][1][0],this._checkY(o[r]),r++,u++,o[r]=e[l][1][1],this._checkY(o[r]),r++,u++):(o[r]=e[l][1],this._checkY(o[r]),r++,u++,o[r]=e[l][2],this._checkY(o[r]),r++,u++);else if(t=="1D_flat"){if(l%3==0){o[r]=e[l],this._checkX(o[r]),r++,u++;continue}o[r]=e[l],this._checkY(o[r]),r++,u++}else{if(l%2==0){o[r]=e[l],this._checkX(o[r]),r++,u++;continue}o[r]=e[l][0],this_checkY(o[r]),r++,u++,o[r]=e[l][1],this_checkY(o[r]),r++,u++}return this.graph.updateAxes(),this.data=o,this},_addData:function(e,t){switch(e){case"int":var n=t*4;break;case"float":var n=t*8}var r=new ArrayBuffer(n);switch(e){case"int":return new Int32Array(r);default:case"float":return new Float64Array(r)}},empty:function(){while(this.group.firstChild)this.group.removeChild(this.group.firstChild)},select:function(){this.selected=!0},unselect:function(){this.selected=!1},setDataStyle:function(e,t){return this.stdStylePerso=e,this.extraStyle=t,this},draw:function(){var e,t,n,r,i,s=0,o,u,a,f,l=this;this._drawn=!0,this.groupMain.removeChild(this.groupZones);var c=this.data.length/2;s=0,o=0,u=this.data.length;var h,p="",d="",v="",m=[],g=[];for(;s<u;s+=3)n=this.getX(this.data[s]),r=this.getY(this.data[s+1]),i=this.getY(this.data[s+2]),i>r?(m.push([n,r]),g.push([n,i])):(m.push([n,i]),g.push([n,r]));g.reverse(),this.lineZone.setAttribute("d","M "+m[0]+" L "+m.join(" L ")+" L "+g.join(" L ")+" z"),this.applyLineStyle(this.lineZone),this.groupMain.appendChild(this.groupZones)},applyLineStyle:function(e){e.setAttribute("stroke",this.getLineColor()),e.setAttribute("stroke-width",this.getLineWidth()),e.setAttribute("fill",this.getFillColor())},setLineWidth:function(e){return this.options.lineWidth=e,this},getLineWidth:function(){return this.options.lineWidth},setLineColor:function(e){return this.options.lineColor=e,this},getLineColor:function(){return this.options.lineColor},setFillColor:function(e){return this.options.fillColor=e,this},getFillColor:function(){return this.options.fillColor}}),n}),define("graph.legend",[],function(){var e={frame:!1,backgroundColor:"transparent",frameWidth:0,frameColor:"transparent",paddingTop:10,paddingLeft:10,paddingBottom:10,paddingRight:10,movable:!1},t=function(t,n){this.options=$.extend({},e,n),this.graph=t,this.svg=document.createElementNS(this.graph.ns,"g"),this.rect=document.createElementNS(this.graph.ns,"rect"),this.rectBottom=document.createElementNS(this.graph.ns,"rect"),this.rect.setAttribute("x",0),this.rect.setAttribute("y",0),this.rectBottom.setAttribute("x",0),this.rectBottom.setAttribute("y",0),this.pos={x:undefined,y:undefined,transformX:0,transformY:0},this.setEvents()};return t.prototype={setPosition:function(e,t,n){if(!e)return;var r=this.graph.getPosition(e);t=="right"&&(r.x-=this.width),n=="bottom"&&(r.y-=this.height),this.pos.transformX=r.x,this.pos.transformY=r.y,this._setPosition()},update:function(){var e=this;this.applyStyle();while(this.svg.hasChildNodes())this.svg.removeChild(this.svg.lastChild);this.svg.appendChild(this.rectBottom);var t=this.graph.getSeries(),n,r,i;for(var s=0,o=t.length;s<o;s++)(function(n){var r,i,o;r=document.createElementNS(e.graph.ns,"g"),r.setAttribute("transform","translate(0, "+(s*16+10+e.options.paddingTop)+")"),e.svg.appendChild(r);var i=t[n].getLineForLegend(),u=t[n].getMarkerForLegend(),o=t[n].getTextForLegend();r.appendChild(i),u&&r.appendChild(u),r.appendChild(o),r.addEventListener("click",function(r){var i=t[n];i.isSelected()?(i.hide(),e.graph.unselectSerie(i)):i.isShown()?e.graph.selectSerie(i):i.show()})})(s);var u=this.svg.getBBox();this.width=u.width+this.options.paddingRight,this.height=u.height+this.options.paddingBottom,this.rect.setAttribute("width",this.width),this.rect.setAttribute("height",this.height),this.rect.setAttribute("fill","none"),this.rect.setAttribute("pointer-events","fill"),this.rect.setAttribute("display","none"),this.options.movable&&(this.rectBottom.style.cursor="move"),this.rectBottom.setAttribute("width",this.width),this.rectBottom.setAttribute("height",this.height),this.svg.appendChild(this.rect)},getDom:function(){return this.svg},setEvents:function(){var e=this,t=this.pos,n=function(n){e.options.movable&&(t.x=n.clientX,t.y=n.clientY,n.stopPropagation(),n.preventDefault(),e.mousedown=!0,e.graph.shapeMoving(e),e.rect.setAttribute("display","block"))},r=function(t){e.handleMouseMove(t)};this.rectBottom.addEventListener("mousedown",n),this.rectBottom.addEventListener("mousemove",r),this.rect.addEventListener("mousemove",r)},handleMouseUp:function(e){e.stopPropagation(),e.preventDefault(),this.mousedown=!1,this.rect.setAttribute("display","none"),this.graph.shapeStopMoving()},handleMouseMove:function(e){if(!this.mousedown)return;var t=this.pos,n=e.clientX-t.x,r=e.clientY-t.y;t.transformX+=n,t.transformY+=r,t.x=e.clientX,t.y=e.clientY,e.stopPropagation(),e.preventDefault(),this._setPosition()},_setPosition:function(){var e=this.pos;this.svg.setAttribute("transform","translate("+e.transformX+", "+e.transformY+")")},applyStyle:function(){this.options.frame&&(this.rectBottom.setAttribute("stroke",this.options.frameColor),this.rectBottom.setAttribute("stroke-width",this.options.frameWidth+"px")),this.rectBottom.setAttribute("fill",this.options.backgroundColor)}},t}),define("graph",["jquery","require","./graph.axis.x","./graph.axis.y","./graph.serie","./graph.serie.contour","./graph.serie.scatter","./graph.serie.zone","./graph.legend"],function(e,t,n,r,i,s,o,u,a){function f(e){return e&&e.indexOf&&e.indexOf("px")>-1?parseInt(e.replace("px","")):!1}var l=this,c={paddingTop:30,paddingBottom:5,paddingLeft:20,paddingRight:20,close:{left:!0,right:!0,top:!0,bottom:!0},title:"",lineToZero:!1,fontSize:12,fontFamily:"Myriad Pro, Helvetica, Arial",addLabelOnClick:!1,onVerticalTracking:!1,onHorizontalTracking:!1,rangeLimitX:10,rangeLimitY:0,plugins:[],pluginAction:{},wheel:{},dblclick:{}},h=function(t,i,s){this._creation=Date.now()+Math.random(),typeof t=="string"&&(t=document.getElementById(t)),this.options=e.extend({},c,i),this.axis={left:[],top:[],bottom:[],right:[]},this.title=!1,this.shapes=[],this.ns="http://www.w3.org/2000/svg",this.nsxlink="http://www.w3.org/1999/xlink",this.series=[],this._dom=t,this.doDom(),this.setSize(e(t).width(),e(t).height()),this._resize(),this.registerEvents(),this.trackingLines={id:0,current:!1,dasharray:[!1,"5, 5","5, 1","1, 5"],currentDasharray:[],vertical:[],horizontal:[]},this.shapeHandlers={mouseDown:[],mouseUp:[],mouseMove:[],mouseOver:[],mouseOut:[]},this.pluginsReady=e.Deferred(),this.currentAction=!1;var o;if(s)for(var u in s)for(var a=0,f=s[u].length;a<f;a++){switch(u){case"top":o="setTopAxis";var l=new n(this,"top",s[u][a]);break;case"bottom":o="setBottomAxis";var l=new n(this,"bottom",s[u][a]);break;case"left":o="setLeftAxis";var l=new r(this,"left",s[u][a]);break;case"right":o="setRightAxis";var l=new r(this,"right",s[u][a])}this[o](l,a)}this._pluginsInit()};return h.prototype={setAttributeTo:function(e,t,n){var r;if(n)for(r in t)e.setAttributeNS(n,r,t[r]);else for(r in t)e.setAttribute(r,t[r])},doDom:function(){this.dom=document.createElementNS(this.ns,"svg"),this.dom.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.setAttributeTo(this.dom,{xmlns:this.ns,"font-family":this.options.fontFamily,"font-size":this.options.fontSize}),this._dom.appendChild(this.dom),this._dom.setAttribute("tabindex",1),this._dom.style.outline="none",this.defs=document.createElementNS(this.ns,"defs"),this.dom.appendChild(this.defs),this.rectEvent=document.createElementNS(this.ns,"rect"),this.setAttributeTo(this.rectEvent,{"pointer-events":"fill",fill:"transparent"}),this.dom.appendChild(this.rectEvent),this.domTitle=document.createElementNS(this.ns,"text"),this.setTitle(this.options.title),this.setAttributeTo(this.domTitle,{"text-anchor":"middle",y:20}),this.dom.appendChild(this.domTitle),this.graphingZone=document.createElementNS(this.ns,"g"),this.setAttributeTo(this.graphingZone,{transform:"translate("+this.options.paddingLeft+", "+this.options.paddingTop+")"}),this.dom.appendChild(this.graphingZone),this.axisGroup=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.axisGroup),this.shapeZone=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.shapeZone),this.plotGroup=document.createElementNS(this.ns,"g"),this.graphingZone.appendChild(this.plotGroup),this._makeClosingLines(),this.clip=document.createElementNS(this.ns,"clipPath"),this.clip.setAttribute("id","_clipplot"+this._creation),this.defs.appendChild(this.clip),this.clipRect=document.createElementNS(this.ns,"rect"),this.clip.appendChild(this.clipRect),this.clip.setAttribute("clipPathUnits","userSpaceOnUse"),this.markerArrow=document.createElementNS(this.ns,"marker"),this.markerArrow.setAttribute("viewBox","0 0 10 10"),this.markerArrow.setAttribute("id","arrow"+this._creation),this.markerArrow.setAttribute("refX","0"),this.markerArrow.setAttribute("refY","5"),this.markerArrow.setAttribute("markerUnits","strokeWidth"),this.markerArrow.setAttribute("markerWidth","4"),this.markerArrow.setAttribute("markerHeight","3"),this.markerArrow.setAttribute("orient","auto");var e=document.createElementNS(this.ns,"path");e.setAttribute("d","M 0 0 L 10 5 L 0 10 z"),e.setAttribute("fill","context-stroke"),this.markerArrow.appendChild(e),this.defs.appendChild(this.markerArrow),this.vertLineArrow=document.createElementNS(this.ns,"marker"),this.vertLineArrow.setAttribute("viewBox","0 0 10 10"),this.vertLineArrow.setAttribute("id","verticalline"+this._creation),this.vertLineArrow.setAttribute("refX","0"),this.vertLineArrow.setAttribute("refY","5"),this.vertLineArrow.setAttribute("markerUnits","strokeWidth"),this.vertLineArrow.setAttribute("markerWidth","20"),this.vertLineArrow.setAttribute("markerHeight","10"),this.vertLineArrow.setAttribute("orient","auto"),this.vertLineArrow.setAttribute("stroke-width","1px");var t=document.createElementNS(this.ns,"path");t.setAttribute("d","M 0 -10 L 0 10"),t.setAttribute("stroke","black"),this.vertLineArrow.appendChild(t),this.defs.appendChild(this.vertLineArrow),this.plotGroup.setAttribute("clip-path","url(#_clipplot"+this._creation+")"),this.bypassHandleMouse=!1},setOption:function(e,t){this.options[e]=t},kill:function(){this._dom.removeChild(this.dom)},getXY:function(t){var n=t.clientX,r=t.clientY,i=e(this._dom).offset();return n-=i.left-window.scrollX,r-=i.top-window.scrollY,{x:n,y:r}},registerEvents:function(){var e=this;this._dom.addEventListener("keydown",function(t){t.preventDefault(),t.stopPropagation(),t.keyCode==8&&e.selectedShape&&e.selectedShape.kill()}),this.dom.addEventListener("mousemove",function(t){t.preventDefault();var n=e.getXY(t);e.handleMouseMove(n.x,n.y,t)}),this.dom.addEventListener("mousedown",function(t){e.focus(),t.preventDefault();if(t.which==3||t.ctrlKey)return;var n=e.getXY(t);e.handleMouseDown(n.x,n.y,t)}),this.dom.addEventListener("mouseup",function(t){t.preventDefault();var n=e.getXY(t);e.handleMouseUp(n.x,n.y,t)}),this.dom.addEventListener("dblclick",function(t){t.preventDefault(),e.clickTimeout&&window.clearTimeout(e.clickTimeout);var n=e.getXY(t);e.cancelClick=!0,e.handleDblClick(n.x,n.y,t)}),this.dom.addEventListener("click",function(t){if(t.which==3||t.ctrlKey)return;t.preventDefault();var n=e.getXY(t);e.clickTimeout&&window.clearTimeout(e.clickTimeout),e.clickTimeout=window.setTimeout(function(){e.handleClick(n.x,n.y,t)},200)}),this.rectEvent.addEventListener("mousewheel",function(t){t.preventDefault(),t.stopPropagation();var n=t.wheelDeltaY||t.wheelDelta||-t.deltaY;return e.handleMouseWheel(n,t),!1}),this.rectEvent.addEventListener("wheel",function(t){t.stopPropagation(),t.preventDefault();var n=t.wheelDeltaY||t.wheelDelta||-t.deltaY;return e.handleMouseWheel(n,t),!1})},focus:function(){this._dom.focus()},allowPlugin:function(e,t){if(this.forcedPlugin==t)return!0;var n=this.options.pluginAction[t]||{},r=e.shiftKey,i=e.ctrlKey;return r!==n.shift?!1:i!==n.ctrl?!1:!0},handleMouseDown:function(t,n,r){var i=this,s=e(r.target),o=r.shiftKey,u=r.ctrlKey,a=this.options.pluginAction,f;this.unselectShape();if(this.forcedPlugin){this.activePlugin=this.forcedPlugin,console.log(this.activePlugin),this._pluginExecute(this.activePlugin,"onMouseDown",[this,t,n,r]);return}for(f in a){if(!a[f]._forced){if(o!==a[f].shift)continue;if(u!==a[f].ctrl)continue}this.activePlugin=f,this._pluginExecute(f,"onMouseDown",[this,t,n,r]);break}},handleMouseMove:function(e,t,n){if(this.bypassHandleMouse){this.bypassHandleMouse.handleMouseMove(n);return}if(this._pluginExecute(this.activePlugin,"onMouseMove",[this,e,t,n]))return;return},forcePlugin:function(e){this.forcedPlugin=e},unforcePlugin:function(){this.forcedPlugin=!1},handleMouseUp:function(e,t,n){if(this.bypassHandleMouse){this.bypassHandleMouse.handleMouseUp(n),this.activePlugin=!1;return}this._pluginExecute(this.activePlugin,"onMouseUp",[this,e,t,n]),this.activePlugin=!1},isZooming:function(){return this.currentAction=="zooming"},handleMouseWheel:function(e,t){t.preventDefault(),t.stopPropagation();if(!this.options.wheel.type)return;switch(this.options.wheel.type){case"plugin":var n;(n=this._plugins[this.options.wheel.plugin])&&n.onMouseWheel(e,t);break;case"toSeries":for(var r=0,i=this.series.length;r<i;r++)this.series[r].onMouseWheel(e,t)}this.redraw(),this.drawSeries(!0)},handleClick:function(e,t,n){if(!this.options.addLabelOnClick)return;if(this.currentAction!==!1)return;for(var r=0,i=this.series.length;r<i;r++)this.series[r].addLabelX(this.series[r].getXAxis().getVal(e-this.getPaddingLeft()))},shapeMoving:function(e){this.bypassHandleMouse=e},shapeStopMoving:function(){this.bypassHandleMouse=!1},handleDblClick:function(e,t,n){var r=this.options.dblclick;if(!r||!r.type)return;switch(r.type){case"plugin":var i;(i=this._plugins[r.plugin])&&i.onDblClick(this,e,t,r.options,n)}},resetAxis:function(){while(this.axisGroup.firstChild)this.axisGroup.removeChild(this.axisGroup.firstChild);this.axis.left=[],this.axis.right=[],this.axis.bottom=[],this.axis.top=[]},resetSeries:function(){for(var e=0;e<this.series.length;e++)this.series[e].kill(!0);this.series=[]},applyToAxis:{string:function(e,t,n){for(var r=0;r<this.axis[e].length;r++)this.axis[e][r][t].apply(this.axis[e][r],n)},"function":function(e,t,n){for(var r=0;r<this.axis[e].length;r++)t.call(this,this.axis[e][r],e)}},applyToAxes:function(e,t,n,r){var i=[],s=0,o;if(n||n==undefined)i.push("top"),i.push("bottom");if(r||r==undefined)i.push("left"),i.push("right");for(o=i.length;s<o;s++)this.applyToAxis[typeof e].call(this,i[s],e,t)},setWidth:function(e,t){this.width=e,t||this._resize()},getWidth:function(){return this.width},setHeight:function(e,t){this.height=e,t||this._resize()},getHeight:function(){return this.height},resize:function(e,t){this.setSize(e,t),this._resize()},setSize:function(e,t){this.setWidth(e,!0),this.setHeight(t,!0),this.getDrawingHeight(),this.getDrawingWidth()},getDom:function(){return this.dom},applyStyleText:function(e){},getXAxis:function(e,t){return this.axis.top.length>0&&this.axis.bottom.length==0?this.getTopAxis(e,t):this.getBottomAxis(e,t)},getYAxis:function(e,t){return this.axis.right.length>0&&this.axis.left.length==0?this.getRightAxis(e,t):this.getLeftAxis(e,t)},_getAxis:function(e,t,n,r){return e=e||0,typeof e=="object"&&(t=e,e=0),this.axis[r][e]=this.axis[r][e]||new n(this,r,t)},getTopAxis:function(e,t){return this._getAxis(e,t,n,"top")},getBottomAxis:function(e,t){return this._getAxis(e,t,n,"bottom")},getLeftAxis:function(e,t){return this._getAxis(e,t,r,"left")},getRightAxis:function(e,t){return this._getAxis(e,t,r,"right")},setXAxis:function(e,t){this.setBottomAxis(e,t)},setYAxis:function(e,t){this.setLeftAxis(e,t)},setLeftAxis:function(e,t){t=t||0,this.axis.left[t]=e},setRightAxis:function(e,t){t=t||0,this.axis.right[t]=e},setTopAxis:function(e,t){t=t||0,this.axis.top[t]=e},setBottomAxis:function(e,t){t=t||0,this.axis.bottom[t]=e},getPaddingTop:function(){return this.options.paddingTop},getPaddingLeft:function(){return this.options.paddingLeft},getPaddingBottom:function(){return this.options.paddingTop},getPaddingRight:function(){return this.options.paddingRight},setTitle:function(e){this.title=e,this.domTitle.textContent=e},displayTitle:function(){this.domTitle.setAttribute("display","inline")},hideTitle:function(){this.domTitle.setAttribute("display","none")},drawSerie:function(e){e.draw(this.getDrawingGroup())},getDrawingHeight:function(e){if(e&&this.innerHeight)return this.innerHeight;var t=this.height-this.options.paddingTop-this.options.paddingBottom;return this.innerHeight=t},getDrawingWidth:function(e){if(e&&this.innerWidth)return this.innerWidth;var t=this.width-this.options.paddingLeft-this.options.paddingRight;return this.innerWidth=t},getBoundaryAxisFromSeries:function(e,t,n){var r=t=="x",i=n=="min",s,o=r?["getMinX","getMaxX"]:["getMinY","getMaxY"],u=o[i?0:1],a,f,l,c,h,p;s=i?Number.MAX_VALUE:Number.MIN_VALUE,l=this.getSeriesFromAxis(e,!0);for(h=0,p=l.length;h<p;h++)f=l[h],c=f[u](),s=Math[n](s,c),s==c&&a&&(a.isMinOrMax(!1,t,n),a=f,f.isMinOrMax(!0,t,n));return s},getSeriesFromAxis:function(e,t){var n=[],r=this.series.length-1;for(;r>=0;r--)(this.series[r].getXAxis()==e||this.series[r].getYAxis()==e)&&n.push(this.series[r]);if(t)for(r=0;r<e.series.length;r++)n.push(e.series[r]);return n},_resize:function(){if(!this.width||!this.height)return;this.sizeSet=!0,this.dom.setAttribute("width",this.width),this.dom.setAttribute("height",this.height),this.domTitle.setAttribute("x",this.width/2),this.refreshDrawingZone()},canRedraw:function(){return this.width&&this.height},redraw:function(e,t){if(!this.canRedraw())return;return this.sizeSet?this.refreshDrawingZone(e,t):this._resize(),!0},updateAxes:function(){var e=["bottom","top","left","right"],t,n,r,i,s;this.refreshMinOrMax();for(n=0,r=e.length;n<r;n++)for(i=this.axis[e[n]].length-1;i>=0;i--){t=this.axis[e[n]][i],s=n<2?"x":"y";if(t.disabled)continue;t.setMinValueData(this.getBoundaryAxisFromSeries(this.axis[e[n]][i],s,"min")),t.setMaxValueData(this.getBoundaryAxisFromSeries(this.axis[e[n]][i],s,"max"))}},refreshDrawingZone:function(e,t){var n,r,i,s,o,u,a=["bottom","top","left","right"],f=[0,0,0,0],l;this._painted=!0,this.refreshMinOrMax(),this.applyToAxes(function(e){if(e.disabled)return;var t=a.indexOf(arguments[1]);e.setShift(f[t]+e.getAxisPosition(),e.getAxisPosition()),f[t]+=e.getAxisPosition()},!1,!0,!1),this.applyToAxes(function(e){if(e.disabled)return;e.setMinPx(f[1]),e.setMaxPx(this.getDrawingHeight(!0)-f[0]);var t=e.draw()||0,n=a.indexOf(arguments[1]),r=e.getAxisPosition();e.setShift(f[n]+r+t,t+r),f[n]+=t+r,e.drawSeries()},!1,!1,!0),this.applyToAxes(function(e){if(e.disabled)return;e.setMinPx(f[2]),e.setMaxPx(this.getDrawingWidth(!0)-f[3]),e.draw(),e.drawSeries()},!1,!0,!1),this.closeLine("right",this.getDrawingWidth(!0),this.getDrawingWidth(!0),f[1],this.getDrawingHeight(!0)-f[0]),this.closeLine("left",0,0,f[1],this.getDrawingHeight(!0)-f[0]),this.closeLine("top",f[2],this.getDrawingWidth(!0)-f[3],0,0),this.closeLine("bottom",f[2],this.getDrawingWidth(!0)-f[3],this.getDrawingHeight(!0)-f[0],this.getDrawingHeight(!0)-f[0]),this.clipRect.setAttribute("y",f[1]),this.clipRect.setAttribute("x",f[2]),this.clipRect.setAttribute("width",this.getDrawingWidth()-f[2]-f[3]),this.clipRect.setAttribute("height",this.getDrawingHeight()-f[1]-f[0]),this.rectEvent.setAttribute("x",f[1]),this.rectEvent.setAttribute("y",f[2]),this.rectEvent.setAttribute("width",this.getDrawingWidth()-f[2]-f[3]),this.rectEvent.setAttribute("height",this.getDrawingHeight()-f[1]-f[0]),this.shift=f,this.redrawShapes()},autoscaleAxes:function(){this.applyToAxes("setMinMaxToFitSeries",null,!0,!0),this.redraw()},closeLine:function(e,t,n,r,i){this.options.close[e]&&this.axis[e].length==0?(this.closingLines[e].setAttribute("display","block"),this.closingLines[e].setAttribute("x1",t),this.closingLines[e].setAttribute("x2",n),this.closingLines[e].setAttribute("y1",r),this.closingLines[e].setAttribute("y2",i)):this.closingLines[e].setAttribute("display","none")},refreshMinOrMax:function(){var e=this.series.length-1;for(;e>=0;e--)this.series[e].isMinOrMax(!1)},_makeSerie:function(e,t,n){switch(n){case"contour":var r=new s;break;case"scatter":var r=new o;break;case"zone":var r=new u;break;case"line":default:var r=new i}return r.init(this,e,t),this.plotGroup.appendChild(r.groupMain),r},newSerie:function(e,t,n){var r=this._makeSerie(e,t,n);return this.series.push(r),this.legend&&this.legend.update(),r},getSerie:function(e){if(typeof e=="number")return this.series[e];var t=0,n=this.series.length;for(;t<n;t++)if(this.series[t].getName()==e)return this.series[t]},getSeries:function(){return this.series},drawSeries:function(){if(!this.width||!this.height)return;var e=this.series.length-1;for(;e>=0;e--)this.series[e].draw()},checkMinOrMax:function(e){var t=e.getXAxis(),n=e.getYAxis(),r=e.getMinX(),i=e.getMaxX(),s=e.getMinY(),o=e.getMaxY(),u=!1;return r<=t.getMinValue()&&(u=!0,e.isMinOrMax(!0,"x","min")),i>=t.getMaxValue()&&(u=!0,e.isMinOrMax(!0,"x","max")),s<=n.getMinValue()&&(u=!0,e.isMinOrMax(!0,"y","min")),i>=t.getMaxValue()&&(u=!0,e.isMinOrMax(!0,"y","max")),u},removeSerie:function(e){var t=this.series.length-1;for(;t>=0;t--)this.series[t]==e&&this.series.slice(t,1);e.removeDom(),e.isMinOrMax()&&this.refreshDrawingZone(),this.legend&&this.legend.update()},setZoomMode:function(e){if(e=="x"||e=="y"||e=="xy"||!e)this.options.zoomMode=e},setDefaultWheelAction:function(e){if(e!="zoomY"&&e!="zoomX"&&e!="none")return;this.options.defaultWheelAction=e},getZoomMode:function(){return this.options.zoomMode},makeToolbar:function(n){var r=this,i=e.Deferred();return t(["./graph.toolbar"],function(e){r.toolbar=new e(r,n),i.resolve(r.toolbar)}),i},makeShape:function(n,r,i){var s=this,o,u=e.Deferred();n.id=Math.random();if(i&&!1===(o=this.triggerEvent("onShapeBeforeMake",n)))return;o&&(n=o);var a=t(["./graph.shape."+n.type],function(e){var t=new e(s,n.shapeOptions);t.setSerie(s.getSerie(0));if(!t)return;t.setOriginalData(n,r),t.data&&(t.data.id=s.id),n.fillColor&&t.set("fillColor",n.fillColor),n.strokeColor&&t.set("strokeColor",n.strokeColor),n.strokeWidth&&t.set("strokeWidth",n.strokeWidth||(n.strokeColor?1:0));if(n.label){n.label instanceof Array||(n.label=[n.label]);for(var i=0,o=n.label.length;i<o;i++)t.set("labelPosition",n.label[i].position,i),t.set("labelColor",n.label[i].color||"black",i),t.set("labelSize",n.label[i].size,i),t.set("labelAngle",n.label[i].angle||0,i),n.label[i].anchor&&t.set("labelAnchor",n.label[i].anchor,i);t.setLabelNumber(o)}s.shapes.push(t),s.triggerEvent("onShapeMake",t,n),u.resolve(t)});return u},redrawShapes:function(){for(var e=0,t=this.shapes.length;e<t;e++)this.shapes[e].redraw()},removeShapes:function(){for(var e=0,t=this.shapes.length;e<t;e++)this.shapes[e].kill();this.shapes=[]},removeShape:function(e){this.shapes.splice(this.shapes.indexOf(e),1)},_makeClosingLines:function(){this.closingLines={};var e=["top","bottom","left","right"],t=0,n=4,r;for(;t<n;t++){var r=document.createElementNS(this.ns,"line");r.setAttribute("stroke","black"),r.setAttribute("shape-rendering","crispEdges"),r.setAttribute("stroke-linecap","square"),r.setAttribute("display","none"),this.closingLines[e[t]]=r,this.graphingZone.appendChild(r)}},_pluginsExecute:function(e,t){for(var n in this._plugins)this._plugins[n]&&this._plugins[n][e]&&this._plugins[n][e].apply(this._plugins[n],t)},_pluginExecute:function(e,t,n){this._plugins[e]&&this._plugins[e][t]&&this._plugins[e][t].apply(this._plugins[e],n)},_pluginsInit:function(){var e=this,n;this._plugins=this._plugins||{};if(Array.isArray(this.options.plugins))n=this.options.plugins;else{n=[];for(var r in this.options.plugins)n.push(r)}t(n,function(){for(var t=0,r=n.length;t<r;t++)e._plugins[n[t]]=new arguments[t],e._plugins[n[t]].init(e,e.options.plugins[n[t]]||{},n[t]);e._pluginsReady()})},getPlugin:function(e){var t=this;return this.pluginsReady.then(function(){return t._plugins[e]||!1})},_pluginsReady:function(){this.pluginsReady.resolve()},triggerEvent:function(){var e=arguments[0],t=Array.prototype.splice.apply(arguments,[0,1]);if(typeof this.options[e]=="function")return this.options[e].apply(this,arguments);return},selectShape:function(e){if(this.selectedShape==e)return;this.selectedShape&&(console.log("Unselect shape"),this.selectedShape.unselect()),this.selectedShape=e,this.triggerEvent("onShapeSelect",e.data)},unselectShape:function(){if(!this.selectedShape)return;this.selectedShape.unselect(),this.triggerEvent("onShapeUnselect",this.selectedShape.data),this.selectedShape=!1},selectSerie:function(e){if(this.selectedSerie==e)return;this.selectedSerie&&this.selectedSerie.unselect(),this.selectedSerie=e,e.select()},unselectSerie:function(e){e.unselect(),this.selectedSerie=!1},getSelectedSerie:function(){return this.selectedSerie},makeLegend:function(e){return this.legend=new a(this,e),this.graphingZone.appendChild(this.legend.getDom()),this.legend.update(),this.legend},updateLegend:function(){if(!this.legend)return;this.legend.update()},getPosition:function(e,t,n,r,i){var s,o={x:!1,y:!1};n||(n=this.getXAxis()),r||(r=this.getYAxis());if(!e)return;for(var u in o){var a=u=="x"?n:r;if(e[u]===undefined&&(e["d"+u]!==undefined&&t===undefined||t===undefined)){if(u=="x")o[u]=t?t[u]:a.getPos(0);else if(e.x&&i){var l=i.searchClosestValue(e.x);if(!l)return;o[u]=i.getY(l.yMin)}}else e[u]!==undefined&&(o[u]=this.getPx(e[u],a));if(e["d"+u]!==undefined){var c=e[u]!==undefined||t==undefined||t[u]==undefined?o[u]:this._getPositionPx(t[u],!0,a)||0;(s=f(e["d"+u]))!==!1?o[u]=c+s:(s=this._parsePercent(e["d"+u]))?o[u]=c+this._getPositionPx(s,!0,a):a&&(o[u]=c+a.getRelPx(e["d"+u]))}}return o},_getPositionPx:function(e,t,n){if(parsed=f(e))return parsed;if(parsed=this._parsePercent(e))return parsed/100*(t?this.graph.getDrawingWidth():this.graph.getDrawingHeight());if(n)return n.getPos(e)},_parsePercent:function(e){return e&&e.indexOf&&e.indexOf("%")>-1?e:!1},deltaPosition:function(e,t,n){var r,i;return(r=f(e))?(i=f(t))?r+i+"px":r+n.getRelPx(t)+"px":(i=f(t))?e+n.getRelVal(i):e+t},getPx:function(e,t,n){var r;if((r=f(e))!==!1)return r;if(r=this._parsePercent(e))return r;if(t)return e=="min"?t.getMinPx():e=="max"?t.getMaxPx():n?t.getRelPx(e):t.getPos(e)},getPxRel:function(e,t){return this.getPx(e,t,!0)},contextListen:function(e,n,r){var i=this;if(this.options.onContextMenuListen)return this.options.onContextMenuListen(e,n,r);this.context?this.context.listen(e,n,r):t(["./util/context"],function(t){var s=new t;s.init(i._dom),s.listen(e,n,r),i.context=s})}},h.prototype.plugins={},h});