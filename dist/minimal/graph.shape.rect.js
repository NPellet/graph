/* !
* Graphing JavaScript Library v0.4.0
* https://github.com/NPellet/graph
* 
* Copyright (c) 2014 Norman Pellet
* Permission is hereby granted, free of charge, to any person obtaining a copy
* of this software and associated documentation files (the "Software"), to deal
* in the Software without restriction, including without limitation the rights
* to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the Software is
* furnished to do so, subject to the following conditions:
* 
* The above copyright notice and this permission notice shall be included in
* all copies or substantial portions of the Software.
* 
* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
* IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
* FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
* AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
* LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
* OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
* THE SOFTWARE.
* 
* Date: 09-08-2014
*/
define(["require","graphs/graph.shape"],function(t,e){var i=function(t,e){this.options=e,this.init(t),this.graph=t,this.nbHandles=4,this.createHandles(this.nbHandles,"rect",{transform:"translate(-3 -3)",width:6,height:6,stroke:"black",fill:"white"}),this.handle2.setAttribute("cursor","nesw-resize"),this.handle4.setAttribute("cursor","nesw-resize"),this.handle1.setAttribute("cursor","nwse-resize"),this.handle3.setAttribute("cursor","nwse-resize")};return $.extend(i.prototype,e.prototype,{createDom:function(){this._dom=document.createElementNS(this.graph.ns,"rect")},setWidthPx:function(t){this.set("width",t)},setHeightPx:function(t){this.set("height",t)},setFullWidth:function(){this.set("x",Math.min(this.serie.getXAxis().getMinPx(),this.serie.getXAxis().getMaxPx())),this.set("width",Math.abs(this.serie.getXAxis().getMaxPx()-this.serie.getXAxis().getMinPx()))},setFullHeight:function(){this.set("y",Math.min(this.serie.getYAxis().getMinPx(),this.serie.getYAxis().getMaxPx())),this.set("height",Math.abs(this.serie.getYAxis().getMaxPx()-this.serie.getYAxis().getMinPx()))},setPosition:function(){var t=this.getFromData("width"),e=this.getFromData("height"),i=this._getPosition(this.getFromData("pos")),s=i.x,h=i.y;if(void 0==t||void 0==e){var r=this._getPosition(this.getFromData("pos2"));t=r.x-i.x,e=r.y-i.y}else t=this.graph.getPxRel(t,this.serie.getXAxis()),e=this.graph.getPxRel(e,this.serie.getYAxis());return s=i.x,h=i.y,0>t&&(s+=t,t*=-1),0>e&&(h+=e,e*=-1),0/0!==s&&s!==!1&&0/0!==h&&h!==!1?(this.setDom("width",t),this.setDom("height",e),this.setDom("x",s),this.setDom("y",h),this.currentX=s,this.currentY=h,this.currentW=t,this.currentH=e,this.setHandles(),!0):!1},getLinkingCoords:function(){return{x:this.currentX+this.currentW/2,y:this.currentY+this.currentH/2}},redrawImpl:function(){},handleCreateImpl:function(){this.resize=!0,this.handleSelected=3},handleMouseDownImpl:function(){},handleMouseUpImpl:function(){},handleMouseMoveImpl:function(t,e,i){if(this.moving||this.handleSelected){var s=this.getFromData("width")||0,h=this.getFromData("height")||0,r=this.getFromData("pos"),a=this.getFromData("pos2");if(a){var n=this.serie.getXAxis().isFlipped(),l=this.serie.getYAxis().isFlipped(),d=r.x,o=r.y,g=a.x,c=a.y;if(this.moving)return r.x=this.graph.deltaPosition(r.x,e,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,i,this.serie.getYAxis()),a.x=this.graph.deltaPosition(a.x,e,this.serie.getXAxis()),a.y=this.graph.deltaPosition(a.y,i,this.serie.getYAxis()),this.setData("pos",r),this.setData("pos2",a),void this.setPosition();if(1==this.handleSelected||4==this.handleSelected)var x=!n;else var x=n;if(g>d&&x||d>=g&&!x?d=this.graph.deltaPosition(d,e,this.serie.getXAxis()):g=this.graph.deltaPosition(g,e,this.serie.getXAxis()),1==this.handleSelected||2==this.handleSelected)var x=!l;else var x=l;c>o&&x||o>=c&&!x?o=this.graph.deltaPosition(o,i,this.serie.getYAxis()):c=this.graph.deltaPosition(c,i,this.serie.getYAxis()),(c>o&&a.y<r.y||o>c&&a.y>r.y)&&(1==this.handleSelected?this.handleSelected=4:2==this.handleSelected?this.handleSelected=3:3==this.handleSelected?this.handleSelected=2:4==this.handleSelected&&(this.handleSelected=1)),(g>d&&a.x<r.x||d>g&&a.x>r.x)&&(1==this.handleSelected?this.handleSelected=2:2==this.handleSelected?this.handleSelected=1:3==this.handleSelected?this.handleSelected=4:4==this.handleSelected&&(this.handleSelected=3)),a.x=g,a.y=c,r.x=d,r.y=o,this.setData("pos2",a)}else{if(this.moving)return r.x=this.graph.deltaPosition(r.x,e,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,i,this.serie.getYAxis()),this.setData("pos",r),void this.setPosition();1==this.handleSelected&&(r.x=this.graph.deltaPosition(r.x,e,this.serie.getXAxis()),r.y=this.graph.deltaPosition(r.y,i,this.serie.getYAxis()),s=this.graph.deltaPosition(s,-e,this.serie.getXAxis()),h=this.graph.deltaPosition(h,-i,this.serie.getYAxis())),2==this.handleSelected&&(r.y=this.graph.deltaPosition(r.y,i,this.serie.getYAxis()),s=this.graph.deltaPosition(s,e,this.serie.getXAxis()),h=this.graph.deltaPosition(h,-i,this.serie.getYAxis())),3==this.handleSelected&&(s=this.graph.deltaPosition(s,e,this.serie.getXAxis()),h=this.graph.deltaPosition(h,i,this.serie.getYAxis())),4==this.handleSelected&&(r.x=this.graph.deltaPosition(r.x,e,this.serie.getXAxis()),s=this.graph.deltaPosition(s,-e,this.serie.getXAxis()),h=this.graph.deltaPosition(h,i,this.serie.getYAxis()));var u=this.graph.getPxRel(s,this.serie.getXAxis()),p=this.graph.getPxRel(h,this.serie.getYAxis());0>u&&(r.x=this.graph.deltaPosition(r.x,s),s=-s,1==this.handleSelected?this.handleSelected=2:2==this.handleSelected?this.handleSelected=1:3==this.handleSelected?this.handleSelected=4:4==this.handleSelected&&(this.handleSelected=3)),0>p&&(r.y=this.graph.deltaPosition(r.y,h),h=-h,1==this.handleSelected?this.handleSelected=4:2==this.handleSelected?this.handleSelected=3:3==this.handleSelected?this.handleSelected=2:4==this.handleSelected&&(this.handleSelected=1)),this.setData("width",s),this.setData("height",h)}this.setData("pos",r),this.setPosition()}},setHandles:function(){this._selected&&void 0!=this.currentX&&(this.addHandles(),this.handle1.setAttribute("x",this.currentX),this.handle1.setAttribute("y",this.currentY),this.handle2.setAttribute("x",this.currentX+this.currentW),this.handle2.setAttribute("y",this.currentY),this.handle3.setAttribute("x",this.currentX+this.currentW),this.handle3.setAttribute("y",this.currentY+this.currentH),this.handle4.setAttribute("x",this.currentX),this.handle4.setAttribute("y",this.currentY+this.currentH))},selectStyle:function(){this.setDom("stroke","red"),this.setDom("stroke-width","2"),this.setDom("fill","rgba(255, 0, 0, 0.1)")}}),i});